<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Canonicalization</title>
</head>


<body>
<div class="head">
<h1>Theory Canonicalization</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Canonicalization DSL</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><span>Canonicalization</span><span>
  </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span>
    </span><a href="Markup.html"><span>Markup</span></a><span>
    </span><a href="Phase.html"><span>Phase</span></a><span>
  </span><span class="keyword2"><span class="keyword"><span>keywords</span></span></span><span>
    </span><span class="quoted"><span>"</span><span>phase</span><span>"</span></span><span> </span><span class="main"><span>::</span></span><span> thy_decl </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> 
    </span><span class="quoted"><span>"</span><span>terminating</span><span>"</span></span><span> </span><span class="main"><span>::</span></span><span> quasi_command </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="quoted"><span>"</span><span>print_phases</span><span>"</span></span><span> </span><span class="main"><span>::</span></span><span> diag </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="quoted"><span>"</span><span>optimization</span><span>"</span></span><span> </span><span class="main"><span>::</span></span><span> thy_goal_defn
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹</span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>Rewrite</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Transform</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> * </span><span>'a</span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Conditional</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> * </span><span>'a</span><span> * term </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Sequential</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> Rewrite * </span><span>'a</span><span> Rewrite </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Transitive</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> Rewrite

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>rewrite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>name</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span> </span><span>rewrite</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="entity"><span>Rewrite</span></span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>RewriteRule</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Rule</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rewrite</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Transform</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>from</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>to</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>from</span></span><span class="main"><span>,</span></span><span>
        </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>" ↦ "</span></span><span class="main"><span>,</span></span><span>
        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>to</span></span><span>
      </span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>pretty_rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Conditional</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>from</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>to</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cond</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>from</span></span><span class="main"><span>,</span></span><span>
        </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>" ↦ "</span></span><span class="main"><span>,</span></span><span>
        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>to</span></span><span class="main"><span>,</span></span><span>
        </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>" when "</span></span><span class="main"><span>,</span></span><span>
        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cond</span></span><span>
      </span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>pretty_rewrite</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"not implemented"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
    </span><span>Pretty.str</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>name</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>": "</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>pretty_rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rewrite</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>]</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>RewritePhase</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>DSL_Phase</span></span><span class="main"><span>(</span></span><span class="entity"><span>RewriteRule</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.command</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>phase</span></span><span>›</span></span></span><span> </span><span class="inner_quoted"><span>"enter an optimization phase"</span></span><span>
   </span><span class="main"><span>(</span></span><span>Parse.binding</span><span> </span><span>--|</span><span> </span><span>Parse.$$$</span><span> </span><span class="inner_quoted"><span>"terminating"</span></span><span> </span><span>--</span><span> </span><span>Parse.const</span><span> </span><span>--|</span><span> </span><span>Parse.begin</span><span>
     </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Toplevel.begin_main_target</span></span><span> </span><span>true</span><span> </span><span>o</span><span> </span><span class="entity"><span>RewritePhase.setup</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_phases</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>phase</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>RewritePhase.pretty</span></span><span> </span><span class="entity"><span>phase</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
    </span><span>map</span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RewritePhase.phases</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_optimizations</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>print_phases</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.writeln_chunks</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.command</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>print_phases</span></span><span>›</span></span></span><span>
    </span><span class="inner_quoted"><span>"print debug information for optimizations"</span></span><span>
    </span><span class="main"><span>(</span></span><span>Scan.succeed</span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Toplevel.keep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_optimizations</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Toplevel.context_of</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span>›</span></span><span>

</span><span class="keyword1"><span class="command"><span>ML_file</span></span></span><span> </span><span class="quoted"><span>"</span><span>rewrites.ML</span><span>"</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Canonicalization.rewrite_preservation.elims|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation.induct|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation.simps|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation.pelims|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation.cases|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation.termination|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation.pinduct|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation.psimps|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.inducts|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.simps|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.induct|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.cases|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.intros|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.inducts|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.simps|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.induct|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.cases|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.intros|fact"><span class="entity_def" id="Canonicalization.rewrite_preservation.elims(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.elims(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.elims(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.induct|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.simps(4)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.simps(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.simps(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.simps(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.pelims(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.pelims(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.pelims(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.cases|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.termination|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.pinduct|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.psimps(4)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.psimps(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.psimps(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation.psimps(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.inducts|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.simps|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.induct|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.cases|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.intros(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.intros(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel.intros(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.inducts|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.simps|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.induct|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.cases|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.intros(4)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.intros(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.intros(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph.intros(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_preservation_def|axiom"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel_def|axiom"><span class="entity_def" id="Canonicalization.rewrite_preservation_sumC_def|axiom"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph_def|axiom"><span class="entity_def" id="Canonicalization.rewrite_preservation_dom|const"><span class="entity_def" id="Canonicalization.rewrite_preservation_rel|const"><span class="entity_def" id="Canonicalization.rewrite_preservation_sumC|const"><span class="entity_def" id="Canonicalization.rewrite_preservation_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Canonicalization.rewrite_preservation|const"><span>rewrite_preservation</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRExpr|type"><span>IRExpr</span></a><span> </span><a class="entity_ref" href="Markup.html#Markup.Rewrite|type"><span>Rewrite</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rewrite_preservation</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Transform|const"><span>Transform</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="main"><span>≤</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rewrite_preservation</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Conditional|const"><span>Conditional</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>cond</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>cond</span></span></span></span><span> </span><span class="main"><span>⟶</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="main"><span>≤</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rewrite_preservation</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Sequential|const"><span>Sequential</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>rewrite_preservation</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span class="free"><span>rewrite_preservation</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rewrite_preservation</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Transitive|const"><span>Transitive</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>rewrite_preservation</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Canonicalization.rewrite_termination.elims|fact"><span class="entity_def" id="Canonicalization.rewrite_termination.induct|fact"><span class="entity_def" id="Canonicalization.rewrite_termination.simps|fact"><span class="entity_def" id="Canonicalization.rewrite_termination.pelims|fact"><span class="entity_def" id="Canonicalization.rewrite_termination.cases|fact"><span class="entity_def" id="Canonicalization.rewrite_termination.termination|fact"><span class="entity_def" id="Canonicalization.rewrite_termination.pinduct|fact"><span class="entity_def" id="Canonicalization.rewrite_termination.psimps|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.inducts|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.simps|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.induct|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.cases|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.intros|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.inducts|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.simps|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.induct|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.cases|fact"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.intros|fact"><span class="entity_def" id="Canonicalization.rewrite_termination.elims(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.elims(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.elims(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.induct|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.simps(4)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.simps(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.simps(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.simps(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.pelims(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.pelims(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.pelims(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.cases|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.termination|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.pinduct|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.psimps(4)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.psimps(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.psimps(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination.psimps(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.inducts|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.simps|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.induct|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.cases|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.intros(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.intros(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_rel.intros(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.inducts|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.simps|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.induct|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.cases|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.intros(4)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.intros(3)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.intros(2)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_graph.intros(1)|thm"><span class="entity_def" id="Canonicalization.rewrite_termination_def|axiom"><span class="entity_def" id="Canonicalization.rewrite_termination_rel_def|axiom"><span class="entity_def" id="Canonicalization.rewrite_termination_sumC_def|axiom"><span class="entity_def" id="Canonicalization.rewrite_termination_graph_def|axiom"><span class="entity_def" id="Canonicalization.rewrite_termination_dom|const"><span class="entity_def" id="Canonicalization.rewrite_termination_rel|const"><span class="entity_def" id="Canonicalization.rewrite_termination_sumC|const"><span class="entity_def" id="Canonicalization.rewrite_termination_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Canonicalization.rewrite_termination|const"><span>rewrite_termination</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRExpr|type"><span>IRExpr</span></a><span> </span><a class="entity_ref" href="Markup.html#Markup.Rewrite|type"><span>Rewrite</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRExpr|type"><span>IRExpr</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span>nat</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rewrite_termination</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Transform|const"><span>Transform</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rewrite_termination</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Conditional|const"><span>Conditional</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>cond</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>cond</span></span></span></span><span> </span><span class="main"><span>⟶</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rewrite_termination</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Sequential|const"><span>Sequential</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>rewrite_termination</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span class="free"><span>rewrite_termination</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rewrite_termination</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Transitive|const"><span>Transitive</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>rewrite_termination</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>trm</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Canonicalization.intval.elims|fact"><span class="entity_def" id="Canonicalization.intval.induct|fact"><span class="entity_def" id="Canonicalization.intval.simps|fact"><span class="entity_def" id="Canonicalization.intval.pelims|fact"><span class="entity_def" id="Canonicalization.intval.cases|fact"><span class="entity_def" id="Canonicalization.intval.termination|fact"><span class="entity_def" id="Canonicalization.intval.pinduct|fact"><span class="entity_def" id="Canonicalization.intval.psimps|fact"><span class="entity_def" id="Canonicalization.intval_rel.inducts|fact"><span class="entity_def" id="Canonicalization.intval_rel.simps|fact"><span class="entity_def" id="Canonicalization.intval_rel.induct|fact"><span class="entity_def" id="Canonicalization.intval_rel.cases|fact"><span class="entity_def" id="Canonicalization.intval_rel.intros|fact"><span class="entity_def" id="Canonicalization.intval_graph.inducts|fact"><span class="entity_def" id="Canonicalization.intval_graph.simps|fact"><span class="entity_def" id="Canonicalization.intval_graph.induct|fact"><span class="entity_def" id="Canonicalization.intval_graph.cases|fact"><span class="entity_def" id="Canonicalization.intval_graph.intros|fact"><span class="entity_def" id="Canonicalization.intval.elims(3)|thm"><span class="entity_def" id="Canonicalization.intval.elims(2)|thm"><span class="entity_def" id="Canonicalization.intval.elims(1)|thm"><span class="entity_def" id="Canonicalization.intval.induct|thm"><span class="entity_def" id="Canonicalization.intval.simps(4)|thm"><span class="entity_def" id="Canonicalization.intval.simps(3)|thm"><span class="entity_def" id="Canonicalization.intval.simps(2)|thm"><span class="entity_def" id="Canonicalization.intval.simps(1)|thm"><span class="entity_def" id="Canonicalization.intval.pelims(3)|thm"><span class="entity_def" id="Canonicalization.intval.pelims(2)|thm"><span class="entity_def" id="Canonicalization.intval.pelims(1)|thm"><span class="entity_def" id="Canonicalization.intval.cases|thm"><span class="entity_def" id="Canonicalization.intval.termination|thm"><span class="entity_def" id="Canonicalization.intval.pinduct|thm"><span class="entity_def" id="Canonicalization.intval.psimps(4)|thm"><span class="entity_def" id="Canonicalization.intval.psimps(3)|thm"><span class="entity_def" id="Canonicalization.intval.psimps(2)|thm"><span class="entity_def" id="Canonicalization.intval.psimps(1)|thm"><span class="entity_def" id="Canonicalization.intval_rel.inducts|thm"><span class="entity_def" id="Canonicalization.intval_rel.simps|thm"><span class="entity_def" id="Canonicalization.intval_rel.induct|thm"><span class="entity_def" id="Canonicalization.intval_rel.cases|thm"><span class="entity_def" id="Canonicalization.intval_rel.intros(3)|thm"><span class="entity_def" id="Canonicalization.intval_rel.intros(2)|thm"><span class="entity_def" id="Canonicalization.intval_rel.intros(1)|thm"><span class="entity_def" id="Canonicalization.intval_graph.inducts|thm"><span class="entity_def" id="Canonicalization.intval_graph.simps|thm"><span class="entity_def" id="Canonicalization.intval_graph.induct|thm"><span class="entity_def" id="Canonicalization.intval_graph.cases|thm"><span class="entity_def" id="Canonicalization.intval_graph.intros(4)|thm"><span class="entity_def" id="Canonicalization.intval_graph.intros(3)|thm"><span class="entity_def" id="Canonicalization.intval_graph.intros(2)|thm"><span class="entity_def" id="Canonicalization.intval_graph.intros(1)|thm"><span class="entity_def" id="Canonicalization.intval_def|axiom"><span class="entity_def" id="Canonicalization.intval_rel_def|axiom"><span class="entity_def" id="Canonicalization.intval_sumC_def|axiom"><span class="entity_def" id="Canonicalization.intval_graph_def|axiom"><span class="entity_def" id="Canonicalization.intval_dom|const"><span class="entity_def" id="Canonicalization.intval_rel|const"><span class="entity_def" id="Canonicalization.intval_sumC|const"><span class="entity_def" id="Canonicalization.intval_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Canonicalization.intval|const"><span>intval</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Graph/Values.html#Values.Value|type"><span>Value</span></a><span> </span><a class="entity_ref" href="Markup.html#Markup.Rewrite|type"><span>Rewrite</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>intval</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Transform|const"><span>Transform</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≠</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.Value.UndefVal|const"><span>UndefVal</span></a><span> </span><span class="main"><span>∧</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="main"><span>≠</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.Value.UndefVal|const"><span>UndefVal</span></a><span> </span><span class="main"><span>⟶</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>intval</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Conditional|const"><span>Conditional</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>cond</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>cond</span></span></span></span><span> </span><span class="main"><span>⟶</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>intval</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Sequential|const"><span>Sequential</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>intval</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span class="free"><span>intval</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>intval</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Markup.html#Markup.Rewrite.Transitive|const"><span>Transitive</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>intval</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹</span><span>
</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>System</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>RewriteSystem</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>preservation</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="Canonicalization.html#Canonicalization.rewrite_preservation|const"><span>rewrite_preservation</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>termination</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="Canonicalization.html#Canonicalization.rewrite_termination|const"><span>rewrite_termination</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intval</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="Canonicalization.html#Canonicalization.intval|const"><span>intval</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>DSL</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>DSL_Rewrites</span></span><span class="main"><span>(</span></span><span class="entity"><span>System</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.local_theory_to_proof</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>optimization</span></span><span>›</span></span></span><span>
    </span><span class="inner_quoted"><span>"define an optimization and open proof obligation"</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Parse_Spec.thm_name</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span> </span><span>--</span><span> </span><span>Parse.term</span><span>
        </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>DSL.rewrite_cmd</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span>›</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>
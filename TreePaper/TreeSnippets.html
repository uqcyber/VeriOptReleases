<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory TreeSnippets</title>
</head>


<body>
<div class="head">
<h1>Theory TreeSnippets</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TreeSnippets
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../Semantics/TreeToGraphThms.html">Semantics.TreeToGraphThms</a>
    <a href="../Veriopt/Snipping.html">Veriopt.Snipping</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex<span class="main">)</span>
  kind <span class="main">(</span><span class="quoted">"_<span class="keyword1">⟪</span>_<span class="keyword1">⟫</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex<span class="main">)</span>
  IRTreeEval.ord_IRExpr_inst.less_eq_IRExpr <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⟼</span> _"</span><span class="main">)</span>

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹abstract-syntax-tree›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">datatype</span></span>[display,margin=45] IRExpr<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹tree-semantics›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] evaltree.ConstantExpr <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:constant}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] evaltree.ParameterExpr <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:parameter}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] evaltree.ConditionalExpr <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:conditional}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] evaltree.UnaryExpr <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:unary}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] evaltree.BinaryExpr <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:binary}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] evaltree.LeafExpr <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:leaf}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -
<span class="comment1">(*\induct{@{thm[mode=Rule] evaltree.ConvertExpr [no_vars]}}{semantics:convert}*)</span>

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹tree-evaluation-deterministic›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display] evalDet <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹expression-refinement›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> le_expr_def <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹expression-refinement-monotone›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mono_unary <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> \\
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mono_binary <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> \\
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mono_conditional <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="comment1">(* skipping add node optimisations as they are currently very ugly *)</span>

<span class="comment1">(* definition 5 (semantics-preserving) is there a distinction in Isabelle? *)</span>

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹graph-representation›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">bold</span></span> ‹typedef›<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>[source] <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">IRGraph</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">g</span></span> <span class="main"><span class="main">::</span></span> ID <span class="main"><span class="main">⇀</span></span> IRNode <span class="main"><span class="main">.</span></span> finite <span class="main"><span class="main">(</span></span>dom <span class="bound"><span class="bound">g</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹graph2tree›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] rep.ConstantNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:constant}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] rep.ParameterNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:parameter}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] rep.ConditionalNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:conditional}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] rep.AbsNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:unary}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] rep.SignExtendNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:convert}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] rep.AddNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:binary}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] rep.LeafNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{semantics:leaf}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹preeval›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> is_preevaluated.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹deterministic-representation›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> repDet <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="comment1">(* definition 9 (well-formed graph) no? *)</span>

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹graph-semantics›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> encodeeval_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹graph-semantics-deterministic›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> graphDet <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹graph-refinement›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display, margin=60] graph_refinement_def <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="comment1">(* hide as_set, should treat IRGraph as a set of pairs in paper *)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">n</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> as_set <span class="free">n</span>"</span>



<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Experimental embedding into a simplier but usable form for expression nodes in a graph›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> ExprIRNode <span class="main">=</span>
  ExprUnaryNode <span class="quoted">IRUnaryOp</span> <span class="quoted">ID</span> <span class="main">|</span>
  ExprBinaryNode <span class="quoted">IRBinaryOp</span> <span class="quoted">ID</span> <span class="quoted">ID</span> <span class="main">|</span>
  ExprConditionalNode <span class="quoted">ID</span> <span class="quoted">ID</span> <span class="quoted">ID</span> <span class="main">|</span>
  ExprConstantNode <span class="quoted">Value</span> <span class="main">|</span>
  ExprParameterNode <span class="quoted">nat</span> <span class="main">|</span>
  ExprLeafNode <span class="quoted">ID</span> <span class="main">|</span>
  NotExpr

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">embed_expr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRNode <span class="main">⇒</span> ExprIRNode"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>ConstantNode <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> ExprConstantNode <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>ParameterNode <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> ExprParameterNode <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>ConditionalNode <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> ExprConditionalNode <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>AbsNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode UnaryAbs <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>NotNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode UnaryNot <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>NegateNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode UnaryNeg <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>LogicNegationNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode UnaryLogicNegation <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>AddNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinAdd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>MulNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinMul <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>SubNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinSub <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>AndNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinAnd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>OrNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinOr <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>XorNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinXor <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>IntegerBelowNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinIntegerBelow <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>IntegerEqualsNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinIntegerEquals <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>IntegerLessThanNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ExprBinaryNode BinIntegerLessThan <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>NarrowNode <span class="free"><span class="bound"><span class="entity">ib</span></span></span> <span class="free"><span class="bound"><span class="entity">rb</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode <span class="main">(</span>UnaryNarrow <span class="free"><span class="bound"><span class="entity">ib</span></span></span> <span class="free"><span class="bound"><span class="entity">rb</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>SignExtendNode <span class="free"><span class="bound"><span class="entity">ib</span></span></span> <span class="free"><span class="bound"><span class="entity">rb</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode <span class="main">(</span>UnarySignExtend <span class="free"><span class="bound"><span class="entity">ib</span></span></span> <span class="free"><span class="bound"><span class="entity">rb</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main">(</span>ZeroExtendNode <span class="free"><span class="bound"><span class="entity">ib</span></span></span> <span class="free"><span class="bound"><span class="entity">rb</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode <span class="main">(</span>UnaryZeroExtend <span class="free"><span class="bound"><span class="entity">ib</span></span></span> <span class="free"><span class="bound"><span class="entity">rb</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">embed_expr</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> NotExpr"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unary_embed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> UnaryExpr <span class="free">op</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x'</span> <span class="main">.</span> embed_expr <span class="main">(</span>kind <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode <span class="free">op</span> <span class="bound">x'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"UnaryExpr <span class="free">op</span> <span class="free">x</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rep.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equal_embedded_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> UnaryExpr <span class="free">op</span> <span class="free">xe</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"embed_expr <span class="main">(</span>kind <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode <span class="free">op'</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"UnaryExpr <span class="free">op</span> <span class="free">xe</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rep.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> blah<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"embed_expr <span class="main">(</span>kind <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ExprUnaryNode <span class="free">op</span> <span class="free">n'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n'</span> <span class="main">≃</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> UnaryExpr <span class="free">op</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"kind <span class="free">g</span> <span class="free">n</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> rep.AbsNode <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> rep.LogicNegationNode <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> NarrowNode <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">using</span></span> rep.NegateNode <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> rep.NotNode <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> rep.SignExtendNode <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> rep.ZeroExtendNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹graph-semantics-preservation›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display, margin=30] graph_semantics_preservation <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹maximal-sharing›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display, margin=50] maximal_sharing <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹tree-to-graph-rewriting›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display, margin=40] tree_to_graph_rewriting <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹graph-represents-expression›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display] graph_represents_expression_def <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -

<span class="keyword1"><span class="command">snipbegin</span></span> <span class="quoted">‹graph-construction›</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display, margin=40] graph_construction <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">snipend</span></span> -


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</body>

</html>
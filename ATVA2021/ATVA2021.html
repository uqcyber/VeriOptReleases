<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory ATVA2021</title>
</head>


<body>
<div class="head">
<h1>Theory ATVA2021</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ATVA2021
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Optimizations/CanonicalizationProofs.html">Optimizations.CanonicalizationProofs</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*notation (latex)
  NoNode ("ε")
*)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex<span class="main">)</span>
  kind <span class="main">(</span><span class="quoted">"_<span class="keyword1">⟪</span>_<span class="keyword1">⟫</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{isbinary}
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹isBinaryArithmeticNodeType ::›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">isBinaryArithmeticNodeType</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
\EndSnip›</span></span>

<span class="comment1">(* figure out how to export a subset of IRNode!!! *)</span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{inputs_of}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹inputs_of :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">inputs_of</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> inputs_of_ConstantNode<span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> inputs_of_ParameterNode<span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> inputs_of_ValuePhiNode<span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> inputs_of_AddNode<span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> inputs_of_IfNode<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{graphdefnostamp}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">bold</span></span> ‹typedef›<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>[source] <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">IRGraph</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">g</span></span> <span class="main"><span class="main">::</span></span> ID <span class="main"><span class="main">⇀</span></span> IRNode <span class="main"><span class="main">.</span></span> finite <span class="main"><span class="main">(</span></span>dom <span class="bound"><span class="bound">g</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ids_fake</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ID <span class="main">⇀</span> IRNode<span class="main">)</span> <span class="main">⇒</span> ID set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ids_fake</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">nid</span></span> <span class="main">∈</span> dom <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">nid</span> <span class="main">≠</span> <span class="main">(</span>Some NoNode<span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">kind_fake</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ID <span class="main">⇀</span> IRNode<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ID <span class="main">⇒</span> IRNode<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">kind_fake</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">nid</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">nid</span> <span class="keyword1">of</span> None <span class="main">⇒</span> NoNode <span class="main">|</span> Some <span class="bound">v</span> <span class="main">⇒</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{helpers_display}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹ids :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">ids_fake</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> ids_fake.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹kind :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">kind_fake</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> kind_fake.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹inputs :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">inputs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> inputs.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹succ :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">succ</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> succ.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹input_edges :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">input_edges</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> input_edges.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹usages :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">usages</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> usages.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹successor_edges :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">successor_edges</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> successor_edges.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹predecessors :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">predecessors</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> predecessors.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]
\EndSnip›</span></span>


<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{wff_start_def}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display,margin=40] wff_start_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{wff_closed_def}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display,margin=40] wff_closed_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span> 
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{wff_phis_def}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display,margin=40] wff_phis_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span> 
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{wff_ends_def}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display,margin=40] wff_ends_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{wff_graph_def}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹wff_graph :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typeof</span></span> <span class="quoted"><span class="quoted">wff_graph</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> wff_graph.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span>


<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{programdef}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">bold</span></span> ‹type-synonym›<span class="antiquote"><span class="antiquote">}</span></span></span></span> Signature = <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">string</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">bold</span></span> ‹type-synonym›<span class="antiquote"><span class="antiquote">}</span></span></span></span> Program = <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"Signature <span class="main"><span class="main">⇒</span></span> IRGraph option"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span>

<span class="keyword1"><span class="command">print_antiquotations</span></span>

<span class="comment1">(*
type_synonym ('a, 'b) Heap = "'a ⇒ 'b ⇒ Value"
type_synonym Free = "nat"
type_synonym ('a, 'b) DynamicHeap = "('a, 'b) Heap × Free"

fun h_load_field :: "'a ⇒ 'b ⇒ ('a, 'b) DynamicHeap ⇒ Value" where
  "h_load_field f r (h, n) = h f r"

fun h_store_field :: "'a ⇒ 'b ⇒ Value ⇒ ('a, 'b) DynamicHeap ⇒ ('a, 'b) DynamicHeap" where
  "h_store_field f r v (h, n) = (h(f := ((h f)(r := v))), n)"

fun h_new_inst :: "('a, 'b) DynamicHeap ⇒ ('a, 'b) DynamicHeap × Value" where
  "h_new_inst (h, n) = ((h,n+1), (ObjRef (Some n)))"

type_synonym FieldRefHeap = "(string, objref) DynamicHeap"
*)</span>

<span class="comment1">(* TODO: add heap here *)</span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{heapdef}%›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Heap <span class="main">=</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> objref <span class="main">⇒</span> Value"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Free <span class="main">=</span> <span class="quoted"><span class="quoted">"nat"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> DynamicHeap <span class="main">=</span> <span class="quoted"><span class="quoted">"Heap <span class="main">×</span> Free"</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹
\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹h_load_field :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span>[source] <span class="quoted"><span class="quoted">"string <span class="main"><span class="main">⇒</span></span> objref <span class="main"><span class="main">⇒</span></span> DynamicHeap <span class="main"><span class="main">⇒</span></span> Value"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> h_load_field.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹h_store_field :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span>[source] <span class="quoted"><span class="quoted">"string <span class="main"><span class="main">⇒</span></span> objref <span class="main"><span class="main">⇒</span></span> Value <span class="main"><span class="main">⇒</span></span> DynamicHeap <span class="main"><span class="main">⇒</span></span> DynamicHeap"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> h_store_field.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[0.75em]

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">‹h_new_inst :: ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span>[source] <span class="quoted"><span class="quoted">"DynamicHeap <span class="main"><span class="main">⇒</span></span> <span class="main"><span class="main">(</span></span>DynamicHeap <span class="main"><span class="main">×</span></span> Value<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> h_new_inst.simps<span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\EndSnip›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{ExpressionSemantics}%›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval.ConstantNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{eval:const}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval.ParameterNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{eval:param}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval.ValuePhiNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{eval:phi}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval.NegateNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{eval:neg}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval.AddNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{eval:add}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval.InvokeNodeEval <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{eval:invoke}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval.LoadFieldNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{eval:load}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval.RefNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{eval:ref}
\end{center}
›</span></span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\EndSnip›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{EvalAll}%›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval_all.Base <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[8px]
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] eval_all.Transitive <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\EndSnip›</span></span>


<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{StepSemantics}%›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step.SequentialNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{step:seq}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step.IfNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{step:if}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step.EndNodes <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{step:end}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step.NewInstanceNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{step:newinst}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step.LoadFieldNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{step:load}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step.StoreFieldNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{step:store}
\end{center}
›</span></span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\EndSnip›</span></span>


<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{TopStepSemantics}%›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step_top.Lift <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{top:lift}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step_top.InvokeNodeStep <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{top:invoke}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step_top.ReturnNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{top:return}
\induct{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] step_top.UnwindNode <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}{top:unwind}
\end{center}
›</span></span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\EndSnip›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{AddNodeRules}%
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] CanonicalizeAdd.add_both_const <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[8px]
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] CanonicalizeAdd.add_xzero <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[8px]
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] CanonicalizeAdd.add_yzero <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
\EndSnip›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{AddNodeProof}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> CanonicalizeAddProof<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{Stutter}%›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] stutter.StutterStep <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[8px]
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] stutter.Transitive <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
›</span></span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\EndSnip›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{CanonicalizeIfNodeRules}%
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] CanonicalizeIf.trueConst<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[8px]
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] CanonicalizeIf.falseConst<span class="antiquote"><span class="antiquote">}</span></span></span></span>\\[8px]
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[mode=Rule] CanonicalizeIf.eqBranch<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
\EndSnip›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">replace_node_fake</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ID <span class="main">⇒</span> IRNode <span class="main">⇒</span> IRGraph <span class="main">⇒</span> IRGraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">replace_node_fake</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">node</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> replace_node <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">node</span></span></span><span class="main">,</span>default_stamp<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeIfProof_fake<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">MapState</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">h</span><span class="main">::</span><span class="quoted">FieldRefHeap</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g</span> <span class="free">nid</span> <span class="main">=</span> <span class="free">before</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeIf <span class="free">g</span> <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">=</span> replace_node_fake <span class="free">nid</span> <span class="free">after</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">nid'</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">|</span> <span class="free">g</span> <span class="main">∼</span> <span class="free">g'</span>"</span></span>
  <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{CanonicalizeIfNodeProof}%
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[display] CanonicalizeIfProof_fake<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
\EndSnip›</span></span>

<span class="comment1">(* EXPERIMENTAL *)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex <span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
  filtered_inputs <span class="main">(</span><span class="quoted">"<span class="keyword1">inputs<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹\\ensuremath{^{\\mathit{›</span>_<span class="keyword1">⟪</span>_<span class="keyword1">⟫<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹}}}›<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹\\ensuremath{_{\\mathit{›</span>_<span class="keyword1"><span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹}}}›</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex <span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
  filtered_successors <span class="main">(</span><span class="quoted">"<span class="keyword1">succ<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹\\ensuremath{^{\\mathit{›</span>_<span class="keyword1">⟪</span>_<span class="keyword1">⟫<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹}}}›<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹\\ensuremath{_{\\mathit{›</span>_<span class="keyword1"><span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹}}}›</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex <span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
  filtered_usages <span class="main">(</span><span class="quoted">"<span class="keyword1">usages<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹\\ensuremath{^{\\mathit{›</span>_<span class="keyword1">⟪</span>_<span class="keyword1">⟫<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹}}}›<span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹\\ensuremath{_{\\mathit{›</span>_<span class="keyword1"><span class="hidden">\&lt;^</span><span class="control">latex</span><span class="hidden">&gt;</span>‹}}}›</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{example2}%
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>[display] <span class="quoted"><span class="quoted">‹filtered_inputs <span class="free"><span class="free">g</span></span> <span class="free"><span class="free">nid</span></span> <span class="free"><span class="free">f</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\EndSnip›</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex <span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
  Pure.dummy_pattern <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span>"</span><span class="main">)</span>

<span class="comment1">(* take out bits from intvals - changes if we change to deal with bits *)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex <span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
  IntVal <span class="main">(</span><span class="quoted">"<span class="keyword1">IntVal</span> <span class="keyword3">(2</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory AddPhase</title>
</head>


<body>
<div class="head">
<h1>Theory AddPhase</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><span>AddPhase</span><span>
  </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span>
    </span><a href="Common.html"><span>Common</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Optimizations for Add Nodes</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>phase</span></span></span><span> </span><span>AddNode</span><span> 
  </span><span class="keyword2"><span class="keyword"><span>terminating</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../OptimizationDSL/Canonicalization.html#Canonicalization.size|const"><span>size</span></a></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_125..130">lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.binadd_commute|fact"><span class="entity_def" id="AddPhase.binadd_commute|thm"><span class="entity_def" id="offset_131..145">binadd_commute</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.bin_eval|const"><span>bin_eval</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRBinaryOp.BinAdd|const"><span>BinAdd</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>≠</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.Value.UndefVal|const"><span>UndefVal</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.bin_eval|const"><span>bin_eval</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRBinaryOp.BinAdd|const"><span>BinAdd</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.bin_eval|const"><span>bin_eval</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRBinaryOp.BinAdd|const"><span>BinAdd</span></a><span> </span><span class="free"><span>y</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_125..130"><span>assms</span></a><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add_sym|fact"><span>intval_add_sym</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>


</span><span class="comment1"><span>(</span><span>*</span><span> horrible backward proof - needs improving </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.AddShiftConstantRight_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.AddShiftConstantRight|fact"><span class="entity_def" id="AddPhase.AddShiftConstantRight_code|fact"><span class="entity_def" id="AddPhase.AddShiftConstantRight(2)|thm"><span class="entity_def" id="AddPhase.AddShiftConstantRight(1)|thm"><span class="entity_def" id="AddPhase.AddShiftConstantRight_code|thm"><span class="entity_def" id="AddPhase.AddShiftConstantRight_code_raw|axiom"><span>AddShiftConstantRight</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.ExtraNotation.ConstantNotation|const"><span>const</span></a></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Conditional|const"><span>⟼</span></a></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.ExtraNotation.ConstantNotation|const"><span>const</span></a></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Conditional|const"><span>when</span></a></span><span> </span><span class="main"><span>¬</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRExpr.is_ConstantExpr|const"><span>is_ConstantExpr</span></a><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Common.html#Common.size_non_const|fact"><span>size_non_const</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.le_expr_def|fact"><span>le_expr_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>impI</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span>1</span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>allI</span><span> </span><span>impI</span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
    </span><span class="comment1"><span>(</span><span>*</span><span> apply auto  -- unfolds premise eval, but not concl. </span><span>*</span><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_640..641">2</span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> m p va</span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.BinaryExprE|fact"><span>BinaryExprE</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_640..641"><span>2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>  </span><span class="comment1"><span>(</span><span>*</span><span> go forward from v+y </span><span>*</span><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_740..741">3</span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> x ya</span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.evaltree.BinaryExpr|fact"><span>BinaryExpr</span></a><span class="main"><span>)</span></span><span>       </span><span class="comment1"><span>(</span><span>*</span><span> go backward from y+v </span><span>*</span><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_740..741"><span>3</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_740..741"><span>3</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_740..741"><span>3</span></a><span> </span><a class="entity_ref" href="AddPhase.html#offset_131..145"><span>binadd_commute</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.AddShiftConstantRight2_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.AddShiftConstantRight2|fact"><span class="entity_def" id="AddPhase.AddShiftConstantRight2_code|fact"><span class="entity_def" id="AddPhase.AddShiftConstantRight2(2)|thm"><span class="entity_def" id="AddPhase.AddShiftConstantRight2(1)|thm"><span class="entity_def" id="AddPhase.AddShiftConstantRight2_code|thm"><span class="entity_def" id="AddPhase.AddShiftConstantRight2_code_raw|axiom"><span>AddShiftConstantRight2</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.ExtraNotation.ConstantNotation|const"><span>const</span></a></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Conditional|const"><span>⟼</span></a></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.ExtraNotation.ConstantNotation|const"><span>const</span></a></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Conditional|const"><span>when</span></a></span><span> </span><span class="main"><span>¬</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRExpr.is_ConstantExpr|const"><span>is_ConstantExpr</span></a><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.le_expr_def|fact"><span>le_expr_def</span></a><span>
   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add_sym|fact"><span>intval_add_sym</span></a><span class="main"><span>)</span></span><span>
  </span><span class="comment1"><span>(</span><span>*</span><span> termination proof </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Common.html#Common.size_non_const|fact"><span>size_non_const</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>


</span><span class="comment1"><span>(</span><span>*</span><span> TODO: define is_neutral and then lemmas like this: 
lemma simp_neutral:
  assumes n: "is_neutral op (IntVal32 n)" 
  shows "bin_eval op x (IntVal32 n) = x"
  apply (induction op)
  unfolding is_neutral.simps 
  using n apply auto
</span><span>*</span><span>)</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> poor-mans is_neutral lemma </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.is_neutral_0|fact"><span class="entity_def" id="AddPhase.is_neutral_0|thm"><span class="entity_def" id="offset_1452..1464">is_neutral_0</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_1483..1484">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add|const"><span>intval_add</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.Value.IntVal|const"><span>IntVal</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.Value.IntVal|const"><span>IntVal</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≠</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.Value.UndefVal|const"><span>UndefVal</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add|const"><span>intval_add</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.Value.IntVal|const"><span>IntVal</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.Value.IntVal|const"><span>IntVal</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.new_int|const"><span>new_int</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_1483..1484"><span>1</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.AddNeutral_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.AddNeutral|fact"><span class="entity_def" id="AddPhase.AddNeutral_code|fact"><span class="entity_def" id="AddPhase.AddNeutral(2)|thm"><span class="entity_def" id="AddPhase.AddNeutral(1)|thm"><span class="entity_def" id="AddPhase.AddNeutral_code|thm"><span class="entity_def" id="AddPhase.AddNeutral_code_raw|axiom"><span>AddNeutral</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>e</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.ExtraNotation.ConstantNotation|const"><span>const</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.Value.IntVal|const"><span>IntVal</span></a><span> </span><span class="numeral"><span>32</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Transform|const"><span>⟼</span></a></span><span> </span><span class="free"><span>e</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.le_expr_def|fact"><span>le_expr_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_1452..1464"><span>is_neutral_0</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEvalThms.html#IRTreeEvalThms.eval_unused_bits_zero|fact"><span>eval_unused_bits_zero</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>add_cancel_left_right</span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add.elims|fact"><span>intval_add.elims</span></a><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.val_to_bool.simps|fact"><span>val_to_bool.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>ML_val</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>‹</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>y</span></span><span>›</span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_1862..1867">lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.NeutralLeftSubVal|fact"><span class="entity_def" id="AddPhase.NeutralLeftSubVal|thm"><span class="entity_def" id="offset_1868..1885">NeutralLeftSubVal</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>e1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.new_int|const"><span>new_int</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>ival</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>val[</span></span><span class="main"><span>(</span></span><span class="free"><span>e1</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>e2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>e2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><a class="entity_ref" href="Common.html#Common.well_formed_equal|const"><span>≈</span></a></span><span> </span><span class="free"><span>e1</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_1862..1867"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>e1</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>e2</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>
  

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.RedundantSubAdd_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.RedundantSubAdd|fact"><span class="entity_def" id="AddPhase.RedundantSubAdd_code|fact"><span class="entity_def" id="AddPhase.RedundantSubAdd(2)|thm"><span class="entity_def" id="AddPhase.RedundantSubAdd(1)|thm"><span class="entity_def" id="AddPhase.RedundantSubAdd_code|thm"><span class="entity_def" id="AddPhase.RedundantSubAdd_code_raw|axiom"><span class="entity_def" id="offset_2026..2041">RedundantSubAdd</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>e<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Transform|const"><span>⟼</span></a></span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>1</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>auto</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEvalThms.html#IRTreeEvalThms.eval_unused_bits_zero|fact"><span>eval_unused_bits_zero</span></a><span> </span><a class="entity_ref" href="AddPhase.html#offset_1868..1885"><span>NeutralLeftSubVal</span></a><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Common.html#Common.well_formed_equal_defn|fact"><span>well_formed_equal_defn</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEvalThms.html#IRTreeEvalThms.evalDet|fact"><span>evalDet</span></a><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.intval_sub.elims|fact"><span>intval_sub.elims</span></a><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.new_int.elims|fact"><span>new_int.elims</span></a><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> a little helper lemma for using universal quantified assumptions </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.allE2|fact"><span class="entity_def" id="AddPhase.allE2|thm"><span>allE2</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.just_goal2|fact"><span class="entity_def" id="AddPhase.just_goal2|thm"><span>just_goal2</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2382..2383">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add|const"><span>intval_add</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.intval_sub|const"><span>intval_sub</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>≠</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.Value.UndefVal|const"><span>UndefVal</span></a><span> </span><span class="main"><span>∧</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>≠</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.Value.UndefVal|const"><span>UndefVal</span></a><span> </span><span class="main"><span>⟶</span></span><span>
    </span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add|const"><span>intval_add</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.intval_sub|const"><span>intval_sub</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRExpr.BinaryExpr|const"><span>BinaryExpr</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRBinaryOp.BinAdd|const"><span>BinAdd</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRExpr.BinaryExpr|const"><span>BinaryExpr</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.IRBinaryOp.BinSub|const"><span>BinSub</span></a><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≥</span></span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>1</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.le_expr_def|fact"><span>le_expr_def</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEvalThms.html#IRTreeEvalThms.unfold_binary|fact"><span>unfold_binary</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.bin_eval.simps|fact"><span>bin_eval.simps</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_2382..2383"><span>1</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEvalThms.html#IRTreeEvalThms.evalDet|fact"><span>evalDet</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEvalThms.html#IRTreeEvalThms.evaltree_not_undef|fact"><span>evaltree_not_undef</span></a><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.RedundantSubAdd2_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.RedundantSubAdd2|fact"><span class="entity_def" id="AddPhase.RedundantSubAdd2_code|fact"><span class="entity_def" id="AddPhase.RedundantSubAdd2(2)|thm"><span class="entity_def" id="AddPhase.RedundantSubAdd2(1)|thm"><span class="entity_def" id="AddPhase.RedundantSubAdd2_code|thm"><span class="entity_def" id="AddPhase.RedundantSubAdd2_code_raw|axiom"><span>RedundantSubAdd2</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>e<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Transform|const"><span>⟼</span></a></span><span> </span><span class="free"><span>e<span class="hidden">⇩</span><sub>1</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.evaltree.BinaryExpr|fact"><span>BinaryExpr</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.BinaryExprE|fact"><span>BinaryExprE</span></a><span> </span><a class="entity_ref" href="AddPhase.html#offset_2026..2041"><span>RedundantSubAdd</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_131..145"><span>binadd_commute</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEval.html#IRTreeEval.le_expr_def|fact"><span>le_expr_def</span></a><span> </span><a class="entity_ref" href="../OptimizationDSL/Canonicalization.html#Canonicalization.rewrite_preservation.simps|fact"><span>rewrite_preservation.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> Demonstration of our FOUR levels of expression rewrites:
   =======================================================
  level 1 (Java-like): "-e + y ⟼ y - e"
  level 2 (expr trees): "rewrite_preservation
     (BinaryExpr BinAdd (UnaryExpr UnaryNeg e) y ⟼ BinaryExpr BinSub y e) &amp;&amp;&amp;
    rewrite_termination
     (BinaryExpr BinAdd (UnaryExpr UnaryNeg e) y ⟼ BinaryExpr BinSub y e)
     Common.size"
  level 2b: "BinaryExpr BinAdd (UnaryExpr UnaryNeg e) y ≤ BinaryExpr BinSub y e"
  level 2c: "∀m p v. ([m,p] ⊢ BinaryExpr BinAdd (UnaryExpr UnaryNeg e) y ↦ v)
                   ⟶ ([m,p] ⊢ BinaryExpr BinSub y e ↦ v)"
  level 3 (intval ops): "⋀m p xa ya.
       [m,p] ⊢ e ↦ xa ⟹
       [m,p] ⊢ y ↦ ya ⟹
       intval_negate xa ≠ UndefVal ⟹
       intval_add (intval_negate xa) ya ≠ UndefVal ⟹
       ∃x. ([m,p] ⊢ y ↦ x) ∧
           (∃y. ([m,p] ⊢ e ↦ y) ∧
                intval_add (intval_negate xa) ya =
                intval_sub x y)"
  level 3b: "∀m p v.
       (∃x ya.
           (∃xa. ([m,p] ⊢ e ↦ xa) ∧
                 x = intval_negate xa ∧ x ≠ UndefVal) ∧
                 ([m,p] ⊢ y ↦ ya) ∧
                 v = intval_add x ya ∧ v ≠ UndefVal) ⟶
       (∃x ya.
           ([m,p] ⊢ y ↦ x) ∧
           ([m,p] ⊢ e ↦ ya) ∧
            v = intval_sub x ya ∧ v ≠ UndefVal)"
  level 4 (Word library): "-ev + yv = yv - ev" (twice, for 32-bit and 64-bit)
</span><span>*</span><span>)</span></span><span>


</span><span class="comment1"><span>(</span><span>*</span><span> The LowLevel version, intval_*, of this helper lemma is much easier
   to prove than the bin_eval level.  And equally easy to use in AddToSub.
 </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.AddToSubHelperLowLevel|fact"><span class="entity_def" id="AddPhase.AddToSubHelperLowLevel|thm"><span class="entity_def" id="offset_4366..4388">AddToSubHelperLowLevel</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add|const"><span>intval_add</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Graph/Values.html#Values.intval_negate|const"><span>intval_negate</span></a><span> </span><span class="free"><span>e</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.intval_sub|const"><span>intval_sub</span></a><span> </span><span class="free"><span>y</span></span><span> </span><span class="free"><span>e</span></span><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="var"><span>?y</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>y</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>e</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.AddToSub_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.AddToSub|fact"><span class="entity_def" id="AddPhase.AddToSub_code|fact"><span class="entity_def" id="AddPhase.AddToSub(2)|thm"><span class="entity_def" id="AddPhase.AddToSub(1)|thm"><span class="entity_def" id="AddPhase.AddToSub_code|thm"><span class="entity_def" id="AddPhase.AddToSub_code_raw|axiom"><span>AddToSub</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>-</span></span><span class="free"><span>e</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Transform|const"><span>⟼</span></a></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>e</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_4366..4388"><span>AddToSubHelperLowLevel</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  

</span><span class="keyword1"><span class="command"><span>print_phases</span></span></span><span>


</span><span class="comment1"><span>(</span><span>*</span><span> -----  Starts here -----  </span><span>*</span><span>)</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> 
 AddNode has 8 optimisations total
 Currently *6* optimisations are verified.

 -- Already verified above --

 - AddShiftRightConst
 - RedundantSubAdd
 - AddNeutral (32-bit only)

 -- Verified below --
 
 - RedundantAddSub
 - AddRightNegateToSub
 - AddLeftNegateToSub 

 -- Left to go --
 - mergeSignExtendAdd
 - mergeZeroExtendAdd

</span><span>*</span><span>)</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> Value level proofs </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_5000..5005">lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.val_redundant_add_sub|fact"><span class="entity_def" id="AddPhase.val_redundant_add_sub|thm"><span class="entity_def" id="offset_5006..5027">val_redundant_add_sub</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.new_int|const"><span>new_int</span></a><span> </span><span class="free"><span>bb</span></span><span> </span><span class="free"><span>ival</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>val[</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>≠</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.Value.UndefVal|const"><span>UndefVal</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>val[</span></span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_5000..5005"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>a</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>b</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>presburger</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_5188..5193">lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.val_add_right_negate_to_sub|fact"><span class="entity_def" id="AddPhase.val_add_right_negate_to_sub|thm"><span>val_add_right_negate_to_sub</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>val[</span></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>e</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>≠</span></span><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.Value.UndefVal|const"><span>UndefVal</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>val[</span></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>-</span></span><span class="free"><span>e</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span>val[</span></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>e</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_5188..5193"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>e</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> Exp level proofs </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="AddPhase.exp_add_left_negate_to_sub|fact"><span class="entity_def" id="AddPhase.exp_add_left_negate_to_sub|thm"><span class="entity_def" id="offset_5366..5392">exp_add_left_negate_to_sub</span></span></span><span class="main"><span>:</span></span><span>
 </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>exp[</span></span><span class="main"><span>-</span></span><span class="free"><span>e</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>≥</span></span><span> </span><span class="keyword1"><span>exp[</span></span><span class="free"><span>y</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>e</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>e</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>y</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_4366..4388"><span>AddToSubHelperLowLevel</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Optimisations</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.RedundantAddSub_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.RedundantAddSub|fact"><span class="entity_def" id="AddPhase.RedundantAddSub_code|fact"><span class="entity_def" id="AddPhase.RedundantAddSub(2)|thm"><span class="entity_def" id="AddPhase.RedundantAddSub(1)|thm"><span class="entity_def" id="AddPhase.RedundantAddSub_code|thm"><span class="entity_def" id="AddPhase.RedundantAddSub_code_raw|axiom"><span>RedundantAddSub</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Transform|const"><span>⟼</span></a></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>auto</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_5006..5027"><span>val_redundant_add_sub</span></a><span> </span><a class="entity_ref" href="../Semantics/IRTreeEvalThms.html#IRTreeEvalThms.eval_unused_bits_zero|fact"><span>eval_unused_bits_zero</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../Semantics/IRTreeEvalThms.html#IRTreeEvalThms.evalDet|fact"><span>evalDet</span></a><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add.elims|fact"><span>intval_add.elims</span></a><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.new_int.elims|fact"><span>new_int.elims</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.AddRightNegateToSub_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.AddRightNegateToSub|fact"><span class="entity_def" id="AddPhase.AddRightNegateToSub_code|fact"><span class="entity_def" id="AddPhase.AddRightNegateToSub(2)|thm"><span class="entity_def" id="AddPhase.AddRightNegateToSub(1)|thm"><span class="entity_def" id="AddPhase.AddRightNegateToSub_code|thm"><span class="entity_def" id="AddPhase.AddRightNegateToSub_code_raw|axiom"><span>AddRightNegateToSub</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>-</span></span><span class="free"><span>e</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Transform|const"><span>⟼</span></a></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>e</span></span><span>"</span></span></span><span>
   </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_4366..4388"><span>AddToSubHelperLowLevel</span></a><span> </span><a class="entity_ref" href="../Graph/Values.html#Values.intval_add_sym|fact"><span>intval_add_sym</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span> 

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AddPhase.AddLeftNegateToSub_code|const"><span>optimization</span></span></span></span><span> </span><span class="entity_def" id="AddPhase.AddLeftNegateToSub|fact"><span class="entity_def" id="AddPhase.AddLeftNegateToSub_code|fact"><span class="entity_def" id="AddPhase.AddLeftNegateToSub(2)|thm"><span class="entity_def" id="AddPhase.AddLeftNegateToSub(1)|thm"><span class="entity_def" id="AddPhase.AddLeftNegateToSub_code|thm"><span class="entity_def" id="AddPhase.AddLeftNegateToSub_code_raw|axiom"><span>AddLeftNegateToSub</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>-</span></span><span class="free"><span>e</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../OptimizationDSL/Markup.html#Markup.Rewrite.Transform|const"><span>⟼</span></a></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>e</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AddPhase.html#offset_5366..5392"><span>exp_add_left_negate_to_sub</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> ----- Ends here ----- </span><span>*</span><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>



</span><span class="comment1"><span>(</span><span>*</span><span> Isabelle Isar Questions:
 Why doesn't subgoal handle \forall and ⟶ ?
 Then this pattern might become just a single subgoal?
  subgoal premises p1
    apply ((rule allI)+; rule impI)
    subgoal premises p2 for m p v
</span><span>*</span><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>
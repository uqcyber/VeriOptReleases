<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Form</title>
</head>


<body>
<div class="head">
<h1>Theory Form</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formedness Properties›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Form
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Semantics/IREval.html">Semantics.IREval</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_start</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_start</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span>
    is_StartNode <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_closed</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_closed</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">.</span>
      inputs <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="main">⊆</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span>
      succ <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="main">⊆</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span>
      kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="main">≠</span> NoNode<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_phis</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">.</span>
      is_PhiNode <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span>
      length <span class="main">(</span>ir_values <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> length <span class="main">(</span>ir_ends 
           <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>ir_merge <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_ends</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_ends</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">.</span>
      is_AbstractEndNode <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span>
      card <span class="main">(</span>usages <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\Snip{wf_graph}%›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_graph</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_start <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> wf_closed <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> wf_phis <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> wf_ends <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\EndSnip›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> wf_folds <span class="main">=</span>
  wf_graph.simps
  wf_start_def
  wf_closed_def
  wf_phis_def
  wf_ends_def

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_stamps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_stamps</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="bound">m</span> <span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">↦</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟶</span> valid_value <span class="main">(</span>stamp <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_stamp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> <span class="main">(</span>ID <span class="main">⇒</span> Stamp<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_stamp</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="bound">m</span> <span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">↦</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟶</span> valid_value <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph start_end_graph"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> start_end_graph_def wf_folds <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_eg2_sq<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph eg2_sq"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eg2_sq_def wf_folds <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_values</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_values</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">.</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="bound">m</span> <span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span> <span class="main">⊢</span> kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="main">↦</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟶</span> wf_value <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_value_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> int_bits_allowed <span class="main">⟶</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> wf_value <span class="main">(</span>IntVal <span class="free">b</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_value.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_value_bit_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> wf_value <span class="main">(</span>IntVal <span class="free">b</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_value.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_bits_allowed_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>
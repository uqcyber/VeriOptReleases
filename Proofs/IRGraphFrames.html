<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory IRGraphFrames</title>
</head>


<body>
<div class="head">
<h1>Theory IRGraphFrames</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Dynamic Frames›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory defines two operators, 'unchanged' and 'changeonly',
that are useful for specifying which nodes in an IRGraph can change.
The dynamic framing idea originates from 'Dynamic Frames' in software verification,
started by Ioannis T. Kassios in "Dynamic frames: Support for framing, 
dependencies and sharing without restrictions", In FM 2006.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IRGraphFrames
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Form.html">Form</a>
    <a href="../Semantics/IRTreeEval.html">Semantics.IRTreeEval</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">unchanged</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ID set <span class="main">⇒</span> IRGraph <span class="main">⇒</span> IRGraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unchanged</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">∧</span> kind <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="bound">n</span> <span class="main">=</span> kind <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="bound">n</span> <span class="main">∧</span> stamp <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="bound">n</span> <span class="main">=</span> stamp <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* This allows new nodes to be added to g2, but only ns can change. *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">changeonly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ID set <span class="main">⇒</span> IRGraph <span class="main">⇒</span> IRGraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changeonly</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">∧</span> kind <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="bound">n</span> <span class="main">=</span> kind <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="bound">n</span> <span class="main">∧</span> stamp <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="bound">n</span> <span class="main">=</span> stamp <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> node_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="free">ns</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> <span class="free">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> other_node_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"changeonly <span class="free">ns</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∉</span> <span class="free">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> changeonly.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some notation for input nodes used›</span></span>

<span class="comment1">(* Relates all the nodes used in an 'eval', including the node itself. *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">eval_uses</span><span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> ID <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">g</span> <span class="keyword2"><span class="keyword">where</span></span>

  use0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">∈</span> ids <span class="free">g</span>
    <span class="main">⟹</span> <span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  use_inp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
    <span class="main">⟹</span> <span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span>"</span></span> <span class="main">|</span>

  use_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span><span class="main">;</span>
    <span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="free"><span class="bound"><span class="entity">nid''</span></span></span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">nid''</span></span></span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_usages</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> ID set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_usages</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">.</span> eval_uses <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="bound">n</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_usages_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms eval_usages.simps eval_uses.intros<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ids.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_in_g_inputs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∉</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">g</span> <span class="free">nid</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g</span> <span class="free">nid</span> <span class="main">=</span> NoNode"</span></span> <span class="keyword1"><span class="command">using</span></span> assms not_in_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> child_member<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> kind <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> NoNode"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>inputs_of <span class="free">n</span><span class="main">)</span> <span class="free">child</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inputs.simps <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_member<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> child_member_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>inputs_of <span class="main">(</span>kind <span class="free">g</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="free">child</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inputs.simps <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member ids_some inputs.elims<span class="main">)</span>


<span class="comment1">(* Node inputs are not necessarily in ids g (unless wf_graph g).
   But this is true because 'inp' is defined using 'kind'. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> inp_in_g<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">g</span> <span class="free">nid</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff empty_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g</span> <span class="free">nid</span> <span class="main">≠</span> NoNode"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_g_inputs
    <span class="keyword1"><span class="command">using</span></span> ids_some <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_g
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inp_in_g_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> wf_folds
  <span class="keyword1"><span class="command">using</span></span> inp_in_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> kind_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">nid</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eval_usages_self
    <span class="keyword1"><span class="command">using</span></span> unchanged.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stamp_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"stamp <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> stamp <span class="free">g2</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval_usages_self unchanged.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  

<span class="keyword1"><span class="command">lemma</span></span> child_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">child</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval_usages.simps mem_Collect_eq
      unchanged.simps use_inp use_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_usages<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">us</span> <span class="main">=</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span> <span class="main">⟷</span> <span class="free">nid'</span> <span class="main">∈</span> <span class="free">us</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms eval_usages.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ids.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inputs_are_uses<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms use_inp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inputs_are_usages<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> eval_usages inputs_are_uses <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> inputs_of_are_usages<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>inputs_of <span class="main">(</span>kind <span class="free">g</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="free">nid'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> in_set_member inputs.elims inputs_are_usages<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usage_includes_inputs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">us</span> <span class="main">=</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">=</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">⊆</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">⊆</span> <span class="free">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inputs_are_usages eval_usages
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> elim_inp_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> kind <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> NoNode"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> set <span class="main">(</span>inputs_of <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> encode_in_ids<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nid</span> <span class="main">≃</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rep.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_in_ids<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">nid</span> <span class="main">↦</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> encodeeval_def encode_in_ids
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_kind_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">nid'</span> <span class="main">∈</span> <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="main">.</span> kind <span class="free">g1</span> <span class="bound">nid'</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="bound">nid'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> unchanged.elims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> stay_same_encoding<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="free">nid</span> <span class="main">≃</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="free">nid</span> <span class="main">≃</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g1 encode_in_ids <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
<span class="keyword1"><span class="command">using</span></span> g1 nc wf dom <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rep.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstantNode <span class="skolem">n</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> ConstantNode <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dom nc kind_unchanged
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rep.ConstantNode
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ParameterNode <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> ParameterNode <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParameterNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ParameterNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ParameterNode.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rep.ParameterNode stamp_unchanged<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConditionalNode <span class="skolem">n</span> <span class="skolem">c</span> <span class="skolem">t</span> <span class="skolem">f</span> <span class="skolem">ce</span> <span class="skolem">te</span> <span class="skolem">fe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> ConditionalNode <span class="skolem">c</span> <span class="skolem">t</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_ConditionalNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConditionalNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ConditionalNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ConditionalNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ConditionalNode.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> encode_in_ids inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> transitive_kind_same
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConditionalNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ConditionalNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_ConditionalNode <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> ConditionalNode <span class="skolem">c</span> <span class="skolem">t</span> <span class="skolem">f</span>›</span></span> child_unchanged inputs.simps list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.ConditionalNode<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> local.ConditionalNode<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> local.ConditionalNode<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> local.ConditionalNode<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> rep.ConditionalNode set_subset_Cons subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> unchanged.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AbsNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">xe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> AbsNode <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_AbsNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AbsNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> AbsNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> encode_in_ids inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AbsNode.IH AbsNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> AbsNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> AbsNode.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_AbsNode <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> AbsNode <span class="skolem">x</span>›</span></span> child_member_in child_unchanged local.wf member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.AbsNode unchanged.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">xe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> NotNode <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_NotNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NotNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NotNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> encode_in_ids inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NotNode.IH NotNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NotNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NotNode.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_NotNode <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> NotNode <span class="skolem">x</span>›</span></span> child_member_in child_unchanged local.wf member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.NotNode unchanged.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NegateNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">xe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> NegateNode <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_NegateNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NegateNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NegateNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> encode_in_ids inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNodes.inputs_of_NegateNode NegateNode.IH NegateNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NegateNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NegateNode.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> NegateNode <span class="skolem">x</span>›</span></span> child_member_in child_unchanged local.wf member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.NegateNode unchanged.elims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LogicNegationNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">xe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> LogicNegationNode <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_LogicNegationNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LogicNegationNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> LogicNegationNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> encode_in_ids member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNodes.inputs_of_LogicNegationNode LogicNegationNode.IH LogicNegationNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> LogicNegationNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> LogicNegationNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> LogicNegationNode <span class="skolem">x</span>›</span></span> child_unchanged encode_in_ids inputs.simps list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.wf rep.LogicNegationNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AddNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> AddNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_LogicNegationNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AddNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> AddNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> AddNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_AddNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AddNode.IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> AddNode.IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> AddNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> AddNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> AddNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> AddNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_AddNode <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> AddNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_unchanged encode_in_ids in_set_member inputs.simps local.wf member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.AddNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MulNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> MulNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_LogicNegationNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MulNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> MulNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> MulNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_MulNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> MulNode inputs_of_MulNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> MulNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_unchanged inputs.simps list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.MulNode set_subset_Cons subset_iff unchanged.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SubNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> SubNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_LogicNegationNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SubNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> SubNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> SubNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_SubNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SubNode inputs_of_SubNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> SubNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_member child_unchanged encode_in_ids ids_some member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.SubNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> AndNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_LogicNegationNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AndNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> AndNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> AndNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_AndNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> AndNode inputs_of_AndNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> AndNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_unchanged inputs.simps list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.AndNode set_subset_Cons subset_iff unchanged.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> OrNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_OrNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> OrNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> OrNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> OrNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_OrNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> OrNode inputs_of_OrNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> OrNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_member child_unchanged encode_in_ids ids_some member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.OrNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>XorNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> XorNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_XorNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> XorNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> XorNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> XorNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_XorNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> XorNode inputs_of_XorNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> XorNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_member child_unchanged encode_in_ids ids_some member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.XorNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntegerBelowNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> IntegerBelowNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_IntegerBelowNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntegerBelowNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> IntegerBelowNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> IntegerBelowNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_IntegerBelowNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IntegerBelowNode inputs_of_IntegerBelowNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> IntegerBelowNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_member child_unchanged encode_in_ids ids_some member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.IntegerBelowNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntegerEqualsNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> IntegerEqualsNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_IntegerEqualsNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntegerEqualsNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> IntegerEqualsNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> IntegerEqualsNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_IntegerEqualsNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IntegerEqualsNode inputs_of_IntegerEqualsNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> IntegerEqualsNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_member child_unchanged encode_in_ids ids_some member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.IntegerEqualsNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntegerLessThanNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe</span> <span class="skolem">ye</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> IntegerLessThanNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_IntegerLessThanNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntegerLessThanNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> IntegerLessThanNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> IntegerLessThanNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_IntegerLessThanNode encode_in_ids in_mono inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IntegerLessThanNode inputs_of_IntegerLessThanNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> IntegerLessThanNode <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> child_member child_unchanged encode_in_ids ids_some member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.IntegerLessThanNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NarrowNode <span class="skolem">n</span> <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span> <span class="skolem">xe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> NarrowNode <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_NarrowNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NarrowNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NarrowNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_NarrowNode encode_in_ids inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NarrowNode inputs_of_NarrowNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> NarrowNode <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span>›</span></span> child_unchanged inputs.elims list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.NarrowNode unchanged.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SignExtendNode <span class="skolem">n</span> <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span> <span class="skolem">xe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> SignExtendNode <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_SignExtendNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SignExtendNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> SignExtendNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> encode_in_ids inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SignExtendNode inputs_of_SignExtendNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> SignExtendNode <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span>›</span></span> child_member_in child_unchanged in_set_member list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.SignExtendNode unchanged.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZeroExtendNode <span class="skolem">n</span> <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span> <span class="skolem">xe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> ZeroExtendNode <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inputs_of_ZeroExtendNode inputs_of_are_usages
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZeroExtendNode.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ZeroExtendNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> IRNodes.inputs_of_ZeroExtendNode encode_in_ids inputs.simps inputs_are_usages list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ZeroExtendNode inputs_of_ZeroExtendNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">=</span> ZeroExtendNode <span class="skolem">ib</span> <span class="skolem">rb</span> <span class="skolem">x</span>›</span></span> child_member_in child_unchanged member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rep.ZeroExtendNode unchanged.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LeafNode <span class="skolem">n</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kind_unchanged rep.LeafNode stamp_unchanged<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* Main theorem that we want. *)</span>
<span class="keyword1"><span class="command">theorem</span></span> stay_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g1</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">nid</span> <span class="main">↦</span> <span class="free">v1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g2</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">nid</span> <span class="main">↦</span> <span class="free">v1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> nid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g1 eval_in_ids <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="free">nid</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eval_usages_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> kind_same<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">nid</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nc node_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">nid</span> <span class="main">≃</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">e</span> <span class="main">↦</span> <span class="free">v1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> encodeeval_def g1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">e</span> <span class="main">↦</span> <span class="free">v1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g1 encodeeval_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e nid nc <span class="comment1">(* kind_same *)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> encodeeval_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="free">v1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">nid</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> <span class="quoted">"evaltree.induct"</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstantExpr <span class="skolem">c</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConstantNode ConstantNodeE kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ParameterExpr <span class="skolem">i</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">nid</span> <span class="main">≃</span> ParameterExpr <span class="skolem">i</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> stay_same_encoding ParameterExpr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.wf<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> evaltree.ParameterExpr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ParameterExpr.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConditionalExpr <span class="skolem">ce</span> <span class="skolem">cond</span> <span class="skolem">branch</span> <span class="skolem">te</span> <span class="skolem">fe</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">nid</span> <span class="main">≃</span> ConditionalExpr <span class="skolem">ce</span> <span class="skolem">te</span> <span class="skolem">fe</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ConditionalExpr.prems<span class="main">(</span>1<span class="main">)</span> ConditionalExpr.prems<span class="main">(</span>3<span class="main">)</span> local.wf stay_same_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConditionalExpr.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>UnaryExpr <span class="skolem">xe</span> <span class="skolem">v</span> <span class="skolem">op</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> local.wf stay_same_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinaryExpr <span class="skolem">xe</span> <span class="skolem">x</span> <span class="skolem">ye</span> <span class="skolem">y</span> <span class="skolem">op</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> local.wf stay_same_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LeafExpr <span class="skolem">val</span> <span class="skolem">nid</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.wf stay_same_encoding<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> add_changed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">gup</span> <span class="main">=</span> add_node <span class="free">new</span> <span class="free">k</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changeonly <span class="main">{</span><span class="free">new</span><span class="main">}</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> add_node_def changeonly.simps
  <span class="keyword1"><span class="command">using</span></span> add_node.rep_eq add_node_def kind.rep_eq stamp.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> disjoint_change<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"changeonly <span class="free">change</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nochange</span> <span class="main">=</span> ids <span class="free">g</span> <span class="main">-</span> <span class="free">change</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="free">nochange</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> changeonly.simps unchanged.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> add_node_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">new</span> <span class="main">∉</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">gup</span> <span class="main">=</span> add_node <span class="free">new</span> <span class="free">k</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">new</span> <span class="main">∉</span> <span class="main">(</span>eval_usages <span class="free">g</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> eval_usages.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changeonly <span class="main">{</span><span class="free">new</span><span class="main">}</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_changed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms add_node_def disjoint_change
    <span class="keyword1"><span class="command">using</span></span> Diff_insert_absorb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_uses_imp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span> <span class="main">∧</span> <span class="free">nid</span> <span class="main">=</span> <span class="free">nid'</span><span class="main">)</span>
    <span class="main">∨</span> <span class="free">nid'</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid''</span> <span class="main">.</span> eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="bound">nid''</span> <span class="main">∧</span> eval_uses <span class="free">g</span> <span class="bound">nid''</span> <span class="free">nid'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟷</span> eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> use0 use_inp use_trans
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eval_uses.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_use_ids<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eval_uses.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> use0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> use_inp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inp_in_g_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> use_trans
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_external_use<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∉</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">≠</span> <span class="free">nid'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> inp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∉</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> inp_in_g_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rec_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free">g</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">nid'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rec_inp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free">g</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inp_in_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">nid''</span> <span class="main">.</span> eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="bound">nid''</span> <span class="main">∧</span> eval_uses <span class="free">g</span> <span class="bound">nid''</span> <span class="free">nid'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_use_ids assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> inp 0 rec <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> eval_uses_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</body>

</html>
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory IRGraphFrames</title>
</head>


<body>
<div class="head">
<h1>Theory IRGraphFrames</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Dynamic Frames›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory defines two operators, 'unchanged' and 'changeonly',
that are useful for specifying which nodes in an IRGraph can change.
The dynamic framing idea originates from 'Dynamic Frames' in software verification,
started by Ioannis T. Kassios in "Dynamic frames: Support for framing, 
dependencies and sharing without restrictions", In FM 2006.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IRGraphFrames
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Form.html">Form</a>
    <a href="../Semantics/IREval.html">Semantics.IREval</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">unchanged</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ID set <span class="main">⇒</span> IRGraph <span class="main">⇒</span> IRGraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unchanged</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">∧</span> kind <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="bound">n</span> <span class="main">=</span> kind <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* This allows new nodes to be added to g2, but only ns can change. *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">changeonly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ID set <span class="main">⇒</span> IRGraph <span class="main">⇒</span> IRGraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changeonly</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">∧</span> kind <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="bound">n</span> <span class="main">=</span> kind <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> node_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="free">ns</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> <span class="free">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> other_node_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"changeonly <span class="free">ns</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∉</span> <span class="free">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> changeonly.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some notation for input nodes used›</span></span>

<span class="comment1">(* Relates all the nodes used in an 'eval', including the node itself. *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">eval_uses</span><span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> ID <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">g</span> <span class="keyword2"><span class="keyword">where</span></span>

  use0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">∈</span> ids <span class="free">g</span>
    <span class="main">⟹</span> <span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  use_inp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
    <span class="main">⟹</span> <span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span>"</span></span> <span class="main">|</span>

  use_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span><span class="main">;</span>
    <span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="free"><span class="bound"><span class="entity">nid''</span></span></span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">eval_uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">nid''</span></span></span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_usages</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> ID set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_usages</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">.</span> eval_uses <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="bound">n</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_usages_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms eval_usages.simps eval_uses.intros<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ids.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_in_g_inputs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∉</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">g</span> <span class="free">nid</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g</span> <span class="free">nid</span> <span class="main">=</span> NoNode"</span></span> <span class="keyword1"><span class="command">using</span></span> assms not_in_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> child_member<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> kind <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> NoNode"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>inputs_of <span class="free">n</span><span class="main">)</span> <span class="free">child</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inputs.simps <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_member<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> child_member_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>inputs_of <span class="main">(</span>kind <span class="free">g</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="free">child</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inputs.simps <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member ids_some inputs.elims<span class="main">)</span>


<span class="comment1">(* Node inputs are not necessarily in ids g (unless wf_graph g).
   But this is true because 'inp' is defined using 'kind'. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> inp_in_g<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">g</span> <span class="free">nid</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff empty_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g</span> <span class="free">nid</span> <span class="main">≠</span> NoNode"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_g_inputs
    <span class="keyword1"><span class="command">using</span></span> ids_some <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_g
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inp_in_g_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> wf_folds
  <span class="keyword1"><span class="command">using</span></span> inp_in_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> kind_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">nid</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eval_usages_self
    <span class="keyword1"><span class="command">using</span></span> unchanged.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> child_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">child</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval_usages.simps mem_Collect_eq
      unchanged.simps use_inp use_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_usages<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">us</span> <span class="main">=</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span> <span class="main">⟷</span> <span class="free">nid'</span> <span class="main">∈</span> <span class="free">us</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms eval_usages.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ids.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inputs_are_uses<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms use_inp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inputs_are_usages<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> eval_usages inputs_are_uses <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> usage_includes_inputs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">us</span> <span class="main">=</span> eval_usages <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">=</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">⊆</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">⊆</span> <span class="free">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inputs_are_usages eval_usages
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> elim_inp_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> kind <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> NoNode"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> set <span class="main">(</span>inputs_of <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_in_ids<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g</span> <span class="free">nid</span><span class="main">)</span> <span class="main">↦</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"kind <span class="free">g</span> <span class="free">nid</span> <span class="main">=</span> NoNode"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(* Main theorem that we want. *)</span>
<span class="keyword1"><span class="command">theorem</span></span> stay_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="free">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span> <span class="main">↦</span> <span class="free">v1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="free">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="free">nid</span><span class="main">)</span> <span class="main">↦</span> <span class="free">v1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> nid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g1 eval_in_ids <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> eval_usages <span class="free">g1</span> <span class="free">nid</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eval_usages_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> kind_same<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">nid</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">nid</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nc node_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g1 nid nc <span class="comment1">(* kind_same *)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kind <span class="free">g1</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">v1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">nid</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> <span class="quoted">"eval.induct"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">print_cases</span></span>
    <span class="keyword3"><span class="command">case</span></span> const<span class="main">:</span> <span class="main">(</span>ConstantNode <span class="skolem">m</span> <span class="skolem">c</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">nid</span><span class="main">)</span> <span class="main">=</span> ConstantNode <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval.ConstantNode const.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> param<span class="main">:</span> <span class="main">(</span>ParameterNode <span class="skolem">val</span> <span class="skolem">m</span> <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval.ParameterNode kind_unchanged param.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> param.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> param.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ValuePhiNode <span class="skolem">val</span> <span class="skolem">nida</span> <span class="skolem">ux</span> <span class="skolem">uy</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> kind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">nid</span><span class="main">)</span> <span class="main">=</span> ValuePhiNode <span class="skolem">nida</span> <span class="skolem">ux</span> <span class="skolem">uy</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> kind_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ValuePhiNode kind ValuePhiNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ValueProxyNode <span class="skolem">m</span> <span class="skolem">child</span> <span class="skolem">val</span> _ <span class="skolem">nid</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> ValueProxyNode.prems<span class="main">(</span>1<span class="main">)</span> ValueProxyNode.hyps<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> inp_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">child</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> child_member_in inputs_of_ValueProxyNode
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">child</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> wf inp_in_g_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> inp_in <span class="keyword1"><span class="command">have</span></span> unc<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">child</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> child_unchanged ValueProxyNode.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">child</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">val</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ValueProxyNode.hyps<span class="main">(</span>2<span class="main">)</span> cin
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ValueProxyNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ValueProxyNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ValueProxyNode.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval.ValueProxyNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AbsNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">b</span> <span class="skolem">v</span> _<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_unchanged elim_inp_set ids_some inputs_of.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbsNode.hyps<span class="main">(</span>1<span class="main">)</span> AbsNode.hyps<span class="main">(</span>2<span class="main">)</span> not_in_g
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AbsNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> AbsNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> elim_inp_set ids_some inp_in_g_wf inputs_of.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wf<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AbsNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> AbsNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> AbsNode.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval.AbsNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Node<span class="main">:</span> <span class="main">(</span>NegateNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v</span> _<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> inputs_of_NegateNode Node.hyps<span class="main">(</span>3<span class="main">)</span> Node.prems<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> xinp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> child_member_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> wf inp_in_g_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> xinp child_unchanged Node.prems<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Node.hyps<span class="main">(</span>1<span class="main">)</span> Node.hyps<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> kind_unchanged ux xin Node.hyps
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> kind_same Node.hyps<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> eval.NegateNode
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Node.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> kind_unchanged ux xin<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span><span class="main">(</span>AddNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_unchanged inputs.simps inputs_of_AddNode list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNodes.inputs_of_AddNode child_member_in child_unchanged member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AddNode inputs.simps inp_in_g_wf inputs_of_AddNode kind_unchanged list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subset_iff wf<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span><span class="main">(</span>SubNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_SubNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> node <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_SubNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SubNode inputs.simps inputs_of_SubNode kind_unchanged list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subsetD wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span><span class="main">(</span>MulNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_MulNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> node <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_MulNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MulNode inputs.simps inputs_of_MulNode kind_unchanged list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subsetD wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span><span class="main">(</span>AndNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_AndNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> node <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_AndNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AndNode inputs.simps inputs_of_AndNode kind_unchanged list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subsetD wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span> <span class="main">(</span>OrNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_OrNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> node <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_OrNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> OrNode inputs.simps inputs_of_OrNode kind_unchanged list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subsetD wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span> <span class="main">(</span>XorNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_XorNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> node <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_XorNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> XorNode inputs.simps inputs_of_XorNode kind_unchanged list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subsetD wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span> <span class="main">(</span>IntegerEqualsNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">b</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span> <span class="skolem">val</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_IntegerEqualsNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> node <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_IntegerEqualsNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> IntegerEqualsNode child_member_in in_set_member inputs_of_IntegerEqualsNode kind_unchanged list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subsetD wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span> <span class="main">(</span>IntegerLessThanNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">b</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span> <span class="skolem">val</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_IntegerLessThanNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> node <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_IntegerLessThanNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> IntegerLessThanNode child_member_in in_set_member inputs_of_IntegerLessThanNode kind_unchanged list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons subsetD wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span> <span class="main">(</span>ShortCircuitOrNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">b</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span> <span class="skolem">val</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_ShortCircuitOrNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> node <span class="keyword1"><span class="command">have</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_ShortCircuitOrNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g1</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inputs.simps inputs_of_ShortCircuitOrNode list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetD ux wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basic_trans_rules<span class="main"><span class="main">(</span></span>31<span class="main"><span class="main">)</span></span> inputs.simps inputs_of_ShortCircuitOrNode list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons uy wf wf_folds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node.prems ux x uy y x2 y2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ShortCircuitOrNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span> <span class="main">(</span>LogicNegationNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">val</span> <span class="skolem">nida</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> child_member_in child_unchanged inputs_of_LogicNegationNode member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="main">1</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inputs.simps inp_in_g_wf inputs_of_LogicNegationNode list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> wf<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LogicNegationNode kind_unchanged node.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> node<span class="main">:</span><span class="main">(</span>ConditionalNode <span class="skolem">m</span> <span class="skolem">condition</span> <span class="skolem">cond</span> <span class="skolem">trueExp</span> <span class="skolem">b</span> <span class="skolem">trueVal</span> <span class="skolem">falseExp</span> <span class="skolem">falseVal</span> <span class="skolem">val</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">condition</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNodes.inputs_of_ConditionalNode child_member_in member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">condition</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> child_unchanged node.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">condition</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="main">1</span> <span class="skolem">cond</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node c inp_in_g_wf wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trueExp</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNodes.inputs_of_ConditionalNode child_member_in member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> utrue<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">trueExp</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.prems<span class="main">(</span>2<span class="main">)</span> child_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> trueVal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">trueExp</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="main">(</span><span class="skolem">trueVal</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node t inp_in_g_wf wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">falseExp</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNodes.inputs_of_ConditionalNode child_member_in member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ufalse<span class="main">:</span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g1</span> <span class="skolem">falseExp</span><span class="main">)</span> <span class="free">g1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.prems<span class="main">(</span>2<span class="main">)</span> child_unchanged <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> falseVal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">falseExp</span><span class="main">)</span> <span class="main">↦</span> IntVal <span class="skolem">b</span> <span class="main">(</span><span class="skolem">falseVal</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node.hyps node f inp_in_g_wf wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">nid</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">val</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> kind_same trueVal falseVal cond
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConditionalNode kind_unchanged node.hyps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> node.hyps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> node.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RefNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">val</span> <span class="skolem">nid</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNodes.inputs_of_RefNode RefNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> RefNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> child_member_in member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">val</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RefNode.hyps<span class="main">(</span>2<span class="main">)</span> RefNode.prems<span class="main">(</span>2<span class="main">)</span> child_unchanged inp_in_g_wf wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> RefNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> RefNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> RefNode.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval.RefNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InvokeNodeEval <span class="skolem">val</span> <span class="skolem">m</span> _ <span class="skolem">callTarget</span> <span class="skolem">classInit</span> <span class="skolem">stateDuring</span> <span class="skolem">stateAfter</span> <span class="skolem">nex</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval.InvokeNodeEval kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SignedDivNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span> <span class="skolem">zeroCheck</span> <span class="skolem">frameState</span> <span class="skolem">nex</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval.SignedDivNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SignedRemNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v1</span> <span class="skolem">y</span> <span class="skolem">v2</span> <span class="skolem">zeroCheck</span> <span class="skolem">frameState</span> <span class="skolem">nex</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval.SignedRemNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InvokeWithExceptionNodeEval <span class="skolem">val</span> <span class="skolem">m</span> _ <span class="skolem">callTarget</span> <span class="skolem">classInit</span> <span class="skolem">stateDuring</span> <span class="skolem">stateAfter</span> <span class="skolem">nex</span> <span class="skolem">exceptionEdge</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval.InvokeWithExceptionNodeEval kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NewInstanceNode <span class="skolem">m</span> <span class="skolem">nid</span> <span class="skolem">clazz</span> <span class="skolem">stateBefore</span> <span class="skolem">nex</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval.NewInstanceNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IsNullNode <span class="skolem">m</span> <span class="skolem">obj</span> <span class="skolem">ref</span> <span class="skolem">val</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> obj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">obj</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNodes.inputs_of_IsNullNode IsNullNode.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> inputs.simps list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">obj</span><span class="main">)</span> <span class="main">↦</span> ObjRef <span class="skolem">ref</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IsNullNode.hyps<span class="main">(</span>1<span class="main">)</span> IsNullNode.hyps<span class="main">(</span>2<span class="main">)</span> IsNullNode.prems<span class="main">(</span>2<span class="main">)</span> child_unchanged eval_in_ids <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> IsNullNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IsNullNode.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> IsNullNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> IsNullNode.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval.IsNullNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LoadFieldNode<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval.LoadFieldNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>PiNode <span class="skolem">m</span> <span class="skolem">object</span> <span class="skolem">val</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> object<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">object</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inputs_of_PiNode inputs.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PiNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> append_Cons list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">object</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">val</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> PiNode.hyps<span class="main">(</span>1<span class="main">)</span> PiNode.hyps<span class="main">(</span>2<span class="main">)</span> PiNode.prems<span class="main">(</span>2<span class="main">)</span> child_unchanged eval_in_ids <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PiNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> PiNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> PiNode.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval.PiNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotNode <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">val</span> <span class="skolem">not_val</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> object<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inputs <span class="free">g1</span> <span class="skolem">nid</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inputs_of_NotNode inputs.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NotNode.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">m</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">↦</span> <span class="skolem">val</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> NotNode.hyps<span class="main">(</span>1<span class="main">)</span> NotNode.hyps<span class="main">(</span>2<span class="main">)</span> NotNode.prems<span class="main">(</span>2<span class="main">)</span> child_unchanged eval_in_ids <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NotNode.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> NotNode.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> NotNode.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NotNode.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval.NotNode kind_unchanged<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> add_changed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">gup</span> <span class="main">=</span> add_node <span class="free">new</span> <span class="free">k</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changeonly <span class="main">{</span><span class="free">new</span><span class="main">}</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> add_node_def changeonly.simps
  <span class="keyword1"><span class="command">using</span></span> add_node.rep_eq add_node_def kind.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> disjoint_change<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"changeonly <span class="free">change</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nochange</span> <span class="main">=</span> ids <span class="free">g</span> <span class="main">-</span> <span class="free">change</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="free">nochange</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> changeonly.simps unchanged.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> add_node_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">new</span> <span class="main">∉</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">gup</span> <span class="main">=</span> add_node <span class="free">new</span> <span class="free">k</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unchanged <span class="main">(</span>eval_usages <span class="free">g</span> <span class="free">nid</span><span class="main">)</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">new</span> <span class="main">∉</span> <span class="main">(</span>eval_usages <span class="free">g</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> eval_usages.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changeonly <span class="main">{</span><span class="free">new</span><span class="main">}</span> <span class="free">g</span> <span class="free">gup</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_changed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms add_node_def disjoint_change
    <span class="keyword1"><span class="command">using</span></span> Diff_insert_absorb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_uses_imp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span> <span class="main">∧</span> <span class="free">nid</span> <span class="main">=</span> <span class="free">nid'</span><span class="main">)</span>
    <span class="main">∨</span> <span class="free">nid'</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid''</span> <span class="main">.</span> eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="bound">nid''</span> <span class="main">∧</span> eval_uses <span class="free">g</span> <span class="bound">nid''</span> <span class="free">nid'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟷</span> eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> use0 use_inp use_trans
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eval_uses.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_use_ids<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eval_uses.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> use0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> use_inp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inp_in_g_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> use_trans
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_external_use<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∉</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">∈</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="free">nid'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">≠</span> <span class="free">nid'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> inp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">∉</span> inputs <span class="free">g</span> <span class="free">nid</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> inp_in_g_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rec_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free">g</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">nid'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rec_inp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> ids <span class="free">g</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> inputs <span class="free">g</span> <span class="free">nid'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inp_in_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">nid''</span> <span class="main">.</span> eval_uses <span class="free">g</span> <span class="free">nid</span> <span class="bound">nid''</span> <span class="main">∧</span> eval_uses <span class="free">g</span> <span class="bound">nid''</span> <span class="free">nid'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_use_ids assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> inp 0 rec <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> eval_uses_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</body>

</html>
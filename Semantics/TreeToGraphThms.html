<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory TreeToGraphThms</title>
</head>


<body>
<div class="head">
<h1>Theory TreeToGraphThms</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TreeToGraphThms
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="TreeToGraph.html">TreeToGraph</a>
  <a href="IRTreeEvalThms.html">IRTreeEvalThms</a>
  <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Lift refinement monotonicity to graph level.
Hopefully these shouldn't really be required.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> AbsNode <span class="free">x</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> AbsNode <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AbsNode assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mono_unary repDet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_not<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> NotNode <span class="free">x</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> NotNode <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NotNode assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mono_unary repDet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_negate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> NegateNode <span class="free">x</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> NegateNode <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NegateNode assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mono_unary repDet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_logic_negation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> LogicNegationNode <span class="free">x</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> LogicNegationNode <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LogicNegationNode assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mono_unary repDet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_narrow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> NarrowNode <span class="free">ib</span> <span class="free">rb</span> <span class="free">x</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> NarrowNode <span class="free">ib</span> <span class="free">rb</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mono_unary repDet NarrowNode
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_sign_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> SignExtendNode <span class="free">ib</span> <span class="free">rb</span> <span class="free">x</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> SignExtendNode <span class="free">ib</span> <span class="free">rb</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SignExtendNode assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mono_unary repDet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_zero_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> ZeroExtendNode <span class="free">ib</span> <span class="free">rb</span> <span class="free">x</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> ZeroExtendNode <span class="free">ib</span> <span class="free">rb</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mono_unary repDet ZeroExtendNode
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_conditional_graph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> ConditionalNode <span class="free">c</span> <span class="free">t</span> <span class="free">f</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> ConditionalNode <span class="free">c</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">c</span> <span class="main">≃</span> <span class="free">ce1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">c</span> <span class="main">≃</span> <span class="free">ce2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">t</span> <span class="main">≃</span> <span class="free">te1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">t</span> <span class="main">≃</span> <span class="free">te2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">f</span> <span class="main">≃</span> <span class="free">fe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">f</span> <span class="main">≃</span> <span class="free">fe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ce1</span> <span class="main">≥</span> <span class="free">ce2</span> <span class="main">∧</span> <span class="free">te1</span> <span class="main">≥</span> <span class="free">te2</span> <span class="main">∧</span> <span class="free">fe1</span> <span class="main">≥</span> <span class="free">fe2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConditionalNodeE IRNode.inject<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> mono_conditional repDet rep_conditional<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> AddNode <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> AddNode <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">y</span> <span class="main">≃</span> <span class="free">ye1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">y</span> <span class="main">≃</span> <span class="free">ye2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span> <span class="main">∧</span> <span class="free">ye1</span> <span class="main">≥</span> <span class="free">ye2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_binary assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AddNodeE IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> repDet rep_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_mul<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> MulNode <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">=</span> MulNode <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">≃</span> <span class="free">xe2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">y</span> <span class="main">≃</span> <span class="free">ye1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">y</span> <span class="main">≃</span> <span class="free">ye2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xe1</span> <span class="main">≥</span> <span class="free">xe2</span> <span class="main">∧</span> <span class="free">ye1</span> <span class="main">≥</span> <span class="free">ye2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_binary assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>27<span class="main"><span class="main">)</span></span> MulNodeE repDet rep_mul<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> encodes_contains<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e</span> <span class="main">⟹</span>
  kind <span class="free">g</span> <span class="free">n</span> <span class="main">≠</span> NoNode"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rep.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">match</span> IRNode.distinct <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> e<span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">≠</span> NoNode"</span></span> <span class="main"><span class="main">⇒</span></span>
          <span class="quoted">‹<span class="operator">presburger</span> <span class="quasi_keyword">add</span><span class="main">:</span> e›</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> no_encoding<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> ids <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> encodes_contains<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_excluded_keep_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> <span class="free">excluded</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">excluded</span> <span class="main">⊴</span> as_set <span class="free">g1</span><span class="main">)</span> <span class="main">⊆</span> as_set <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="free">n</span> <span class="main">∧</span> stamp <span class="free">g1</span> <span class="free">n</span> <span class="main">=</span> stamp <span class="free">g2</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def domain_subtraction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">method</span></span> metis_node_eq_unary <span class="keyword2"><span class="keyword">for</span></span> <span class="free">node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> IRNode"</span></span> <span class="main">=</span>
  <span class="main">(</span><span class="operator">match</span> IRNode.inject <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i<span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">node</span> <span class="main">_</span> <span class="main">=</span> <span class="free">node</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> <span class="main">_</span>"</span></span> <span class="main"><span class="main">⇒</span></span> 
      <span class="quoted">‹<span class="operator">metis</span> i›</span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> metis_node_eq_binary <span class="keyword2"><span class="keyword">for</span></span> <span class="free">node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> IRNode"</span></span> <span class="main">=</span>
  <span class="main">(</span><span class="operator">match</span> IRNode.inject <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i<span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">node</span> <span class="main">_</span> <span class="main">_</span> <span class="main">=</span> <span class="free">node</span> <span class="main">_</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> <span class="main">_</span>"</span></span> <span class="main"><span class="main">⇒</span></span> 
      <span class="quoted">‹<span class="operator">metis</span> i›</span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> metis_node_eq_ternary <span class="keyword2"><span class="keyword">for</span></span> <span class="free">node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> IRNode"</span></span> <span class="main">=</span>
  <span class="main">(</span><span class="operator">match</span> IRNode.inject <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i<span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">node</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">=</span> <span class="free">node</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> <span class="main">_</span>"</span></span> <span class="main"><span class="main">⇒</span></span> 
      <span class="quoted">‹<span class="operator">metis</span> i›</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> graph_semantics_preservation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e1'</span> <span class="main">≥</span> <span class="free">e2'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="free">n'</span><span class="main">}</span> <span class="main">⊴</span> as_set <span class="free">g1</span><span class="main">)</span> <span class="main">⊆</span> as_set <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="free">n'</span> <span class="main">≃</span> <span class="free">e1'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="free">n'</span> <span class="main">≃</span> <span class="free">e2'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"graph_refinement <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> graph_refinement_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">e1</span>
  <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> <span class="skolem">e1</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e1</span> <span class="main">≥</span> <span class="bound">e2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> <span class="free">e1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c f True repDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> <span class="free">e2'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">e1'</span> <span class="main">≥</span> <span class="free">e2'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True a d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> <span class="main">{</span><span class="free">n'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span> <span class="main">∧</span> stamp <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> stamp <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_excluded_keep_type
      <span class="keyword1"><span class="command">using</span></span> b e <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f i
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">e1</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstantNode <span class="skolem">n</span> <span class="skolem">c</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl rep.ConstantNode<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ParameterNode <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl rep.ParameterNode<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConditionalNode <span class="skolem">n</span> <span class="skolem">c</span> <span class="skolem">t</span> <span class="skolem">f</span> <span class="skolem">ce1</span> <span class="skolem">te1</span> <span class="skolem">fe1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> ConditionalExpr <span class="skolem">ce1</span> <span class="skolem">te1</span> <span class="skolem">fe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f ConditionalNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ConditionalNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.ConditionalNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cn</span></span> <span class="skolem"><span class="skolem">tn</span></span> <span class="skolem"><span class="skolem">fn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> ConditionalNode <span class="skolem">cn</span> <span class="skolem">tn</span> <span class="skolem">fn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ConditionalNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">cn</span> <span class="main">≃</span> <span class="skolem">ce1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ConditionalNode.hyps<span class="main">(</span>1<span class="main">)</span> ConditionalNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">tn</span> <span class="main">≃</span> <span class="skolem">te1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ConditionalNode.hyps<span class="main">(</span>1<span class="main">)</span> ConditionalNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> mf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">fn</span> <span class="main">≃</span> <span class="skolem">fe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ConditionalNode.hyps<span class="main">(</span>1<span class="main">)</span> ConditionalNode.hyps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">cn</span> <span class="main">≃</span> <span class="skolem">ce1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">tn</span> <span class="main">≃</span> <span class="skolem">te1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">fn</span> <span class="main">≃</span> <span class="skolem">fe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> cer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ce2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">cn</span> <span class="main">≃</span> <span class="bound">ce2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ce1</span> <span class="main">≥</span> <span class="bound">ce2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ConditionalNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_ternary</span> <span class="quoted">ConditionalNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> ter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">te2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">tn</span> <span class="main">≃</span> <span class="bound">te2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">te1</span> <span class="main">≥</span> <span class="bound">te2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ConditionalNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_ternary</span> <span class="quoted">ConditionalNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">fe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">fn</span> <span class="main">≃</span> <span class="bound">fe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">fe1</span> <span class="main">≥</span> <span class="bound">fe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ConditionalNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_ternary</span> <span class="quoted">ConditionalNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ce2</span> <span class="bound">te2</span> <span class="bound">fe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> ConditionalExpr <span class="bound">ce2</span> <span class="bound">te2</span> <span class="bound">fe2</span><span class="main">)</span> <span class="main">∧</span> ConditionalExpr <span class="skolem">ce1</span> <span class="skolem">te1</span> <span class="skolem">fe1</span> <span class="main">≥</span> ConditionalExpr <span class="bound">ce2</span> <span class="bound">te2</span> <span class="bound">fe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ConditionalNode.prems l mono_conditional rep.ConditionalNode cer ter
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> IRTreeEvalThms.mono_conditional<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AbsNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">xe1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryAbs <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f AbsNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AbsNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.AbsNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> AbsNode <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AbsNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AbsNode.hyps<span class="main">(</span>1<span class="main">)</span> AbsNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">=</span> <span class="free">n'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xe1</span> <span class="main">=</span> <span class="free">e1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c m repDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryAbs <span class="free">e2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AbsNode.hyps<span class="main">(</span>1<span class="main">)</span> l m n
          <span class="keyword1"><span class="command">using</span></span> AbsNode.prems True d rep.AbsNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"UnaryExpr UnaryAbs <span class="free">e1'</span> <span class="main">≥</span> UnaryExpr UnaryAbs <span class="free">e2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a mono_unary<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ev r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> AbsNode
          <span class="keyword1"><span class="command">using</span></span> False b encodes_contains l not_excluded_keep_type not_in_g singleton_iff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_unary</span> <span class="quoted">AbsNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryAbs <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> UnaryExpr UnaryAbs <span class="skolem">xe1</span> <span class="main">≥</span> UnaryExpr UnaryAbs <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AbsNode.prems l mono_unary rep.AbsNode<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">xe1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryNot <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f NotNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NotNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.NotNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> NotNode <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> NotNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> NotNode.hyps<span class="main">(</span>1<span class="main">)</span> NotNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">=</span> <span class="free">n'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xe1</span> <span class="main">=</span> <span class="free">e1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c m repDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryNot <span class="free">e2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotNode.hyps<span class="main">(</span>1<span class="main">)</span> l m n
          <span class="keyword1"><span class="command">using</span></span> NotNode.prems True d rep.NotNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"UnaryExpr UnaryNot <span class="free">e1'</span> <span class="main">≥</span> UnaryExpr UnaryNot <span class="free">e2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a mono_unary<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ev r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> NotNode
          <span class="keyword1"><span class="command">using</span></span> False i b l not_excluded_keep_type singletonD no_encoding
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_unary</span> <span class="quoted">NotNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryNot <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> UnaryExpr UnaryNot <span class="skolem">xe1</span> <span class="main">≥</span> UnaryExpr UnaryNot <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NotNode.prems l mono_unary rep.NotNode<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NegateNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">xe1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryNeg <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f NegateNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NegateNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.NegateNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> NegateNode <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegateNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegateNode.hyps<span class="main">(</span>1<span class="main">)</span> NegateNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">=</span> <span class="free">n'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xe1</span> <span class="main">=</span> <span class="free">e1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c m repDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryNeg <span class="free">e2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NegateNode.hyps<span class="main">(</span>1<span class="main">)</span> l m n
          <span class="keyword1"><span class="command">using</span></span> NegateNode.prems True d rep.NegateNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"UnaryExpr UnaryNeg <span class="free">e1'</span> <span class="main">≥</span> UnaryExpr UnaryNeg <span class="free">e2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a mono_unary<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ev r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> NegateNode
          <span class="keyword1"><span class="command">using</span></span> False i b l not_excluded_keep_type singletonD no_encoding
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_unary</span> <span class="quoted">NegateNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryNeg <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> UnaryExpr UnaryNeg <span class="skolem">xe1</span> <span class="main">≥</span> UnaryExpr UnaryNeg <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NegateNode.prems l mono_unary rep.NegateNode<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LogicNegationNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">xe1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryLogicNegation <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f LogicNegationNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LogicNegationNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.LogicNegationNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> LogicNegationNode <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> LogicNegationNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> LogicNegationNode.hyps<span class="main">(</span>1<span class="main">)</span> LogicNegationNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">=</span> <span class="free">n'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xe1</span> <span class="main">=</span> <span class="free">e1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c m repDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryLogicNegation <span class="free">e2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LogicNegationNode.hyps<span class="main">(</span>1<span class="main">)</span> l m n
          <span class="keyword1"><span class="command">using</span></span> LogicNegationNode.prems True d rep.LogicNegationNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"UnaryExpr UnaryLogicNegation <span class="free">e1'</span> <span class="main">≥</span> UnaryExpr UnaryLogicNegation <span class="free">e2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a mono_unary<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ev r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> LogicNegationNode
          <span class="keyword1"><span class="command">using</span></span> False i b l not_excluded_keep_type singletonD no_encoding
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_unary</span> <span class="quoted">LogicNegationNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr UnaryLogicNegation <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> UnaryExpr UnaryLogicNegation <span class="skolem">xe1</span> <span class="main">≥</span> UnaryExpr UnaryLogicNegation <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LogicNegationNode.prems l mono_unary rep.LogicNegationNode<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AddNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinAdd <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f AddNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.AddNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> AddNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AddNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AddNode.hyps<span class="main">(</span>1<span class="main">)</span> AddNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AddNode.hyps<span class="main">(</span>1<span class="main">)</span> AddNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> AddNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">AddNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> AddNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">AddNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinAdd <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinAdd <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinAdd <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AddNode.prems l mono_binary rep.AddNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MulNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinMul <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f MulNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MulNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.MulNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> MulNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> MulNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> MulNode.hyps<span class="main">(</span>1<span class="main">)</span> MulNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> MulNode.hyps<span class="main">(</span>1<span class="main">)</span> MulNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> MulNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">MulNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> MulNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">MulNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinMul <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinMul <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinMul <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MulNode.prems l mono_binary rep.MulNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SubNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinSub <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f SubNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SubNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.SubNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> SubNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> SubNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> SubNode.hyps<span class="main">(</span>1<span class="main">)</span> SubNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> SubNode.hyps<span class="main">(</span>1<span class="main">)</span> SubNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> SubNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">SubNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> SubNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">SubNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinSub <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinSub <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinSub <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SubNode.prems l mono_binary rep.SubNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinAnd <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f AndNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AndNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.AndNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> AndNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AndNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AndNode.hyps<span class="main">(</span>1<span class="main">)</span> AndNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AndNode.hyps<span class="main">(</span>1<span class="main">)</span> AndNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> AndNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">AndNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> AndNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">AndNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinAnd <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinAnd <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinAnd <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AndNode.prems l mono_binary rep.AndNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinOr <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f OrNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.OrNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> OrNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> OrNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> OrNode.hyps<span class="main">(</span>1<span class="main">)</span> OrNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> OrNode.hyps<span class="main">(</span>1<span class="main">)</span> OrNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> OrNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">OrNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> OrNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">OrNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinOr <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinOr <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinOr <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> OrNode.prems l mono_binary rep.OrNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>XorNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinXor <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f XorNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> XorNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.XorNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> XorNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> XorNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> XorNode.hyps<span class="main">(</span>1<span class="main">)</span> XorNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> XorNode.hyps<span class="main">(</span>1<span class="main">)</span> XorNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> XorNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">XorNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> XorNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">XorNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinXor <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinXor <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinXor <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> XorNode.prems l mono_binary rep.XorNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntegerBelowNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinIntegerBelow <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f IntegerBelowNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IntegerBelowNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.IntegerBelowNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> IntegerBelowNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerBelowNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerBelowNode.hyps<span class="main">(</span>1<span class="main">)</span> IntegerBelowNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerBelowNode.hyps<span class="main">(</span>1<span class="main">)</span> IntegerBelowNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IntegerBelowNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">IntegerBelowNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IntegerBelowNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">IntegerBelowNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinIntegerBelow <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinIntegerBelow <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinIntegerBelow <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntegerBelowNode.prems l mono_binary rep.IntegerBelowNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntegerEqualsNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinIntegerEquals <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f IntegerEqualsNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IntegerEqualsNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.IntegerEqualsNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> IntegerEqualsNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerEqualsNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerEqualsNode.hyps<span class="main">(</span>1<span class="main">)</span> IntegerEqualsNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerEqualsNode.hyps<span class="main">(</span>1<span class="main">)</span> IntegerEqualsNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IntegerEqualsNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">IntegerEqualsNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IntegerEqualsNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">IntegerEqualsNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinIntegerEquals <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinIntegerEquals <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinIntegerEquals <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntegerEqualsNode.prems l mono_binary rep.IntegerEqualsNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntegerLessThanNode <span class="skolem">n</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xe1</span> <span class="skolem">ye1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinIntegerLessThan <span class="skolem">xe1</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f IntegerLessThanNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IntegerLessThanNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.IntegerLessThanNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> IntegerLessThanNode <span class="skolem">xn</span> <span class="skolem">yn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerLessThanNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerLessThanNode.hyps<span class="main">(</span>1<span class="main">)</span> IntegerLessThanNode.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IntegerLessThanNode.hyps<span class="main">(</span>1<span class="main">)</span> IntegerLessThanNode.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="skolem">ye1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> my <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> xer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IntegerLessThanNode
          <span class="keyword1"><span class="command">using</span></span> a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">IntegerLessThanNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">yn</span> <span class="main">≃</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ye1</span> <span class="main">≥</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IntegerLessThanNode a b c d l no_encoding not_excluded_keep_type repDet singletonD
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_binary</span> <span class="quoted">IntegerLessThanNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> BinaryExpr BinIntegerLessThan <span class="bound">xe2</span> <span class="bound">ye2</span><span class="main">)</span> <span class="main">∧</span> BinaryExpr BinIntegerLessThan <span class="skolem">xe1</span> <span class="skolem">ye1</span> <span class="main">≥</span> BinaryExpr BinIntegerLessThan <span class="bound">xe2</span> <span class="bound">ye2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntegerLessThanNode.prems l mono_binary rep.IntegerLessThanNode xer<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NarrowNode <span class="skolem">n</span> <span class="skolem">inputBits</span> <span class="skolem">resultBits</span> <span class="skolem">x</span> <span class="skolem">xe1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnaryNarrow <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f NarrowNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NarrowNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.NarrowNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> NarrowNode <span class="skolem">inputBits</span> <span class="skolem">resultBits</span> <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> NarrowNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> NarrowNode.hyps<span class="main">(</span>1<span class="main">)</span> NarrowNode.hyps<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">=</span> <span class="free">n'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xe1</span> <span class="main">=</span> <span class="free">e1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c m repDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnaryNarrow <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NarrowNode.hyps<span class="main">(</span>1<span class="main">)</span> l m n
          <span class="keyword1"><span class="command">using</span></span> NarrowNode.prems True d rep.NarrowNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"UnaryExpr <span class="main">(</span>UnaryNarrow <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e1'</span> <span class="main">≥</span> UnaryExpr <span class="main">(</span>UnaryNarrow <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a mono_unary<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ev r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> NarrowNode
          <span class="keyword1"><span class="command">using</span></span> False b encodes_contains l not_excluded_keep_type not_in_g singleton_iff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_ternary</span> <span class="quoted">NarrowNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnaryNarrow <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> UnaryExpr <span class="main">(</span>UnaryNarrow <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="skolem">xe1</span> <span class="main">≥</span> UnaryExpr <span class="main">(</span>UnaryNarrow <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NarrowNode.prems l mono_unary rep.NarrowNode<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SignExtendNode <span class="skolem">n</span> <span class="skolem">inputBits</span> <span class="skolem">resultBits</span> <span class="skolem">x</span> <span class="skolem">xe1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnarySignExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f SignExtendNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SignExtendNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.SignExtendNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> SignExtendNode <span class="skolem">inputBits</span> <span class="skolem">resultBits</span> <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> SignExtendNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> SignExtendNode.hyps<span class="main">(</span>1<span class="main">)</span> SignExtendNode.hyps<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">=</span> <span class="free">n'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xe1</span> <span class="main">=</span> <span class="free">e1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c m repDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnarySignExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SignExtendNode.hyps<span class="main">(</span>1<span class="main">)</span> l m n
          <span class="keyword1"><span class="command">using</span></span> SignExtendNode.prems True d rep.SignExtendNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"UnaryExpr <span class="main">(</span>UnarySignExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e1'</span> <span class="main">≥</span> UnaryExpr <span class="main">(</span>UnarySignExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a mono_unary<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ev r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> SignExtendNode
          <span class="keyword1"><span class="command">using</span></span> False b encodes_contains l not_excluded_keep_type not_in_g singleton_iff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_ternary</span> <span class="quoted">SignExtendNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnarySignExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> UnaryExpr <span class="main">(</span>UnarySignExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="skolem">xe1</span> <span class="main">≥</span> UnaryExpr <span class="main">(</span>UnarySignExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SignExtendNode.prems l mono_unary rep.SignExtendNode<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZeroExtendNode <span class="skolem">n</span> <span class="skolem">inputBits</span> <span class="skolem">resultBits</span> <span class="skolem">x</span> <span class="skolem">xe1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnaryZeroExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f ZeroExtendNode
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ZeroExtendNode.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rep.ZeroExtendNode<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> ZeroExtendNode <span class="skolem">inputBits</span> <span class="skolem">resultBits</span> <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ZeroExtendNode.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ZeroExtendNode.hyps<span class="main">(</span>1<span class="main">)</span> ZeroExtendNode.hyps<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">=</span> <span class="free">n'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xe1</span> <span class="main">=</span> <span class="free">e1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c m repDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnaryZeroExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZeroExtendNode.hyps<span class="main">(</span>1<span class="main">)</span> l m n
          <span class="keyword1"><span class="command">using</span></span> ZeroExtendNode.prems True d rep.ZeroExtendNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"UnaryExpr <span class="main">(</span>UnaryZeroExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e1'</span> <span class="main">≥</span> UnaryExpr <span class="main">(</span>UnaryZeroExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="free">e2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a mono_unary<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ev r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="skolem">xe1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">xn</span> <span class="main">≃</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xe1</span> <span class="main">≥</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ZeroExtendNode
          <span class="keyword1"><span class="command">using</span></span> False b encodes_contains l not_excluded_keep_type not_in_g singleton_iff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis_node_eq_ternary</span> <span class="quoted">ZeroExtendNode</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xe2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> UnaryExpr <span class="main">(</span>UnaryZeroExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="bound">xe2</span><span class="main">)</span> <span class="main">∧</span> UnaryExpr <span class="main">(</span>UnaryZeroExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="skolem">xe1</span> <span class="main">≥</span> UnaryExpr <span class="main">(</span>UnaryZeroExtend <span class="skolem">inputBits</span> <span class="skolem">resultBits</span><span class="main">)</span> <span class="bound">xe2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZeroExtendNode.prems l mono_unary rep.ZeroExtendNode<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LeafNode <span class="skolem">n</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl rep.LeafNode<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
        case (UnaryExpr op xe1)
        from UnaryExpr have k: "g1 ⊢ n ≃ UnaryExpr op xe1" using f by blast
        have "¬(is_convert_node (kind g1 n))"
          using hack encodes_contains ids_some
          using e by blast
        then obtain xn where l: "embed_expr (kind g1 n) = ExprUnaryNode op xn"
          using k using unary_embed
          by blast
        then have kk: "g1 ⊢ xn ≃ xe1"
          using repDet k equal_embedded_x by blast
        then show ?thesis
        proof (cases "xn = n'")
          case True
          then have n: "xe1 = e1'" using c UnaryExpr repDet l
            using kk by presburger
          have r: "UnaryExpr op e1' ≥ UnaryExpr op e2'"
            using a mono_unary by simp
          have "g2 ⊢ n ≃ UnaryExpr op e2'" using i k UnaryExpr n d True
            using blah
            using l by presburger
          then show ?thesis
            using r UnaryExpr n by blast 
        next
          case False
          then have "g1 ⊢ xn ≃ xe1" using UnaryExpr
            by (simp add: kk)
          then have "∃ xe2. (g2 ⊢ xn ≃ xe2) ∧ xe1 ≥ xe2" sorry
          then have "∃ xe2. (g2 ⊢ n ≃ UnaryExpr op xe2) ∧ UnaryExpr op xe1 ≥ UnaryExpr op xe2"
            by (metis blah i l mono_unary)
          then show ?thesis
            using UnaryExpr by blast
        qed
      next
        case (BinaryExpr x1 e11 e12)
        then show ?thesis sorry
      next
        case (ConditionalExpr e11 e12 e13)
        then show ?thesis sorry
      next
        case (ConstantExpr x)
        then show ?thesis sorry
      next
        case (ParameterExpr x1 x2)
        then show ?thesis sorry
      next
        case (LeafExpr x1 x2)
        then show ?thesis sorry
      qed
  qed
qed
*)</span>

<span class="comment1">(*
lemma graph_semantics_preservation:
  "e1 ≥ e2 ∧ (g1 ⊢ n ≃ e1) ∧ (g2 ⊢ n ≃ e2) ∧ (({n} ⊴ as_set g1) ⊆ as_set g2) ⟹
     graph_refinement g1 g2" (is "?asm ⟹ ?con")
proof (cases "n ∈ ids g1")
  case True
  assume a: ?asm
  show ?thesis
    unfolding graph_refinement_def
  proof ((rule allI)+; (rule impI)+)
    fix n1 m p v
    assume a0: "n1 ∈ ids g1"
    assume a1: "([g1,m,p] ⊢ n1 ↦ v)"
    obtain e1 where "g1 ⊢ n1 ≃ e1"
      using a1 encodeeval_def by auto
    have same: "n1 ∉ {n} ⟹ kind g1 n1 = kind g2 n1 ∧ stamp g1 n1 = stamp g2 n1"
      using a a0 unfolding as_set_def domain_subtraction_def
      by blast
    show "([g2,m,p] ⊢ n1 ↦ v)" using a0 a1 a unfolding encodeeval_def
      apply (cases "n = n1")
      using a1 encodeeval_def le_expr_def repDet apply blast
      using same unchanged_encoding sorry
  qed
next
  case False
  assume a: ?asm
  show ?thesis (* using False unfolding graph_refinement_def as_set_def domain_subtraction_def *)
    unfolding graph_refinement_def
  proof ((rule allI)+; (rule impI)+)
    fix n m p v
    assume a0: "n ∈ ids g1"
    assume a1: "([g1,m,p] ⊢ n ↦ v)"
    have "¬(∃e. (g1 ⊢ n ≃ e))"
      using no_encoding
      by (meson False a)
    then show "([g2,m,p] ⊢ n ↦ v)" using a0 a1 a unfolding encodeeval_def
      by blast
  qed
qed
*)</span>


<span class="keyword1"><span class="command">definition</span></span> maximal_sharing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">maximal_sharing</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n1</span> <span class="bound">n2</span> <span class="main">.</span> <span class="bound">n1</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> <span class="bound">n2</span> <span class="main">∈</span> ids <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="main">∀</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="bound">n1</span> <span class="main">≃</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="bound">n2</span> <span class="main">≃</span> <span class="bound">e</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n1</span> <span class="main">=</span> <span class="bound">n2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tree_to_graph_rewriting<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> maximal_sharing <span class="free">g1</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">⊴</span> as_set <span class="free">g1</span><span class="main">)</span> <span class="main">⊆</span> as_set <span class="free">g2</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span> <span class="main">∧</span> maximal_sharing <span class="free">g2</span>
  <span class="main">⟹</span> graph_refinement <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> graph_semantics_preservation
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_trace</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemma</span></span> equal_refines<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e1</span> <span class="free">e2</span> <span class="main">::</span> <span class="quoted">IRExpr</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">=</span> <span class="free">e2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_trace</span><span class="main"><span class="main">=</span></span><span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">inductive_cases</span></span> UnaryRepE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="main">(</span>UnaryExpr <span class="free">op</span> <span class="free">xe</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> BinaryRepE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="main">(</span>BinaryExpr <span class="free">op</span> <span class="free">xe</span> <span class="free">ye</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subset_implies_evals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"as_set <span class="free">g1</span> <span class="main">⊆</span> as_set <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>UnaryExpr <span class="skolem">op</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> UnaryExpr UnaryRepE
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> AbsNode LogicNegationNode NarrowNode NegateNode NotNode SignExtendNode ZeroExtendNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinaryExpr <span class="skolem">op</span> <span class="skolem">e1</span> <span class="skolem">e2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> BinaryExpr BinaryRepE
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> AddNode MulNode SubNode AndNode OrNode XorNode IntegerBelowNode IntegerEqualsNode IntegerLessThanNode<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConditionalExpr <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">e3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ConditionalExpr ConditionalExprE
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> ConditionalNode ConditionalNodeE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstantExpr <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ConstantExpr ConstantExprE
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConstantNode ConstantNodeE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ParameterExpr <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> kinds<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> in_g1 <span class="keyword1"><span class="command">have</span></span> stamps<span class="main">:</span> <span class="quoted"><span class="quoted">"stamp <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> stamp <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> kinds stamps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ParameterExpr ParameterExprE
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParameterNode ParameterNodeE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LeafExpr <span class="skolem">nid</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> kinds<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> in_g1 <span class="keyword1"><span class="command">have</span></span> stamps<span class="main">:</span> <span class="quoted"><span class="quoted">"stamp <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> stamp <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> kinds stamps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> LeafExpr LeafExprE LeafNode 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> IRExpr.distinct<span class="main"><span class="main">(</span></span>29<span class="main"><span class="main">)</span></span> IRExpr.simps<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span> IRExpr.simps<span class="main"><span class="main">(</span></span>28<span class="main"><span class="main">)</span></span> rep.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstantVar <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> kinds<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> in_g1 <span class="keyword1"><span class="command">have</span></span> stamps<span class="main">:</span> <span class="quoted"><span class="quoted">"stamp <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> stamp <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> kinds stamps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ConstantVar
    <span class="keyword1"><span class="command">using</span></span> rep.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VariableExpr <span class="skolem">x</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_encoding <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> kinds<span class="main">:</span> <span class="quoted"><span class="quoted">"kind <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> kind <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> in_g1 <span class="keyword1"><span class="command">have</span></span> stamps<span class="main">:</span> <span class="quoted"><span class="quoted">"stamp <span class="free">g1</span> <span class="skolem">n</span> <span class="main">=</span> stamp <span class="free">g2</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> kinds stamps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> VariableExpr
    <span class="keyword1"><span class="command">using</span></span> rep.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> subset_refines<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"as_set <span class="free">g1</span> <span class="main">⊆</span> as_set <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"graph_refinement <span class="free">g1</span> <span class="free">g2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ids <span class="free">g1</span> <span class="main">⊆</span> ids <span class="free">g2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> as_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> graph_refinement_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">e1</span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> ids <span class="free">g1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> <span class="skolem">e1</span>"</span></span>
  
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="skolem">n</span> <span class="main">≃</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e1</span> <span class="main">≥</span> <span class="bound">e2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms 1 2 <span class="keyword1"><span class="command">using</span></span> subset_implies_evals
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> equal_refines<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> graph_construction<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≥</span> <span class="free">e2</span>
  <span class="main">∧</span> as_set <span class="free">g1</span> <span class="main">⊆</span> as_set <span class="free">g2</span> <span class="main">∧</span> maximal_sharing <span class="free">g1</span>
  <span class="main">∧</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">≃</span> <span class="free">e2</span><span class="main">)</span> <span class="main">∧</span> maximal_sharing <span class="free">g2</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="free">g2</span> <span class="main">⊢</span> <span class="free">n</span> <span class="main">⊴</span> <span class="free">e1</span><span class="main">)</span> <span class="main">∧</span> graph_refinement <span class="free">g1</span> <span class="free">g2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subset_refines
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> encodeeval_def graph_represents_expression_def le_expr_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>
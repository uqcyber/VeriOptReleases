<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory IREval</title>
</head>


<body>
<div class="head">
<h1>Theory IREval</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Data-flow Semantics›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IREval
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Graph/IRGraph.html">Graph.IRGraph</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We define the semantics of data-flow nodes as big-step operational semantics.

Data-flow nodes are evaluated in the context of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">IRGraph</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and a method state
(currently called MapState in the theories for historical reasons).

The method state consists of the values for each method parameter, references to
method parameters use an index of the parameter wihtin the parameter list, as such
we store a list of parameter values which are looked up at parameter references.

The method state also stores a mapping of node ids to values. The contents of this
mapping is calculates during the traversal of the control flow graph.

As a concrete example, as the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">SignedDivNode</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can have side-effects
(during division by zero), it is treated part of the control-flow as the data-flow 
is specified to be side-effect free.
As a result, the control-flow semantics for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">SignedDivNode</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> calculates the value of a node
and maps the node identifier to the value within the method state.
The data-flow semantics then just reads the value stored in the method state for the node.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> MapState <span class="main">=</span> <span class="quoted"><span class="quoted">"ID <span class="main">⇒</span> Value"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Params <span class="main">=</span> <span class="quoted"><span class="quoted">"Value list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">new_map_state</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"MapState"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">new_map_state</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> UndefVal<span class="main">)</span>"</span></span>


<span class="comment1">(* TODO: move the following phi helpers to step semantics? *)</span>
<span class="comment1">(* Yoinked from https://www.isa-afp.org/browser_info/Isabelle2012/HOL/List-Index/List_Index.html*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">find_index</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">find_index</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">find_index</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">find_index</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">phi_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> ID list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">phi_list</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">=</span> 
    <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span>is_PhiNode <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>sorted_list_of_set <span class="main">(</span>usages <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">input_index</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> ID <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">input_index</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">=</span> find_index <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">(</span>inputs_of <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">phi_inputs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> nat <span class="main">⇒</span> ID list <span class="main">⇒</span> ID list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">phi_inputs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes</span></span></span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>inputs_of <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nodes</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">set_phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ID list <span class="main">⇒</span> Value list <span class="main">⇒</span> MapState <span class="main">⇒</span> MapState"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set_phis</span> <span class="main">[]</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">set_phis</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">set_phis</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">set_phis</span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">set_phis</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> MapState <span class="main">⇒</span> Params <span class="main">⇒</span> IRNode <span class="main">⇒</span> Value <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">]</span> <span class="keyword1">⊢</span> _ <span class="keyword1">↦</span> _"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">g</span> <span class="entity">m</span> <span class="entity">p</span> <span class="keyword2"><span class="keyword">where</span></span>

  ConstantNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>ConstantNode <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span> <span class="main">|</span>

  ParameterNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>ParameterNode <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free">p</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span> <span class="main">|</span>

  ValuePhiNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>ValuePhiNode <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free">m</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  ValueProxyNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>ValueProxyNode <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> <span class="main">|</span>

  <span class="comment1">― ‹Unary arithmetic operators›</span>

  AbsNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>AbsNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span>intval_sub <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">(</span>IntVal32 <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>IntVal32 <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>

  NegateNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>NegateNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>

  NotNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">nv</span></span></span> <span class="main">=</span> intval_not <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>NotNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">nv</span></span></span>"</span></span> <span class="main">|</span>
    
  <span class="comment1">― ‹Binary arithmetic operators›</span>

  AddNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>AddNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span>"</span></span> <span class="main">|</span>

  SubNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>SubNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span>"</span></span> <span class="main">|</span>

  MulNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>MulNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span>"</span></span> <span class="main">|</span>

  SignedDivNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>SignedDivNode <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free">m</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  SignedRemNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>SignedRemNode <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free">m</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  <span class="comment1">― ‹Binary logical bitwise operators›</span>

  AndNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>AndNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> intval_and  <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span>"</span></span> <span class="main">|</span>

  OrNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>OrNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> intval_or <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span>"</span></span> <span class="main">|</span>

  XorNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>XorNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> intval_xor <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span>"</span></span> <span class="main">|</span>

  <span class="comment1">― ‹Comparison operators›</span>
<span class="comment1">(* NOTE: if we use IntVal(bool_to_int(v1=v2)), then code generation does not work! *)</span>
  IntegerEqualsNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">=</span> bool_to_val<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>IntegerEqualsNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> <span class="main">|</span>

  IntegerLessThanNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">=</span> bool_to_val<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>IntegerLessThanNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> <span class="main">|</span>

  IsNullNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">obj</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> ObjRef <span class="free"><span class="bound"><span class="entity">ref</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">=</span> bool_to_val<span class="main">(</span><span class="free"><span class="bound"><span class="entity">ref</span></span></span> <span class="main">=</span> None<span class="main">)</span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>IsNullNode <span class="free"><span class="bound"><span class="entity">obj</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> <span class="main">|</span>

  <span class="comment1">― ‹Other nodes›</span>
<span class="comment1">(* Note that both branches are evaluated but only one is used.
   This is not an issue as evaluation is total (but may return UnDef) *)</span>

  ConditionalNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">condition</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">cond</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">trueExp</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">trueVal</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">falseExp</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">falseVal</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="free"><span class="bound"><span class="entity">cond</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">trueVal</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">falseVal</span></span></span><span class="main">)</span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>ConditionalNode <span class="free"><span class="bound"><span class="entity">condition</span></span></span> <span class="free"><span class="bound"><span class="entity">trueExp</span></span></span> <span class="free"><span class="bound"><span class="entity">falseExp</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> <span class="main">|</span>

<span class="comment1">(* Note that v2 may evaluate to UnDef but is not used if v1 is true *)</span>

  ShortCircuitOrNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>ShortCircuitOrNode <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> <span class="main">|</span>

  LogicNegationNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> IntVal32 <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">neg_v1</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">=</span> bool_to_val <span class="free"><span class="bound"><span class="entity">neg_v1</span></span></span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>LogicNegationNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> <span class="main">|</span>

<span class="comment1">(* Access the value returned by the most recent call *)</span>
  InvokeNodeEval<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>InvokeNode <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free">m</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  InvokeWithExceptionNodeEval<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>InvokeWithExceptionNode <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free">m</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  NewInstanceNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>NewInstanceNode <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free">m</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  LoadFieldNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>LoadFieldNode <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free">m</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span>"</span></span> <span class="main">|</span>

  <span class="comment1">(*TODO: Unclear how we should handle PiNode yet*)</span>
  PiNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">object</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>PiNode <span class="free"><span class="bound"><span class="entity">object</span></span></span> <span class="free"><span class="bound"><span class="entity">guard</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> <span class="main">|</span>

  RefNode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>RefNode <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span> i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool as evalE<span class="main">)</span> <span class="quoted"><span class="quoted">eval</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The step semantics for phi nodes requires all the input nodes of the
phi node to be evaluated to a value at the same time.

We introduce the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">eval_all</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> relation to handle the evaluation
of a list of node identifiers in parallel. As the evaluation semantics
are side-effect free this is trivial.
›</span></span>
<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">eval_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> MapState <span class="main">⇒</span> Params <span class="main">⇒</span> ID list <span class="main">⇒</span> Value list <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">]</span> <span class="keyword1">⊢</span> _ <span class="keyword1">⟼</span> _"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">g</span> <span class="entity">m</span> <span class="entity">p</span> <span class="keyword2"><span class="keyword">where</span></span>
  Base<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">[]</span> <span class="main"><span class="free">⟼</span></span> <span class="main">[]</span>"</span></span> <span class="main">|</span>

  Transitive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span><span class="main">)</span> <span class="main">↦</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span>
    <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">⟼</span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main"><span class="free">[</span></span><span class="free">g</span><span class="main"><span class="free">,</span></span> <span class="free">m</span><span class="main"><span class="free">,</span></span> <span class="free">p</span><span class="main"><span class="free">]</span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main"><span class="free">⟼</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span> i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool as eval_allE<span class="main">)</span> <span class="quoted"><span class="quoted">eval_all</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="comment1">(* Test the eval predicates. *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">eval_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> Value list <span class="main">⇒</span> Value <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span> new_map_state<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span><span class="main">)</span> <span class="main">↦</span> <span class="free"><span class="bound"><span class="entity">val</span></span></span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">eval_graph</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span> i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted"><span class="quoted">"eval_graph"</span></span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="comment1">(* 5*5 ⇒ 25 *)</span>
<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> eval_graph eg2_sq <span class="numeral">4</span> <span class="main">[</span>IntVal32 <span class="numeral">5</span><span class="main">]</span> <span class="bound">v</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">has_control_flow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRNode <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">has_control_flow</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span>is_AbstractEndNode <span class="free"><span class="bound"><span class="entity">n</span></span></span>
    <span class="main">∨</span> <span class="main">(</span>length <span class="main">(</span>successors_of <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">control_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRNode set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">control_nodes</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span> <span class="main">.</span> has_control_flow <span class="bound">n</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_floating_node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRNode <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_floating_node</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span>has_control_flow <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">floating_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRNode set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">floating_nodes</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span> <span class="main">.</span> is_floating_node <span class="bound">n</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_floating_node <span class="free">n</span> <span class="main">⟷</span> <span class="main">¬</span><span class="main">(</span>has_control_flow <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> control_nodes <span class="main">⟷</span> <span class="free">n</span> <span class="main">∉</span> floating_nodes"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> control_nodes_def floating_nodes_def<span class="main">)</span>

<span class="comment1">(* nodeout: isabelle-inductive-cases *)</span>
<span class="keyword1"><span class="command">inductive_cases</span></span> AbsNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>AbsNode <span class="free">value</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> AddNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>AddNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> AndNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>AndNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> BeginNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>BeginNode <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> BytecodeExceptionNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>BytecodeExceptionNode <span class="free">arguments</span> <span class="free">stateAfter</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ConditionalNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>ConditionalNode <span class="free">condition</span> <span class="free">trueValue</span> <span class="free">falseValue</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ConstantNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>ConstantNode <span class="free">const</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> DynamicNewArrayNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>DynamicNewArrayNode <span class="free">elementType</span> <span class="free">length0</span> <span class="free">voidClass</span> <span class="free">stateBefore</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> EndNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>EndNode<span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ExceptionObjectNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>ExceptionObjectNode <span class="free">stateAfter</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> FrameStateE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>FrameState <span class="free">monitorIds</span> <span class="free">outerFrameState</span> <span class="free">values</span> <span class="free">virtualObjectMappings</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> IfNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>IfNode <span class="free">condition</span> <span class="free">trueSuccessor</span> <span class="free">falseSuccessor</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> IntegerEqualsNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>IntegerEqualsNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> IntegerLessThanNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>IntegerLessThanNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> InvokeNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>InvokeNode <span class="free">nid0</span> <span class="free">callTarget</span> <span class="free">classInit</span> <span class="free">stateDuring</span> <span class="free">stateAfter</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> InvokeWithExceptionNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>InvokeWithExceptionNode <span class="free">nid0</span> <span class="free">callTarget</span> <span class="free">classInit</span> <span class="free">stateDuring</span> <span class="free">stateAfter</span> <span class="free">next</span> <span class="free">exceptionEdge</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> IsNullNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>IsNullNode <span class="free">value</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> KillingBeginNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>KillingBeginNode <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> LoadFieldNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>LoadFieldNode <span class="free">nid0</span> <span class="free">field</span> <span class="free">object</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> LogicNegationNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>LogicNegationNode <span class="free">value</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> LoopBeginNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>LoopBeginNode <span class="free">ends</span> <span class="free">overflowGuard</span> <span class="free">stateAfter</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> LoopEndNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>LoopEndNode <span class="free">loopBegin</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> LoopExitNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>LoopExitNode <span class="free">loopBegin</span> <span class="free">stateAfter</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> MergeNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>MergeNode <span class="free">ends</span> <span class="free">stateAfter</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> MethodCallTargetNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>MethodCallTargetNode <span class="free">targetMethod</span> <span class="free">arguments</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> MulNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>MulNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> NegateNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>NegateNode <span class="free">value</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> NewArrayNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>NewArrayNode <span class="free">length0</span> <span class="free">stateBefore</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> NewInstanceNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>NewInstanceNode <span class="free">nid0</span> <span class="free">instanceClass</span> <span class="free">stateBefore</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> NotNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>NotNode <span class="free">value</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> OrNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>OrNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ParameterNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>ParameterNode <span class="free">index</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> PiNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>PiNode <span class="free">object</span> <span class="free">guard</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ReturnNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>ReturnNode <span class="free">result</span> <span class="free">memoryMap</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ShortCircuitOrNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>ShortCircuitOrNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> SignedDivNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>SignedDivNode <span class="free">nid0</span> <span class="free">x</span> <span class="free">y</span> <span class="free">zeroCheck</span> <span class="free">stateBefore</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> SignedRemNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>SignedRemNode <span class="free">nid0</span> <span class="free">x</span> <span class="free">y</span> <span class="free">zeroCheck</span> <span class="free">stateBefore</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> StartNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>StartNode <span class="free">stateAfter</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> StoreFieldNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>StoreFieldNode <span class="free">nid0</span> <span class="free">field</span> <span class="free">value</span> <span class="free">stateAfter</span> <span class="free">object</span> <span class="free">next</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> SubNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>SubNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> UnwindNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>UnwindNode <span class="free">exception</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ValuePhiNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>ValuePhiNode <span class="free">nid0</span> <span class="free">values</span> <span class="free">merge</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ValueProxyNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>ValueProxyNode <span class="free">value</span> <span class="free">loopExit</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> XorNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>XorNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> NoNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>NoNode<span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>
<span class="comment1">(* nodeout *)</span>


<span class="keyword1"><span class="command">inductive_cases</span></span> RefNodeE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">✐<span class="quoted">‹tag invisible›</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>RefNode <span class="free">ref</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>


<span class="keyword1"><span class="command">lemmas</span></span> EvalE<span class="comment1">✐<span class="quoted">‹tag invisible›</span></span> <span class="main">=</span> 
EndNodeE
LoopEndNodeE
LoadFieldNodeE
StoreFieldNodeE
NewInstanceNodeE
NewArrayNodeE
DynamicNewArrayNodeE
BeginNodeE
KillingBeginNodeE
LoopExitNodeE
MergeNodeE
LoopBeginNodeE
StartNodeE
ReturnNodeE
IfNodeE
ParameterNodeE
ValueProxyNodeE
ValuePhiNodeE
ConstantNodeE
ConditionalNodeE
NotNodeE
NegateNodeE
LogicNegationNodeE
AbsNodeE
AddNodeE
XorNodeE
AndNodeE
SubNodeE
MulNodeE
OrNodeE
ShortCircuitOrNodeE
IntegerEqualsNodeE
IntegerLessThanNodeE
FrameStateE
MethodCallTargetNodeE
InvokeNodeE
SignedDivNodeE
SignedRemNodeE
ExceptionObjectNodeE
InvokeWithExceptionNodeE
BytecodeExceptionNodeE
UnwindNodeE
RefNodeE
IsNullNodeE
PiNodeE
NoNodeE


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here we show that using the elimination rules for eval we can
prove 'inverted rule' properties
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"evalAddNode"</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>AddNode <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="free">val</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span> <span class="bound">v1</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">↦</span> <span class="bound">v1</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span> <span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>kind <span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">↦</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">∧</span>
       <span class="free">val</span> <span class="main">=</span> intval_add <span class="bound">v1</span> <span class="bound">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AddNodeE plus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> not_floating<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> <span class="main">(</span>successors_of <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span>is_floating_node <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_floating_node.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We show that within the context of a graph and method state, the same
node will always evaluate to the same value and the semantics is therefore deterministic.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> evalDet<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">node</span> <span class="main">↦</span> <span class="free">val1</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">∀</span> <span class="bound">val2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">node</span> <span class="main">↦</span> <span class="bound">val2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">val1</span> <span class="main">=</span> <span class="bound">val2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> <span class="quoted">"eval.induct"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> EvalE<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">theorem</span></span> evalAllDet<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">nodes</span> <span class="main">⟼</span> <span class="free">vals1</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">∀</span> <span class="bound">vals2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">nodes</span> <span class="main">⟼</span> <span class="bound">vals2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">vals1</span> <span class="main">=</span> <span class="bound">vals2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> <span class="quoted">"eval_all.induct"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> eval_all.cases <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> evalDet eval_all.cases list.discI list.inject<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</body>

</html>
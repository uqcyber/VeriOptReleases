<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Traversal</title>
</head>


<body>
<div class="head">
<h1>Theory Traversal</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Control-flow Graph Traversal</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span>
  </span><span>Traversal</span><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span>
  </span><a href="IRGraph.html"><span>IRGraph</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>type_synonym</span></span></span><span> </span><span class="entity_def" id="Traversal.Seen|type"><span>Seen</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IRNodes.html#IRNodes.ID|type"><span>ID</span></a><span> </span><span>set</span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>
</span><span>nextEdge helps determine which node to traverse next by returning the first successor
</span><span>edge that isn't in the set of already visited nodes.
</span><span>If there is not an appropriate successor, None is returned instead.</span><span>
</span><span>›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Traversal.nextEdge.elims|fact"><span class="entity_def" id="Traversal.nextEdge.induct|fact"><span class="entity_def" id="Traversal.nextEdge.simps|fact"><span class="entity_def" id="Traversal.nextEdge.pelims|fact"><span class="entity_def" id="Traversal.nextEdge.cases|fact"><span class="entity_def" id="Traversal.nextEdge.termination|fact"><span class="entity_def" id="Traversal.nextEdge.pinduct|fact"><span class="entity_def" id="Traversal.nextEdge.psimps|fact"><span class="entity_def" id="Traversal.nextEdge_rel.inducts|fact"><span class="entity_def" id="Traversal.nextEdge_rel.simps|fact"><span class="entity_def" id="Traversal.nextEdge_rel.induct|fact"><span class="entity_def" id="Traversal.nextEdge_rel.cases|fact"><span class="entity_def" id="Traversal.nextEdge_rel.intros|fact"><span class="entity_def" id="Traversal.nextEdge_graph.inducts|fact"><span class="entity_def" id="Traversal.nextEdge_graph.simps|fact"><span class="entity_def" id="Traversal.nextEdge_graph.induct|fact"><span class="entity_def" id="Traversal.nextEdge_graph.cases|fact"><span class="entity_def" id="Traversal.nextEdge_graph.intros|fact"><span class="entity_def" id="Traversal.nextEdge.elims|thm"><span class="entity_def" id="Traversal.nextEdge.induct|thm"><span class="entity_def" id="Traversal.nextEdge.simps|thm"><span class="entity_def" id="Traversal.nextEdge.pelims|thm"><span class="entity_def" id="Traversal.nextEdge.cases|thm"><span class="entity_def" id="Traversal.nextEdge.termination|thm"><span class="entity_def" id="Traversal.nextEdge.pinduct|thm"><span class="entity_def" id="Traversal.nextEdge.psimps|thm"><span class="entity_def" id="Traversal.nextEdge_rel.inducts|thm"><span class="entity_def" id="Traversal.nextEdge_rel.simps|thm"><span class="entity_def" id="Traversal.nextEdge_rel.induct|thm"><span class="entity_def" id="Traversal.nextEdge_rel.cases|thm"><span class="entity_def" id="Traversal.nextEdge_graph.inducts|thm"><span class="entity_def" id="Traversal.nextEdge_graph.simps|thm"><span class="entity_def" id="Traversal.nextEdge_graph.induct|thm"><span class="entity_def" id="Traversal.nextEdge_graph.cases|thm"><span class="entity_def" id="Traversal.nextEdge_graph.intros|thm"><span class="entity_def" id="Traversal.nextEdge_def|axiom"><span class="entity_def" id="Traversal.nextEdge_rel_def|axiom"><span class="entity_def" id="Traversal.nextEdge_sumC_def|axiom"><span class="entity_def" id="Traversal.nextEdge_graph_def|axiom"><span class="entity_def" id="Traversal.nextEdge_dom|const"><span class="entity_def" id="Traversal.nextEdge_rel|const"><span class="entity_def" id="Traversal.nextEdge_sumC|const"><span class="entity_def" id="Traversal.nextEdge_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Traversal.nextEdge|const"><span>nextEdge</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Traversal.html#Traversal.Seen|type"><span>Seen</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="IRNodes.html#IRNodes.ID|type"><span>ID</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="IRGraph.html#IRGraph.IRGraph|type"><span>IRGraph</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="IRNodes.html#IRNodes.ID|type"><span>ID</span></a><span> </span><span>option</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>nextEdge</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> 
    </span><span class="main"><span>(</span></span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>nids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>nid'</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>nid'</span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IRNodes.html#IRNodes.successors_of|const"><span>successors_of</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>in</span></span><span> 
     </span><span class="main"><span>(</span></span><span class="keyword1"><span>if</span></span><span> </span><span>length</span><span> </span><span class="bound"><span>nids</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="keyword1"><span>then</span></span><span> </span><span>Some</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="bound"><span>nids</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>else</span></span><span> </span><span>None</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>
</span><span>pred determines which node, if any, acts as the predecessor of another.
</span><span>
</span><span>Merge nodes represent a special case where-in the predecessor exists as
</span><span>an input edge of the merge node, to simplify the traversal we treat only
</span><span>the first input end node as the predecessor, ignoring that multiple nodes
</span><span>may act as a successor.
</span><span>
</span><span>For all other nodes, the predecessor is the first element of the predecessors set.
</span><span>Note that in a well-formed graph there should only be one element in the predecessor set.</span><span>›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Traversal.pred.elims|fact"><span class="entity_def" id="Traversal.pred.induct|fact"><span class="entity_def" id="Traversal.pred.simps|fact"><span class="entity_def" id="Traversal.pred.pelims|fact"><span class="entity_def" id="Traversal.pred.cases|fact"><span class="entity_def" id="Traversal.pred.termination|fact"><span class="entity_def" id="Traversal.pred.pinduct|fact"><span class="entity_def" id="Traversal.pred.psimps|fact"><span class="entity_def" id="Traversal.pred_rel.inducts|fact"><span class="entity_def" id="Traversal.pred_rel.simps|fact"><span class="entity_def" id="Traversal.pred_rel.induct|fact"><span class="entity_def" id="Traversal.pred_rel.cases|fact"><span class="entity_def" id="Traversal.pred_rel.intros|fact"><span class="entity_def" id="Traversal.pred_graph.inducts|fact"><span class="entity_def" id="Traversal.pred_graph.simps|fact"><span class="entity_def" id="Traversal.pred_graph.induct|fact"><span class="entity_def" id="Traversal.pred_graph.cases|fact"><span class="entity_def" id="Traversal.pred_graph.intros|fact"><span class="entity_def" id="Traversal.pred.elims|thm"><span class="entity_def" id="Traversal.pred.induct|thm"><span class="entity_def" id="Traversal.pred.simps|thm"><span class="entity_def" id="Traversal.pred.pelims|thm"><span class="entity_def" id="Traversal.pred.cases|thm"><span class="entity_def" id="Traversal.pred.termination|thm"><span class="entity_def" id="Traversal.pred.pinduct|thm"><span class="entity_def" id="Traversal.pred.psimps|thm"><span class="entity_def" id="Traversal.pred_rel.inducts|thm"><span class="entity_def" id="Traversal.pred_rel.simps|thm"><span class="entity_def" id="Traversal.pred_rel.induct|thm"><span class="entity_def" id="Traversal.pred_rel.cases|thm"><span class="entity_def" id="Traversal.pred_graph.inducts|thm"><span class="entity_def" id="Traversal.pred_graph.simps|thm"><span class="entity_def" id="Traversal.pred_graph.induct|thm"><span class="entity_def" id="Traversal.pred_graph.cases|thm"><span class="entity_def" id="Traversal.pred_graph.intros|thm"><span class="entity_def" id="Traversal.pred_def|axiom"><span class="entity_def" id="Traversal.pred_rel_def|axiom"><span class="entity_def" id="Traversal.pred_sumC_def|axiom"><span class="entity_def" id="Traversal.pred_graph_def|axiom"><span class="entity_def" id="Traversal.pred_dom|const"><span class="entity_def" id="Traversal.pred_rel|const"><span class="entity_def" id="Traversal.pred_sumC|const"><span class="entity_def" id="Traversal.pred_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Traversal.pred|const"><span>pred</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IRGraph.html#IRGraph.IRGraph|type"><span>IRGraph</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="IRNodes.html#IRNodes.ID|type"><span>ID</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="IRNodes.html#IRNodes.ID|type"><span>ID</span></a><span> </span><span>option</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>pred</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="keyword1"><span>of</span></span><span>
    </span><span class="main"><span>(</span></span><span>MergeNode </span><span class="bound"><span>ends</span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>Some</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="bound"><span>ends</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span>⇒</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="keyword1"><span>if</span></span><span> </span><a class="entity_ref" href="IRGraph.html#IRGraph.predecessors|const"><span>IRGraph.predecessors</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{}</span></span><span> 
        </span><span class="keyword1"><span>then</span></span><span> </span><span>None</span><span> </span><span class="keyword1"><span>else</span></span><span>
        </span><span>Some</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span>sorted_list_of_set</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IRGraph.html#IRGraph.predecessors|const"><span>IRGraph.predecessors</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>
</span><span>Here we try to implement a generic fork of the control-flow traversal algorithm
</span><span>that was initially implemented for the ConditionalElimination phase</span><span>
</span><span>›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>type_synonym</span></span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="entity_def" id="Traversal.TraversalState|type"><span>TraversalState</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IRNodes.html#IRNodes.ID|type"><span>ID</span></a><span> </span><span class="main"><span>×</span></span><span> </span><a class="entity_ref" href="Traversal.html#Traversal.Seen|type"><span>Seen</span></a><span> </span><span class="main"><span>×</span></span><span> </span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Traversal.Step.inducts|fact"><span class="entity_def" id="Traversal.Step.simps|fact"><span class="entity_def" id="Traversal.Step.induct|fact"><span class="entity_def" id="Traversal.Step.cases|fact"><span class="entity_def" id="Traversal.Step.intros|fact"><span class="entity_def" id="Traversal.Step.inducts|thm"><span class="entity_def" id="Traversal.Step.simps|thm"><span class="entity_def" id="Traversal.Step.induct|thm"><span class="entity_def" id="Traversal.Step.cases|thm"><span class="entity_def" id="Traversal.Step.intros(5)|thm"><span class="entity_def" id="Traversal.Step.intros(4)|thm"><span class="entity_def" id="Traversal.Step.intros(3)|thm"><span class="entity_def" id="Traversal.Step.intros(2)|thm"><span class="entity_def" id="Traversal.Step.intros(1)|thm"><span class="entity_def" id="Traversal.Step_def|axiom"><span>inductive</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Traversal.Step|const"><span>Step</span></span></span><span> 
  </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Traversal.html#Traversal.TraversalState|type"><span>TraversalState</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="IRGraph.html#IRGraph.IRGraph|type"><span>IRGraph</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Traversal.html#Traversal.TraversalState|type"><span>TraversalState</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Traversal.html#Traversal.TraversalState|type"><span>TraversalState</span></a><span> </span><span>option</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="entity"><span>sa</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹
  </span><span>Hit a BeginNode with an IfNode predecessor which represents
</span><span>  the start of a basic block for the IfNode.
</span><span>     1. nid' will be the successor of the begin node.
</span><span>     2. Find the first and only predecessor.
</span><span>     3. Extract condition from the preceding IfNode.
</span><span>     4. Negate condition if the begin node is second branch
</span><span>        (we've taken the else branch of the condition)
</span><span>     5. Add the condition or the negated condition to stack
</span><span>     6. Perform any stamp updates based on the condition using
</span><span>        the registerNewCondition function and place them on the
</span><span>        top of the stack of stamp information</span><span>
  ›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IRNodes.html#IRNodes.IRNode.BeginNode|const"><span>BeginNode</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid'</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span>Some</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ifcond</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Traversal.html#Traversal.pred|const"><span>pred</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ifcond</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IRNodes.html#IRNodes.IRNode.IfNode|const"><span>IfNode</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>cond</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>t</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="free"><span class="bound"><span class="entity"><span>analysis'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>sa</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>⟧</span></span><span>
   </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Step</span></span><span> </span><span class="free"><span>sa</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Some</span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid'</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis'</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>

  </span><span class="comment1"><span>― ‹
  </span><span>Hit an EndNode
</span><span>     1. nid' will be the usage of EndNode
</span><span>     2. pop the conditions and stamp stack</span><span>
  ›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IRNodes.html#IRNodes.IRNode.EndNode|const"><span>EndNode</span></a><span class="main"><span>;</span></span><span>

    </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="free"><span class="bound"><span class="entity"><span>nid'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IRGraph.html#IRGraph.any_usage|const"><span>any_usage</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="free"><span class="bound"><span class="entity"><span>analysis'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>sa</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>⟧</span></span><span>
   </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Step</span></span><span> </span><span class="free"><span>sa</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Some</span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid'</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis'</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>

  </span><span class="comment1"><span>― ‹</span><span>We can find a successor edge that is not in seen, go there</span><span>›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>¬</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="IRNodeHierarchy.html#IRNodeHierarchy.is_EndNode|const"><span>is_EndNode</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>¬</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="IRNodes.html#IRNodes.IRNode.is_BeginNode|const"><span>is_BeginNode</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span>Some</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Traversal.html#Traversal.nextEdge|const"><span>nextEdge</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="free"><span>g</span></span><span class="main"><span>;</span></span><span>

    </span><span class="free"><span class="bound"><span class="entity"><span>analysis'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>sa</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>⟧</span></span><span>
   </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Step</span></span><span> </span><span class="free"><span>sa</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Some</span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid'</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis'</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>

  </span><span class="comment1"><span>― ‹</span><span>We can cannot find a successor edge that is not in seen, give back None</span><span>›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>¬</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="IRNodeHierarchy.html#IRNodeHierarchy.is_EndNode|const"><span>is_EndNode</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>¬</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="IRNodes.html#IRNodes.IRNode.is_BeginNode|const"><span>is_BeginNode</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IRGraph.html#IRGraph.kind|const"><span>kind</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span>None</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Traversal.html#Traversal.nextEdge|const"><span>nextEdge</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="free"><span>g</span></span><span class="main"><span>⟧</span></span><span>
    </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Step</span></span><span> </span><span class="free"><span>sa</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>None</span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>

  </span><span class="comment1"><span>― ‹</span><span>We've already seen this node, give back None</span><span>›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Step</span></span><span> </span><span class="free"><span>sa</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>nid</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>seen</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>analysis</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>None</span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Traversal.Step.equation|fact"><span class="entity_def" id="Traversal.Step_i_i_i_oE|fact"><span class="entity_def" id="Traversal.Step_i_i_i_oI|fact"><span class="entity_def" id="Traversal.Step_i_i_i_o_def|fact"><span class="entity_def" id="Traversal.eq.equation|fact"><span class="entity_def" id="Traversal.eq_o_iE|fact"><span class="entity_def" id="Traversal.eq_o_iI|fact"><span class="entity_def" id="Traversal.eq_o_i_def|fact"><span class="entity_def" id="Traversal.eq_i_oE|fact"><span class="entity_def" id="Traversal.eq_i_oI|fact"><span class="entity_def" id="Traversal.eq_i_o_def|fact"><span class="entity_def" id="Traversal.eq_i_iE|fact"><span class="entity_def" id="Traversal.eq_i_iI|fact"><span class="entity_def" id="Traversal.eq_i_i_def|fact"><span class="entity_def" id="Traversal.Step.equation|thm"><span class="entity_def" id="Traversal.Step_i_i_i_oE|thm"><span class="entity_def" id="Traversal.Step_i_i_i_oI|thm"><span class="entity_def" id="Traversal.Step_i_i_i_o_def|thm"><span class="entity_def" id="Traversal.eq.equation(4)|thm"><span class="entity_def" id="Traversal.eq.equation(3)|thm"><span class="entity_def" id="Traversal.eq.equation(2)|thm"><span class="entity_def" id="Traversal.eq.equation(1)|thm"><span class="entity_def" id="Traversal.eq_o_iE|thm"><span class="entity_def" id="Traversal.eq_o_iI|thm"><span class="entity_def" id="Traversal.eq_o_i_def|thm"><span class="entity_def" id="Traversal.eq_i_oE|thm"><span class="entity_def" id="Traversal.eq_i_oI|thm"><span class="entity_def" id="Traversal.eq_i_o_def|thm"><span class="entity_def" id="Traversal.eq_i_iE|thm"><span class="entity_def" id="Traversal.eq_i_iI|thm"><span class="entity_def" id="Traversal.eq_i_i_def|thm"><span class="entity_def" id="Traversal.Step_i_i_i_o_def|axiom"><span class="entity_def" id="Traversal.eq_o_i_def|axiom"><span class="entity_def" id="Traversal.eq_i_o_def|axiom"><span class="entity_def" id="Traversal.eq_i_i_def|axiom"><span class="entity_def" id="Traversal.Step_i_i_i_o|const"><span class="entity_def" id="Traversal.eq_o_i|const"><span class="entity_def" id="Traversal.eq_i_o|const"><span class="entity_def" id="Traversal.eq_i_i|const"><span>code_pred</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span>modes</span><span class="main"><span>:</span></span><span> i ⇒ i ⇒ i ⇒ o ⇒ bool</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><a class="entity_ref" href="Traversal.html#Traversal.Step|const"><span class="quoted"><a class="entity_ref" href="Traversal.html#Traversal.Step|const"><span>Step</span></a></span></a></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>
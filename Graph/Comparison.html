<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Comparison</title>
</head>


<body>
<div class="head">
<h1>Theory Comparison</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Structural Graph Comparison›</span></span>

<span class="keyword1"><span class="command">theory</span></span>
  Comparison
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="IRGraph.html">IRGraph</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We introduce a form of structural graph comparison that is able to assert structural
equivalence of graphs which differ in zero or more reference node chains for any given nodes.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">find_ref_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> <span class="main">(</span>ID <span class="main">⇀</span> ID<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">find_ref_nodes</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> map_of
  <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> ir_ref <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">id</span><span class="main">.</span> is_RefNode <span class="main">(</span>kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">id</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span>ids <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">replace_ref_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> <span class="main">(</span>ID <span class="main">⇀</span> ID<span class="main">)</span> <span class="main">⇒</span> ID list <span class="main">⇒</span> ID list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">replace_ref_nodes</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">id</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">id</span><span class="main">)</span> <span class="keyword1">of</span> Some <span class="bound">other</span> <span class="main">⇒</span> <span class="bound">other</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="bound">id</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">find_next</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ID list <span class="main">⇒</span> ID set <span class="main">⇒</span> ID option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">find_next</span> <span class="free"><span class="bound"><span class="entity">to_see</span></span></span> <span class="free"><span class="bound"><span class="entity">seen</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">nid</span><span class="main">.</span> <span class="bound">nid</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">seen</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">to_see</span></span></span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">l</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> None <span class="main">|</span> <span class="bound">xs</span> <span class="main">⇒</span> Some <span class="main">(</span>hd <span class="bound">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">reachables</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> ID list <span class="main">⇒</span> ID set <span class="main">⇒</span> ID set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">reachables</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">[]</span> <span class="main">{}</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>None <span class="main">=</span> find_next <span class="free"><span class="bound"><span class="entity">to_see</span></span></span> <span class="free"><span class="bound"><span class="entity">seen</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">reachables</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">to_see</span></span></span> <span class="free"><span class="bound"><span class="entity">seen</span></span></span> <span class="free"><span class="bound"><span class="entity">seen</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>Some <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> find_next <span class="free"><span class="bound"><span class="entity">to_see</span></span></span> <span class="free"><span class="bound"><span class="entity">seen</span></span></span><span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">node</span></span></span> <span class="main">=</span> kind <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">new</span></span></span> <span class="main">=</span> <span class="main">(</span>inputs_of <span class="free"><span class="bound"><span class="entity">node</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>successors_of <span class="free"><span class="bound"><span class="entity">node</span></span></span><span class="main">)</span><span class="main">;</span>
  <span class="free">reachables</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">to_see</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">new</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">seen</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">seen'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">reachables</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">to_see</span></span></span> <span class="free"><span class="bound"><span class="entity">seen</span></span></span> <span class="free"><span class="bound"><span class="entity">seen'</span></span></span> "</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span> i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">)</span> <span class="main">[</span>show_steps<span class="main">,</span>show_mode_inference<span class="main">,</span>show_intermediate_results<span class="main">]</span> 
<span class="quoted"><span class="quoted">reachables</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">nodeEq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ID <span class="main">⇀</span> ID<span class="main">)</span> <span class="main">⇒</span> IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> IRGraph <span class="main">⇒</span> ID <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> kind <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="main">=</span> RefNode <span class="free"><span class="bound"><span class="entity">ref</span></span></span><span class="main">;</span> <span class="free">nodeEq</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">ref</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">nodeEq</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span>"</span></span> <span class="main">|</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> kind <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span><span class="main">;</span> 
  <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> kind <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span><span class="main">;</span> 
  is_same_ir_node_type <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">;</span>
  replace_ref_nodes <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>successors_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> successors_of <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">;</span> 
  replace_ref_nodes <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>inputs_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> inputs_of <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">nodeEq</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">[</span>show_modes<span class="main">]</span> <span class="quoted"><span class="quoted">nodeEq</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">diffNodesGraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> IRGraph <span class="main">⇒</span> ID set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">diffNodesGraph</span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">refNodes</span> <span class="main">=</span> find_ref_nodes <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="keyword1">in</span>
    <span class="main">{</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> Predicate.the <span class="main">(</span>reachables_i_i_i_o <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">refNodes</span> <span class="bound">n</span> <span class="keyword1">of</span> Some <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> True<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>nodeEq <span class="bound">refNodes</span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">diffNodesInfo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> IRGraph <span class="main">⇒</span> <span class="main">(</span>ID <span class="main">×</span> IRNode <span class="main">×</span> IRNode<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">diffNodesInfo</span> <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">nid</span><span class="main">,</span> kind <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="bound">nid</span><span class="main">,</span> kind <span class="free"><span class="bound"><span class="entity">g2</span></span></span> <span class="bound">nid</span><span class="main">)</span> <span class="main">|</span> <span class="bound">nid</span> <span class="main">.</span> <span class="bound">nid</span> <span class="main">∈</span> diffNodesGraph <span class="free"><span class="bound"><span class="entity">g1</span></span></span> <span class="free"><span class="bound"><span class="entity">g2</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eqGraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"IRGraph <span class="main">⇒</span> IRGraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">eqGraph</span> <span class="free"><span class="bound"><span class="entity">isabelle_graph</span></span></span> <span class="free"><span class="bound"><span class="entity">graal_graph</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>diffNodesGraph <span class="free"><span class="bound"><span class="entity">isabelle_graph</span></span></span> <span class="free"><span class="bound"><span class="entity">graal_graph</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>
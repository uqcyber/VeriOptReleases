<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Stamp4</title>
</head>


<body>
<div class="head">
<h1>Theory Stamp4</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Stamps: Type and Range Information›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Stamp4
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Values2.html">Values2</a>
  <a href="../../HOL/HOL/Lattices.html">HOL.Lattices</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Void Stamp›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The VoidStamp represents a type with no associated values.
The VoidStamp lattice is therefore a simple single element lattice.
›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> void <span class="main">=</span>
  VoidStamp

<span class="keyword1"><span class="command">instantiation</span></span> void <span class="main">::</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_void</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"void <span class="main">⇒</span> void <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_void</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_void</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"void <span class="main">⇒</span> void <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_void</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def less_void_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> void.exhaust<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> void <span class="main">::</span> <span class="quoted">semilattice_inf</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inf_void</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"void <span class="main">⇒</span> void <span class="main">⇒</span> void"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_void</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> VoidStamp"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> void.exhaust<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> void <span class="main">::</span> <span class="quoted">semilattice_sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">sup_void</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"void <span class="main">⇒</span> void <span class="main">⇒</span> void"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_void</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> VoidStamp"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> void.exhaust<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> void <span class="main">::</span> <span class="quoted">bounded_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">bot_void</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"void"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bot_void</span> <span class="main">=</span> VoidStamp"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_void</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"void"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">top_void</span> <span class="main">=</span> VoidStamp"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_void_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition of the stamp type›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> stamp <span class="main">=</span>
  intstamp <span class="quoted">int64</span> <span class="quoted">int64</span> <span class="comment1">―‹Type: Integer; Range: Lower Bound \&amp; Upper Bound›</span>
<span class="comment1">(*
  | floatstamp ―‹Type: Float; Range: Lower Bound \&amp; Upper Bound›
  | objectstamp classname ―‹Type: Object Instance; Range: Upper Bound Superclass›
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stamp Lattice›</span></span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹\input{lattice}\\›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Stamp Order›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Defines an ordering on the stamp type.

One stamp is less than another if the valid values
for the stamp are a strict subset of the other stamp.
›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> stamp <span class="main">::</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> stamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_stamp</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">u1</span></span></span><span class="main">)</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">u1</span></span></span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> stamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_stamp</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">u1</span></span></span><span class="main">)</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">u1</span></span></span><span class="main">}</span> <span class="main">⊂</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> less_le_not_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps less_stamp.simps
  <span class="keyword1"><span class="command">using</span></span> stamp.exhaust subset_not_subset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> order_refl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps less_stamp.simps
  <span class="keyword1"><span class="command">using</span></span> dual_order.refl stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> order_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">stamp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">stamp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intstamp <span class="skolem">l1</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> intstamp <span class="skolem">l2</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l3</span></span> <span class="skolem"><span class="skolem">u3</span></span> <span class="keyword2"><span class="keyword">where</span></span> zdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> intstamp <span class="skolem">l3</span> <span class="skolem">u3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">≤</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>›</span></span> less_eq_stamp.simps xdef ydef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span> <span class="main">≤</span> <span class="main">{</span><span class="skolem">l3</span><span class="main">..</span><span class="skolem">u3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>›</span></span> less_eq_stamp.simps ydef zdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> s1 s2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">≤</span> <span class="main">{</span><span class="skolem">l3</span><span class="main">..</span><span class="skolem">u3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps
    <span class="keyword1"><span class="command">using</span></span> xdef zdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">assume</span></span> xlessy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ylessx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intstamp <span class="skolem">l1</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> intstamp <span class="skolem">l2</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">from</span></span> xlessy <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps
    <span class="keyword1"><span class="command">using</span></span> xdef ydef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ylessx <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps
    <span class="keyword1"><span class="command">using</span></span> xdef ydef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> s3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">l1</span> <span class="main">=</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="comment1">(* not true *)</span>
    <span class="comment1">(* consider: 
       {1..0} = {-1..-1}
    *)</span>
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l1</span> <span class="main">=</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xdef ydef <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s1 s2 s3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">using</span></span> less_le_not_le <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> order_refl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Stamp Join›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Defines the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹join›<span class="antiquote"><span class="antiquote">}</span></span></span></span> operation for stamps.

For any two stamps, the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹join›<span class="antiquote"><span class="antiquote">}</span></span></span></span> is defined as the intersection
of the valid values for the stamp.
›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> stamp <span class="main">::</span> <span class="quoted">semilattice_inf</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> inf <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inf_stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> stamp <span class="main">⇒</span> stamp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_stamp</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">u1</span></span></span><span class="main">)</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">)</span> <span class="main">=</span> intstamp <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">)</span> <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">u1</span></span></span> <span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_le1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intstamp <span class="skolem">l1</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> intstamp <span class="skolem">l2</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> joindef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">=</span> intstamp <span class="main">(</span>max <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?join</span> <span class="main">=</span> intstamp <span class="var">?l3</span> <span class="var">?u3</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> inf_stamp.simps xdef ydef
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?l3</span><span class="main">..</span><span class="var">?u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="var">?l3</span><span class="main">..</span><span class="var">?u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xdef joindef inf_stamp.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_le2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intstamp <span class="skolem">l1</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> intstamp <span class="skolem">l2</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> joindef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">=</span> intstamp <span class="main">(</span>max <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?join</span> <span class="main">=</span> intstamp <span class="var">?l3</span> <span class="var">?u3</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> inf_stamp.simps xdef ydef
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?l3</span><span class="main">..</span><span class="var">?u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="var">?l3</span><span class="main">..</span><span class="var">?u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ydef joindef
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_greatest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">assume</span></span> xlessy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xlessz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intstamp <span class="skolem">l1</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> intstamp <span class="skolem">l2</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l3</span></span> <span class="skolem"><span class="skolem">u3</span></span> <span class="keyword2"><span class="keyword">where</span></span> zdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> intstamp <span class="skolem">l3</span> <span class="skolem">u3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l4</span></span> <span class="skolem"><span class="skolem">u4</span></span> <span class="keyword2"><span class="keyword">where</span></span> yzdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span> <span class="main">=</span> intstamp <span class="skolem">l4</span> <span class="skolem">u4</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_stamp.elims<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> max4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l4</span> <span class="main">=</span> max <span class="skolem">l2</span> <span class="skolem">l3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yzdef ydef zdef inf_stamp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> min4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u4</span> <span class="main">=</span> min <span class="skolem">u2</span> <span class="skolem">u3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yzdef ydef zdef inf_stamp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xlessy xdef ydef
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l3</span><span class="main">..</span><span class="skolem">u3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xlessz xdef zdef
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l4</span><span class="main">..</span><span class="skolem">u4</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l3</span><span class="main">..</span><span class="skolem">u3</span><span class="main">}</span>›</span></span> max4 min4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l4</span><span class="main">..</span><span class="skolem">u4</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xdef yzdef<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">using</span></span> inf_le1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> inf_le2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> inf_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Stamp Meet›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Defines the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹meet›<span class="antiquote"><span class="antiquote">}</span></span></span></span> operation for stamps.

For any two stamps, the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹meet›<span class="antiquote"><span class="antiquote">}</span></span></span></span> is defined as the union
of the valid values for the stamp.
›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> stamp <span class="main">::</span> <span class="quoted">semilattice_sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> stamp <span class="main">⇒</span> stamp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_stamp</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">u1</span></span></span><span class="main">)</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">)</span> <span class="main">=</span> intstamp <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">)</span> <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">u1</span></span></span> <span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sup_ge1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intstamp <span class="skolem">l1</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> intstamp <span class="skolem">l2</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> joindef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">=</span> intstamp <span class="main">(</span>min <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">(</span>max <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?join</span> <span class="main">=</span> intstamp <span class="var">?l3</span> <span class="var">?u3</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> inf_stamp.simps xdef ydef
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="var">?l3</span><span class="main">..</span><span class="var">?u3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="var">?l3</span><span class="main">..</span><span class="var">?u3</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xdef joindef inf_stamp.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sup_ge2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intstamp <span class="skolem">l1</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> intstamp <span class="skolem">l2</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> joindef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">=</span> intstamp <span class="main">(</span>min <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">(</span>max <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?join</span> <span class="main">=</span> intstamp <span class="var">?l3</span> <span class="var">?u3</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> inf_stamp.simps xdef ydef
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="var">?l3</span><span class="main">..</span><span class="var">?u3</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?subset_thesis</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">=</span> <span class="main">(</span><span class="var">?subset_thesis</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ydef joindef sup_stamp.simps less_eq_stamp.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Stamp4.sup_ge1 max.commute min.commute sup_stamp.elims<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sup_least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword3"><span class="command">assume</span></span> xlessy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xlessz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intstamp <span class="skolem">l1</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> intstamp <span class="skolem">l2</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l3</span></span> <span class="skolem"><span class="skolem">u3</span></span> <span class="keyword2"><span class="keyword">where</span></span> zdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> intstamp <span class="skolem">l3</span> <span class="skolem">u3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> yzdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">=</span> intstamp <span class="main">(</span>min <span class="skolem">l2</span> <span class="skolem">l3</span><span class="main">)</span> <span class="main">(</span>max <span class="skolem">u2</span> <span class="skolem">u3</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?meet</span> <span class="main">=</span> intstamp <span class="var">?l4</span> <span class="var">?u4</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> sup_stamp.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ydef zdef<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l2</span><span class="main">..</span><span class="skolem">u2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xlessy xdef ydef
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l3</span><span class="main">..</span><span class="skolem">u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xlessz xdef zdef
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?l4</span><span class="main">..</span><span class="var">?u4</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">l1</span><span class="main">..</span><span class="skolem">u1</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?subset_thesis</span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> s1 s2 <span class="keyword1"><span class="command">unfolding</span></span> atLeastatMost_subset_iff
    <span class="comment1">(* why is this such a hard proof? *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> inf.orderE inf_stamp.simps max.bounded_iff max.cobounded2 min.bounded_iff min.cobounded2 stamp.inject xdef xlessy xlessz ydef zdef<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?subset_thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yzdef xdef less_eq_stamp.simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">using</span></span> sup_ge1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> sup_ge2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> sup_least <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Stamp Bounds›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Defines the top and bottom elements of the stamp lattice.

This poses an interesting question as our stamp type is a
union of the various <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹Stamp›<span class="antiquote"><span class="antiquote">}</span></span></span></span> subclasses, e.g.
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹IntegerStamp›<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹ObjectStamp›<span class="antiquote"><span class="antiquote">}</span></span></span></span>, etc.

Each subclass should preferably have its own unique
top and bottom element, i.e. An <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹IntegerStamp›<span class="antiquote"><span class="antiquote">}</span></span></span></span>
would have the top element of the full range of integers
allowed by the bit width and a bottom of a range with no integers.
While the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹ObjectStamp›<span class="antiquote"><span class="antiquote">}</span></span></span></span> should have <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹Object›<span class="antiquote"><span class="antiquote">}</span></span></span></span>
as the top and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹Void›<span class="antiquote"><span class="antiquote">}</span></span></span></span> as the bottom element.
›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> stamp <span class="main">::</span> <span class="quoted">bounded_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">width_min</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int64"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">width_min</span> <span class="free"><span class="bound"><span class="entity">bits</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bits</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">width_max</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int64"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">width_max</span> <span class="free"><span class="bound"><span class="entity">bits</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bits</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sint <span class="main">(</span>width_min <span class="numeral">64</span><span class="main">)</span><span class="main">,</span> sint <span class="main">(</span>width_max <span class="numeral">64</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"max_word<span class="main">::</span>int64"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> width_min <span class="numeral">64</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> width_max <span class="numeral">64</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">x</span> <span class="main">&lt;</span> sint <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> width_min_def width_max_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Note that this definition is valid for unsigned integers only.

The bottom and top element for signed integers would be
(- 9223372036854775808, 9223372036854775807).

For unsigned we have
(0, 18446744073709551615).

For Java we are likely to be more concerned with signed integers.
To use the appropriate bottom and top for signed integers we
would need to change our definition of less\_eq from
{l1..u1} &lt;= {l2..u2}
to
{sint l1..sint u1} &lt;= {sint l2..sint u2}

We may still find an unsigned integer stamp useful.
I plan to investigate the Java code to see if this is useful
and then apply the changes to switch to signed integers.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">bot_stamp</span></span> <span class="main">=</span> intstamp max_word <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">top_stamp</span></span> <span class="main">=</span> intstamp <span class="main">0</span> max_word"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bot_least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊥</span><span class="main">)</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">min</span></span> <span class="skolem"><span class="skolem">max</span></span> <span class="keyword2"><span class="keyword">where</span></span> bot_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">=</span> intstamp <span class="skolem">max</span> <span class="skolem">min</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bot_stamp_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min</span> <span class="main">&lt;</span> <span class="skolem">max</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bot_def
    <span class="keyword1"><span class="command">unfolding</span></span> bot_stamp_def width_min_def width_max_def
    <span class="keyword1"><span class="command">using</span></span> word_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">max</span><span class="main">..</span><span class="skolem">min</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bot_def
    <span class="keyword1"><span class="command">unfolding</span></span> bot_stamp_def width_min_def width_max_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bot_stamp_def
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stamp.induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> top_greatest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⊤</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">min</span></span> <span class="skolem"><span class="skolem">max</span></span> <span class="keyword2"><span class="keyword">where</span></span> top_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">=</span> intstamp <span class="skolem">min</span> <span class="skolem">max</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> top_stamp_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> max_is_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="skolem">max</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stamp.inject top_def top_stamp_def word_order.extremum_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> min_is_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="skolem">min</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_less_iff_gr_or_eq stamp.inject top_def top_stamp_def word_coorder.not_eq_extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">l</span> <span class="bound">u</span><span class="main">.</span> <span class="main">{</span><span class="skolem">min</span><span class="main">..</span><span class="skolem">max</span><span class="main">}</span> <span class="main">&lt;</span> <span class="main">{</span><span class="bound">l</span><span class="main">..</span><span class="bound">u</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max_is_max min_is_min
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastatMost_psubset_iff not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> top_stamp_def
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.simps
    <span class="keyword1"><span class="command">using</span></span> less_eq_stamp.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">using</span></span> bot_least <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Java Stamp Methods›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following are methods from the Java Stamp class,
they are the methods primarily used for optimizations.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_unrestricted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_unrestricted</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_empty</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⊥</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">as_constant</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> Value option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">as_constant</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>card <span class="main">{</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>
    <span class="keyword1">then</span> Some <span class="main">(</span>IntVal64 <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">always_distinct</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> stamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">always_distinct</span> <span class="free"><span class="bound"><span class="entity">stamp1</span></span></span> <span class="free"><span class="bound"><span class="entity">stamp2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">stamp1</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">stamp2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">never_distinct</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">⇒</span> stamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">never_distinct</span> <span class="free"><span class="bound"><span class="entity">stamp1</span></span></span> <span class="free"><span class="bound"><span class="entity">stamp2</span></span></span> <span class="main">=</span> 
    <span class="main">(</span>as_constant <span class="free"><span class="bound"><span class="entity">stamp1</span></span></span> <span class="main">=</span> as_constant <span class="free"><span class="bound"><span class="entity">stamp2</span></span></span> <span class="main">∧</span> as_constant <span class="free"><span class="bound"><span class="entity">stamp1</span></span></span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Mapping to Values›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">valid_value</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stamp <span class="main">=&gt;</span> Value <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_value</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">(</span>IntVal64 <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_value</span> <span class="main">(</span>intstamp <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> valid_value<span class="antiquote"><span class="antiquote">}</span></span></span></span> function is used to map a stamp instance
to the values that are allowed by the stamp.

It would be nice if there was a slightly more integrated way
to perform this mapping as it requires some infrastructure
to prove some fairly simple properties.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> bottom_range_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>valid_value <span class="main">(</span><span class="main">⊥</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bot_stamp_def
  <span class="keyword1"><span class="command">using</span></span> valid_value.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> join_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">joined</span> <span class="main">=</span> <span class="free">x_stamp</span> <span class="main">⊓</span> <span class="free">y_stamp</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="free">joined</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span>valid_value <span class="free">x_stamp</span> <span class="free">x</span> <span class="main">∧</span> valid_value <span class="free">y_stamp</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> UndefVal
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_value.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntVal32 <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_value.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntVal64 <span class="skolem">x3</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lx</span></span> <span class="skolem"><span class="skolem">ux</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x_stamp</span> <span class="main">=</span> intstamp <span class="skolem">lx</span> <span class="skolem">ux</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ly</span></span> <span class="skolem"><span class="skolem">uy</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y_stamp</span> <span class="main">=</span> intstamp <span class="skolem">ly</span> <span class="skolem">uy</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> IntVal64 <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IntVal64 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">joined</span> <span class="main">=</span> intstamp <span class="main">(</span>max <span class="skolem">lx</span> <span class="skolem">ly</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">ux</span> <span class="skolem">uy</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">joined</span> <span class="main">=</span> intstamp <span class="var">?lj</span> <span class="var">?uj</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xdef ydef assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="free">joined</span> <span class="main">(</span>IntVal64 <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?lj</span><span class="main">..</span><span class="var">?uj</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> IntVal64 <span class="skolem">v</span>›</span></span> xdef ydef <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FloatVal <span class="skolem">x4</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_value.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ObjRef <span class="skolem">x5</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_value.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ObjStr <span class="skolem">x6</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_value.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> disjoint_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x_stamp</span> <span class="free">y_stamp</span> <span class="main">::</span> <span class="quoted">stamp</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">=</span> <span class="free">x_stamp</span> <span class="main">⊓</span> <span class="free">y_stamp</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>valid_value <span class="free">x_stamp</span> <span class="free">x</span> <span class="main">∧</span> valid_value <span class="free">y_stamp</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms bottom_range_empty join_values
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A possible equivalent alternative to the definition of less\_eq›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">less_eq_alt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ord <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_alt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">u1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">u1</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">u1</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">u2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proof equivalence›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l1</span> <span class="free">l2</span> <span class="free">u1</span> <span class="free">u2</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l1</span> <span class="main">≤</span> <span class="free">u1</span> <span class="main">∧</span> <span class="free">l2</span> <span class="main">≤</span> <span class="free">u2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">l1</span><span class="main">..</span><span class="free">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">l2</span><span class="main">..</span><span class="free">u2</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">l1</span> <span class="main">≥</span> <span class="free">l2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">u1</span> <span class="main">≤</span> <span class="free">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l1</span> <span class="free">l2</span> <span class="free">u1</span> <span class="free">u2</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">l1</span><span class="main">..</span><span class="free">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">l2</span><span class="main">..</span><span class="free">u2</span><span class="main">}</span> <span class="main">=</span> less_eq_alt <span class="main">(</span><span class="free">l1</span><span class="main">,</span> <span class="free">u1</span><span class="main">)</span> <span class="main">(</span><span class="free">l2</span><span class="main">,</span> <span class="free">u2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generic Integer Stamp›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Experimental definition of integer stamps generically,
restricting the datatype to only allow valid ranges and
the bottom integer element (max\_int..min\_int).
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">x</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_signed_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">max_signed_int</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_signed_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">min_signed_int</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">int_bottom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word <span class="main">×</span> <span class="tfree">'a</span> word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">int_bottom</span> <span class="main">=</span> <span class="main">(</span>max_signed_int<span class="main">,</span> min_signed_int<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">int_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word <span class="main">×</span> <span class="tfree">'a</span> word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">int_top</span> <span class="main">=</span> <span class="main">(</span>min_signed_int<span class="main">,</span> max_signed_int<span class="main">)</span>"</span></span>

<span class="comment1">(*
definition signed_gt_eq :: "'a::len word ⇒ 'a word ⇒ bool" where
  "signed_gt_eq a b = (sint a ≥ sint a)"

definition signed_gt :: "'a::len word ⇒ 'a word ⇒ bool" where
  "signed_gt a b = (sint a &gt; sint a)"

interpretation wor: ordering_top ‹signed_gt_eq› ‹signed_gt› ‹max_signed_int :: 'a::len word›
  apply (standard) sledgehammer
*)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">x</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sint_greater_eq <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(*
  by (smt (z3) Euclidean_Division.pos_mod_bound int_word_sint sint_0 sint_lt two_less_eq_exp_length word_of_int_2p_len)
  *)</span>

<span class="comment1">(* helpful: sint_greater_eq *)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">1</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">1</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span><span class="main">1</span> word<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_signed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">a</span> <span class="main">≤</span> sint <span class="main">(</span>max_signed_int<span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sint <span class="free">a</span> <span class="main">=</span> sint <span class="main">(</span>max_signed_int<span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">a</span> <span class="main">&lt;</span> sint <span class="main">(</span>max_signed_int<span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> max_signed_int_def <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_signed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">a</span> <span class="main">≥</span> sint <span class="main">(</span>min_signed_int<span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"max_signed_int <span class="main">::</span> <span class="numeral">32</span> word"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"int_bottom<span class="main">::</span><span class="main">(</span><span class="numeral">32</span> word <span class="main">×</span> <span class="numeral">32</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="numeral">2147483647</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="numeral">2147483648</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="quoted">len</span><span class="main">)</span> intstamp <span class="main">=</span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">bounds</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> word<span class="main">,</span> <span class="tfree">'a</span> word<span class="main">)</span> prod <span class="main">.</span> <span class="main">(</span><span class="main">(</span>fst <span class="bound">bounds</span><span class="main">)</span> <span class="keyword1">≤s</span> <span class="main">(</span>snd <span class="bound">bounds</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">bounds</span> <span class="main">=</span> int_bottom<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> mem_Collect_eq prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> signed_minus_1 sint_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_intstamp

<span class="keyword1"><span class="command">lift_definition</span></span> lower <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> intstamp <span class="main">⇒</span> <span class="tfree">'a</span> word"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"prod.fst <span class="main">∘</span> Rep_intstamp"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> upper <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> intstamp <span class="main">⇒</span> <span class="tfree">'a</span> word"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"prod.snd <span class="main">∘</span> Rep_intstamp"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> lower_int <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> intstamp <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">∘</span> prod.fst"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> upper_int <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> intstamp <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">∘</span> prod.snd"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> range <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> intstamp <span class="main">⇒</span> int set"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span>sint <span class="bound">l</span><span class="main">..</span>sint <span class="bound">u</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> bounds <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> intstamp <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Rep_intstamp</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> is_bottom <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> intstamp <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> int_bottom"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> from_bounds <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Abs_intstamp"</span></span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> intstamp <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_intstamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp <span class="main">⇒</span> <span class="tfree">'a</span> intstamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_intstamp</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">=</span> <span class="main">(</span>range <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">⊆</span> range <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_intstamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp <span class="main">⇒</span> <span class="tfree">'a</span> intstamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_intstamp</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">=</span> <span class="main">(</span>range <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">⊂</span> range <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"int_bottom<span class="main">::</span><span class="main">(</span><span class="main">1</span> word <span class="main">×</span> <span class="main">1</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">1</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">1</span> word<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"int_bottom<span class="main">::</span><span class="main">(</span><span class="numeral">2</span> word <span class="main">×</span> <span class="numeral">2</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="numeral">2</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="numeral">2</span><span class="main">::</span><span class="numeral">2</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span> <span class="main">&gt;</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bottom_is_bottom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bottom <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> boundsdef<span class="main">:</span> <span class="quoted"><span class="quoted">"bounds <span class="free">s</span> <span class="main">=</span> int_bottom"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bounds.transfer is_bottom.rep_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">min</span></span> <span class="skolem"><span class="skolem">max</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bounds <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">max</span><span class="main">,</span> <span class="skolem">min</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max</span> <span class="main">≠</span> <span class="skolem">min</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> boundsdef dual_order.eq_iff fst_conv int_bottom_def less_minus_one_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> max_signed min_signed not_less sint_0 sint_n1 snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="skolem">min</span> <span class="main">&lt;</span> sint <span class="skolem">max</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> boundsdef int_bottom_def 
    <span class="keyword1"><span class="command">using</span></span> max_signed
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹bounds <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">max</span><span class="main">,</span> <span class="skolem">min</span><span class="main">)</span>›</span></span> boundsdef int_bottom_def order.not_eq_order_implies_strict prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> signed_word_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_def bounds_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹bounds <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">max</span><span class="main">,</span> <span class="skolem">min</span><span class="main">)</span>›</span></span> bounds.transfer<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Stamp4.less_eq_intstamp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bounds_has_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> bounds_has_no_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> bottom_unique<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bottom <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">⟷</span> is_bottom <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> sint <span class="main">(</span>fst <span class="main">(</span>bounds <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> sint <span class="main">(</span>snd <span class="main">(</span>bounds <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> is_bottom <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounds_def is_bottom_def
    <span class="keyword1"><span class="command">using</span></span> Rep_intstamp
    <span class="keyword1"><span class="command">using</span></span> word_sle_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>card <span class="main">(</span>range <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> is_bottom <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_def <span class="keyword1"><span class="command">using</span></span> bounds_has_value
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounds.transfer case_prod_beta<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">min</span></span> <span class="skolem"><span class="skolem">max</span></span> <span class="keyword2"><span class="keyword">where</span></span> boundsdef<span class="main">:</span> <span class="quoted"><span class="quoted">"bounds <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">max</span><span class="main">,</span> <span class="skolem">min</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> nooverlap<span class="main">:</span> <span class="quoted"><span class="quoted">"sint <span class="skolem">min</span> <span class="main">&lt;</span> sint <span class="skolem">max</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max_signed
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bounds.transfer boundsdef fst_conv int_bottom_def is_bottom.rep_eq min_signed order.not_eq_order_implies_strict signed_word_eqI sint_0 snd_conv verit_la_disequality zero_neq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="free">s</span> <span class="main">=</span> <span class="main">{</span>sint <span class="skolem">max</span><span class="main">..</span>sint <span class="skolem">min</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounds.transfer boundsdef range.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>range <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nooverlap bounds_has_no_value <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>card <span class="main">(</span>range <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Stamp4.range <span class="free">s</span> <span class="main">=</span> <span class="main">{</span>sint <span class="skolem">max</span><span class="main">..</span>sint <span class="skolem">min</span><span class="main">}</span>›</span></span> atLeastatMost_empty less_intstamp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> card <span class="main">(</span>Stamp4.range <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> is_bottom <span class="bound">x</span>›</span></span> bottom_is_bottom leD less_eq_intstamp_def less_intstamp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> bottom_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bottom <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_bottom <span class="free">y</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_intstamp_inverse assms is_bottom.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bottom_unique False assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> int_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xlessy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ylessx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"bounds <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"bounds <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
  <span class="keyword1"><span class="command">from</span></span> xlessy <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>sint <span class="skolem">l1</span><span class="main">..</span>sint <span class="skolem">u1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>sint <span class="skolem">l2</span><span class="main">..</span>sint <span class="skolem">u2</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xlessy</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> xdef ydef <span class="keyword1"><span class="command">unfolding</span></span> bounds_def range_def less_eq_intstamp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ylessx <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>sint <span class="skolem">l2</span><span class="main">..</span>sint <span class="skolem">u2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>sint <span class="skolem">l1</span><span class="main">..</span>sint <span class="skolem">u1</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ylessx</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> xdef ydef <span class="keyword1"><span class="command">unfolding</span></span> bounds_def range_def less_eq_intstamp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_bottom <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> bottom_antisym xlessy ylessx
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_intstamp_def less_intstamp_def less_le_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_intstamp_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_intstamp_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_antisym<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"take_bit <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">63</span><span class="main">)</span> <span class="numeral">20</span><span class="main">::</span>int"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"take_bit <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">63</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">20</span><span class="main">)</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"bit <span class="main">(</span><span class="numeral">20</span><span class="main">::</span>int64<span class="main">)</span> <span class="main">(</span><span class="numeral">63</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"bit <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">20</span><span class="main">)</span><span class="main">::</span>int64<span class="main">)</span> <span class="main">(</span><span class="numeral">63</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">20</span><span class="main">)</span><span class="main">::</span>int64<span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">20</span><span class="main">::</span>int64<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"take_bit <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">63</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">20</span><span class="main">)</span><span class="main">::</span>int<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> smax <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word <span class="main">⇒</span> <span class="tfree">'a</span> word <span class="main">⇒</span> <span class="tfree">'a</span> word"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>sint <span class="bound">a</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>sint <span class="bound">b</span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">b</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> smin <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word <span class="main">⇒</span> <span class="tfree">'a</span> word <span class="main">⇒</span> <span class="tfree">'a</span> word"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>sint <span class="bound">a</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>sint <span class="bound">b</span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> intstamp <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">)</span> <span class="quoted">semilattice_inf</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> inf <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">join_bounds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp <span class="main">⇒</span> <span class="tfree">'a</span> intstamp <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">join_bounds</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">=</span> <span class="main">(</span>smax <span class="main">(</span>lower <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>lower <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">,</span> smin <span class="main">(</span>upper <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>upper <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">join_or_bottom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp <span class="main">⇒</span> <span class="tfree">'a</span> intstamp <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">join_or_bottom</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">bound</span> <span class="main">=</span> <span class="main">(</span>join_bounds <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="keyword1">in</span> 
    <span class="keyword1">if</span> sint <span class="main">(</span>fst <span class="bound">bound</span><span class="main">)</span> <span class="main">≥</span> sint <span class="main">(</span>snd <span class="bound">bound</span><span class="main">)</span> <span class="keyword1">then</span> int_bottom <span class="keyword1">else</span> <span class="bound">bound</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inf_intstamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp <span class="main">⇒</span> <span class="tfree">'a</span> intstamp <span class="main">⇒</span> <span class="tfree">'a</span> intstamp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_intstamp</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">=</span> from_bounds <span class="main">(</span>join_or_bottom <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> always_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s1</span> <span class="free">s2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Rep_intstamp <span class="main">(</span>from_bounds <span class="main">(</span>join_or_bottom <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> join_or_bottom <span class="free">s1</span> <span class="free">s2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> join_or_bottom_def join_bounds_def from_bounds_def
  <span class="keyword1"><span class="command">using</span></span> Abs_intstamp_inverse
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> from_bounds.transfer from_bounds_def mem_Collect_eq word_sle_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> invalid_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s1</span> <span class="free">s2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">bound</span> <span class="main">=</span> join_bounds <span class="free">s1</span> <span class="free">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span>fst <span class="free">bound</span><span class="main">)</span> <span class="main">≥</span> sint <span class="main">(</span>snd <span class="free">bound</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_bounds int_bottom <span class="main">=</span> <span class="free">s1</span> <span class="main">⊓</span> <span class="free">s2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> inf_intstamp_def join_or_bottom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> unfold_bounds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bounds <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>lower <span class="free">x</span><span class="main">,</span> upper <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounds.transfer lower.rep_eq upper.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> int_inf_le1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_bottom <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bottom_is_bottom<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"lower <span class="free">x</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">∧</span> upper <span class="free">x</span> <span class="main">=</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"lower <span class="free">y</span> <span class="main">=</span> <span class="skolem">l2</span> <span class="main">∧</span> upper <span class="free">y</span> <span class="main">=</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> joindef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> from_bounds <span class="main">(</span><span class="main">(</span>smax <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">,</span> smin <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> from_bounds <span class="main">(</span><span class="var">?l3</span><span class="main">,</span> <span class="var">?u3</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> False
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Stamp4.inf_intstamp_def Stamp4.join_bounds_def always_valid is_bottom.rep_eq join_or_bottom_def xdef ydef<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>sint <span class="var">?l3</span><span class="main">..</span>sint <span class="var">?u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>sint <span class="skolem">l1</span><span class="main">..</span>sint <span class="skolem">u1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> atLeastatMost_subset_iff smax.transfer smin.transfer<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span>sint <span class="var">?l3</span><span class="main">..</span>sint <span class="var">?u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>sint <span class="skolem">l1</span><span class="main">..</span>sint <span class="skolem">u1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xdef joindef range_def less_eq_intstamp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False Stamp4.always_valid Stamp4.join_or_bottom_def bounds.abs_eq case_prod_conv inf_intstamp_def is_bottom.rep_eq join_bounds_def range.rep_eq unfold_bounds ydef<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> int_inf_le2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_bottom <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bottom_is_bottom<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xdef<span class="main">:</span> <span class="quoted"><span class="quoted">"lower <span class="free">x</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">∧</span> upper <span class="free">x</span> <span class="main">=</span> <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ydef<span class="main">:</span> <span class="quoted"><span class="quoted">"lower <span class="free">y</span> <span class="main">=</span> <span class="skolem">l2</span> <span class="main">∧</span> upper <span class="free">y</span> <span class="main">=</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> joindef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> from_bounds <span class="main">(</span><span class="main">(</span>smax <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">,</span> smin <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> from_bounds <span class="main">(</span><span class="var">?l3</span><span class="main">,</span> <span class="var">?u3</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> False
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Stamp4.inf_intstamp_def Stamp4.join_bounds_def always_valid is_bottom.rep_eq join_or_bottom_def xdef ydef<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>sint <span class="var">?l3</span><span class="main">..</span>sint <span class="var">?u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>sint <span class="skolem">l1</span><span class="main">..</span>sint <span class="skolem">u1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> atLeastatMost_subset_iff smax.transfer smin.transfer<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span>sint <span class="var">?l3</span><span class="main">..</span>sint <span class="var">?u3</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>sint <span class="skolem">l2</span><span class="main">..</span>sint <span class="skolem">u2</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xdef joindef range_def less_eq_intstamp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False Stamp4.always_valid Stamp4.join_or_bottom_def bounds.abs_eq case_prod_conv inf_intstamp_def is_bottom.rep_eq join_bounds_def range.rep_eq unfold_bounds ydef<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> atLeastatMost_subset_iff smax.transfer smin.transfer<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bottom <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_bottom <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bottom_is_bottom assms
  <span class="keyword1"><span class="command">using</span></span> bottom_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> int_inf_greatest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> intstamp"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.int_inf_le1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.int_inf_le2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.int_inf_greatest<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> intstamp <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">)</span> <span class="quoted">semilattice_sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> intstamp <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">)</span> <span class="quoted">bounded_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">bot_intstamp</span></span> <span class="main">=</span> int_bottom"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">top_intstamp</span></span> <span class="main">=</span> int_top"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">1</span> word<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">1</span> word<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> Stamp <span class="main">=</span>
  BottomStamp <span class="main">|</span>
  TopStamp <span class="main">|</span>
  VoidStamp <span class="main">|</span>
  <span class="comment1">(*Int1Stamp "1 uintstamp" |*)</span>
  Int8Stamp <span class="quoted"><span class="quoted">"<span class="numeral">8</span> intstamp"</span></span> <span class="main">|</span>
  Int16Stamp <span class="quoted"><span class="quoted">"<span class="numeral">16</span> intstamp"</span></span> <span class="main">|</span>
  Int32Stamp <span class="quoted"><span class="quoted">"<span class="numeral">32</span> intstamp"</span></span> <span class="main">|</span>
  Int64Stamp <span class="quoted"><span class="quoted">"<span class="numeral">64</span> intstamp"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Stamp <span class="main">::</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_Stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Stamp <span class="main">⇒</span> Stamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_Stamp</span> BottomStamp <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_Stamp</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> TopStamp <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_Stamp</span> VoidStamp VoidStamp <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_Stamp</span> <span class="main">(</span>Int8Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int8Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_Stamp</span> <span class="main">(</span>Int16Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int16Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_Stamp</span> <span class="main">(</span>Int32Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int32Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_Stamp</span> <span class="main">(</span>Int64Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int64Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_Stamp</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_Stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Stamp <span class="main">⇒</span> Stamp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> BottomStamp BottomStamp <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> BottomStamp <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> TopStamp TopStamp <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> TopStamp <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> VoidStamp VoidStamp <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> <span class="main">(</span>Int8Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int8Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> <span class="main">(</span>Int16Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int16Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> <span class="main">(</span>Int32Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int32Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> <span class="main">(</span>Int64Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int64Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">less_Stamp</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Stamp <span class="main">::</span> <span class="quoted">semilattice_inf</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> inf <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inf_Stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Stamp <span class="main">⇒</span> Stamp <span class="main">⇒</span> Stamp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> BottomStamp <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> BottomStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> BottomStamp <span class="main">=</span> BottomStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> TopStamp <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> TopStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> TopStamp <span class="main">=</span> TopStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> VoidStamp VoidStamp <span class="main">=</span> VoidStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> <span class="main">(</span>Int8Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int8Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> Int8Stamp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> <span class="main">(</span>Int16Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int16Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> Int16Stamp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> <span class="main">(</span>Int32Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int32Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> Int32Stamp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_Stamp</span> <span class="main">(</span>Int64Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int64Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> Int64Stamp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> Stamp <span class="main">::</span> <span class="quoted">semilattice_sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_Stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Stamp <span class="main">⇒</span> Stamp <span class="main">⇒</span> Stamp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> BottomStamp <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> BottomStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> BottomStamp <span class="main">=</span> BottomStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> TopStamp <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> TopStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> TopStamp <span class="main">=</span> TopStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> VoidStamp VoidStamp <span class="main">=</span> VoidStamp"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> <span class="main">(</span>Int8Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int8Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> Int8Stamp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> <span class="main">(</span>Int16Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int16Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> Int16Stamp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> <span class="main">(</span>Int32Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int32Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> Int32Stamp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_Stamp</span> <span class="main">(</span>Int64Stamp <span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span> <span class="main">(</span>Int64Stamp <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span> <span class="main">=</span> Int64Stamp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> Stamp <span class="main">::</span> <span class="quoted">bounded_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_Stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Stamp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">top_Stamp</span> <span class="main">=</span> TopStamp"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">bot_Stamp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Stamp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bot_Stamp</span> <span class="main">=</span> BottomStamp"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_intstamp <span class="main">(</span>from_bounds <span class="main">(</span><span class="free">l</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Abs_intstamp_inverse from_bounds.rep_eq
  <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">Abs_intstamp</span>
<span class="comment1">(*
value "Int32Stamp (from_bounds (2::32 word, 5::32 word)) ⊓ Int32Stamp (from_bounds (2::32 word, 5::32 word))"
*)</span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory CanonicalizationProofs</title>
</head>


<body>
<div class="head">
<h1>Theory CanonicalizationProofs</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span>
  CanonicalizationProofs
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Canonicalization.html">Canonicalization</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeConditionalProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeConditional <span class="free">g</span> <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span> <span class="main">∧</span> wf_stamps <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeConditional.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>negate_condition <span class="skolem">g</span> <span class="skolem">cond</span> <span class="skolem">flip</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">condv</span></span> <span class="keyword2"><span class="keyword">where</span></span> condv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">cond</span> <span class="main">↦</span> IntVal32 <span class="skolem">condv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negate_condition.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">flipv</span></span> <span class="keyword2"><span class="keyword">where</span></span> flipv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">flip</span> <span class="main">↦</span> IntVal32 <span class="skolem">flipv</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LogicNegationNodeE negate_condition.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> invert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span><span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">flipv</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bool_to_val.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bool_to_val.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> condv eval.LogicNegationNode evalDet flipv negate_condition.hyps val_to_bool.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_neq_one<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tbval</span></span> <span class="keyword2"><span class="keyword">where</span></span> tbval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">tb</span> <span class="main">↦</span> IntVal32 <span class="skolem">tbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negate_condition.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fbval</span></span> <span class="keyword2"><span class="keyword">where</span></span> fbval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">fb</span> <span class="main">↦</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negate_condition.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">condv</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">flipv</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.LogicNegationNode condv flipv
      <span class="keyword1"><span class="command">using</span></span> True evalDet negate_condition.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">flipv</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">fbval</span> <span class="keyword1">else</span> <span class="skolem">tbval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ConditionalNode tbval fbval negate_condition<span class="main">(</span>5<span class="main">)</span>
      evalDet
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> flipv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="skolem">fbval</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True invert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">tbval</span> <span class="keyword1">else</span> <span class="skolem">fbval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ConditionalNode tbval fbval condv negate_condition<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> evalDet<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="skolem">fbval</span> <span class="main">=</span> <span class="free">res</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ConditionalNode tbval fbval True condv
      negate_condition<span class="main">(</span>4<span class="main">)</span> evalDet ConditionalNodeE
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹IntVal32 <span class="skolem">fbval</span> <span class="main">=</span> <span class="free">res'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> bool_to_val <span class="bound">x</span> <span class="main">=</span> IntVal32 <span class="skolem">condv</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.LogicNegationNode flipv negate_condition<span class="main">(</span>1<span class="main">)</span>
      bool_to_val.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LogicNegationNodeE condv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">condv</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.LogicNegationNode flipv negate_condition<span class="main">(</span>1<span class="main">)</span>
      bool_to_val.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Value.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> bool_to_val <span class="bound">x</span> <span class="main">=</span> IntVal32 <span class="skolem">condv</span>›</span></span> insertCI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.LogicNegationNode condv flipv
      <span class="keyword1"><span class="command">using</span></span> False evalDet negate_condition.hyps invert
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Value.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bool_to_val.elims<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">flipv</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">fbval</span> <span class="keyword1">else</span> <span class="skolem">tbval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ConditionalNode tbval fbval negate_condition<span class="main">(</span>5<span class="main">)</span>
      evalDet
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> flipv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="skolem">tbval</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span>›</span></span> invert <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">tbval</span> <span class="keyword1">else</span> <span class="skolem">fbval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ConditionalNode tbval fbval condv negate_condition<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> evalDet<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="skolem">tbval</span> <span class="main">=</span> <span class="free">res</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ConditionalNode tbval fbval False condv
      negate_condition<span class="main">(</span>4<span class="main">)</span> evalDet ConditionalNodeE
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹IntVal32 <span class="skolem">tbval</span> <span class="main">=</span> <span class="free">res'</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const_true <span class="skolem">g</span> <span class="skolem">cond</span> <span class="skolem">val</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.RefNode evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const_false <span class="skolem">g</span> <span class="skolem">cond</span> <span class="skolem">val</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.RefNode evalDet eval.ConditionalNode
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>eq_branches <span class="skolem">tb</span> <span class="skolem">fb</span> <span class="skolem">g</span> <span class="skolem">cond</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.RefNode evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cond_eq <span class="skolem">g</span> <span class="skolem">cond</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">condv</span></span> <span class="keyword2"><span class="keyword">where</span></span> condv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">cond</span> <span class="main">↦</span> IntVal32 <span class="skolem">condv</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tbval</span></span> <span class="keyword2"><span class="keyword">where</span></span> tbval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">tb</span> <span class="main">↦</span> IntVal32 <span class="skolem">tbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cond_eq.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fbval</span></span> <span class="keyword2"><span class="keyword">where</span></span> fbval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">fb</span> <span class="main">↦</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cond_eq.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> cond_eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">condv</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tbval</span> <span class="main">=</span> <span class="skolem">fbval</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IntegerEqualsNodeE condv cond_eq<span class="main">(</span>1<span class="main">)</span>
      tbval fbval True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Value.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bool_to_val.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> evalDet<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="skolem">tbval</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RefNode <span class="quoted"><span class="quoted">‹<span class="skolem">tbval</span> <span class="main">=</span> <span class="skolem">fbval</span>›</span></span> cond_eq.prems<span class="main">(</span>4<span class="main">)</span> evalDet fbval <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="skolem">tbval</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tbval</span> <span class="main">=</span> <span class="skolem">fbval</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">tbval</span> <span class="keyword1">else</span> <span class="skolem">fbval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cond_eq.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> condv eval.ConditionalNode evalDet fbval tbval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="skolem">tbval</span> <span class="main">∨</span> <span class="free">res</span> <span class="main">=</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ConditionalNode evalDet tbval fbval condv cond_eq.prems<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> ConditionalNode <span class="skolem">cond</span> <span class="skolem">tb</span> <span class="skolem">fb</span> <span class="main">↦</span> <span class="free">res</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">tbval</span> <span class="keyword1">else</span> <span class="skolem">fbval</span><span class="main">)</span>›</span></span> condv eval.ConditionalNode evalDet fbval tbval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cond_eq
      evalDet fbval tbval eval.ConditionalNode eval.IntegerEqualsNode
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="skolem">fbval</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="skolem">tbval</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">tbval</span> <span class="main">=</span> <span class="skolem">fbval</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bool_to_val True <span class="main">≠</span> IntVal32 <span class="skolem">condv</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">tb</span> <span class="main">↦</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> IntegerEqualsNode cond_eq.hyps condv evalDet fbval<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span>›</span></span> tbval <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tbval</span> <span class="main">≠</span> <span class="skolem">fbval</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> eval.IntegerEqualsNode condv cond_eq<span class="main">(</span>1<span class="main">)</span>
      tbval fbval False
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> RefNode cond_eq.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> evalDet fbval<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="keyword1">if</span> val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">tbval</span> <span class="keyword1">else</span> <span class="skolem">fbval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cond_eq.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> condv eval.ConditionalNode evalDet fbval tbval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval.ConditionalNode evalDet tbval fbval condv cond_eq.prems<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> val_to_bool <span class="main">(</span>IntVal32 <span class="skolem">condv</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cond_eq
        evalDet fbval tbval eval.ConditionalNode eval.IntegerEqualsNode
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">res'</span> <span class="main">=</span> IntVal32 <span class="skolem">fbval</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>condition_bounds_x <span class="skolem">g</span> <span class="skolem">cond</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tbval</span></span> <span class="keyword2"><span class="keyword">where</span></span> tbval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">tb</span> <span class="main">↦</span> IntVal32 <span class="skolem">tbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_x.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fbval</span></span> <span class="keyword2"><span class="keyword">where</span></span> fbval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">fb</span> <span class="main">↦</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_x.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tbval</span> <span class="main">≤</span> <span class="skolem">fbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_x.prems<span class="main">(</span>2<span class="main">)</span> tbval fbval condition_bounds_x.hyps<span class="main">(</span>2<span class="main">)</span> int_valid_range
    <span class="keyword1"><span class="command">unfolding</span></span> wf_stamps.simps <span class="keyword1"><span class="command">using</span></span> valid_value.simps
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="skolem">tbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ConditionalNodeE tbval fbval
    eval.IntegerLessThanNode
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_x.prems<span class="main">(</span>3<span class="main">)</span> eval.RefNode evalDet tbval
    <span class="keyword1"><span class="command">using</span></span> ConditionalNodeE Value.sel<span class="main">(</span>1<span class="main">)</span> condition_bounds_x.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>condition_bounds_y <span class="skolem">g</span> <span class="skolem">cond</span> <span class="skolem">fb</span> <span class="skolem">tb</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tbval</span></span> <span class="keyword2"><span class="keyword">where</span></span> tbval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">tb</span> <span class="main">↦</span> IntVal32 <span class="skolem">tbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_y.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fbval</span></span> <span class="keyword2"><span class="keyword">where</span></span> fbval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="skolem">g</span> <span class="skolem">fb</span> <span class="main">↦</span> IntVal32 <span class="skolem">fbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_y.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tbval</span> <span class="main">≥</span> <span class="skolem">fbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_y.prems<span class="main">(</span>2<span class="main">)</span> tbval fbval condition_bounds_y.hyps<span class="main">(</span>2<span class="main">)</span> int_valid_range
    <span class="keyword1"><span class="command">unfolding</span></span> wf_stamps.simps 
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> IntVal32 <span class="skolem">tbval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ConditionalNodeE tbval fbval
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_y.prems<span class="main">(</span>3<span class="main">)</span> eval.RefNode evalDet tbval
    <span class="keyword1"><span class="command">using</span></span> ConditionalNodeE Value.sel<span class="main">(</span>1<span class="main">)</span> condition_bounds_y.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_zero_32<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>IntVal32 <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>IntVal32 <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> plus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> add_zero_64<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>IntVal64 <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>IntVal64 <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>IntVal64 <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> plus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xval</span> <span class="free">yval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">-</span> <span class="free">xval</span><span class="main">)</span> <span class="main">+</span> <span class="free">yval</span> <span class="main">=</span> <span class="free">yval</span> <span class="main">-</span> <span class="free">xval</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> add_int32_typesafe<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Value</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">res</span><span class="main">.</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> IntVal32 <span class="bound">res</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xval</span> <span class="bound">yval</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> IntVal32 <span class="bound">xval</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> IntVal32 <span class="bound">yval</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_Value_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> intval_add.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sub_int32_typesafe<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Value</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">res</span><span class="main">.</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> IntVal32 <span class="bound">res</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xval</span> <span class="bound">yval</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> IntVal32 <span class="bound">xval</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> IntVal32 <span class="bound">yval</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> intval_add.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_int64_typesafe<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Value</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">res</span><span class="main">.</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> IntVal64 <span class="bound">res</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xval</span> <span class="bound">yval</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> IntVal64 <span class="bound">xval</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> IntVal64 <span class="bound">yval</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_Value_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> intval_add.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sub_int64_typesafe<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Value</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">res</span><span class="main">.</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> IntVal64 <span class="bound">res</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xval</span> <span class="bound">yval</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> IntVal64 <span class="bound">xval</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> IntVal64 <span class="bound">yval</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> intval_add.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeAddProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeAdd <span class="free">g</span> <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span> <span class="main">∧</span> wf_stamps <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> IntVal32 <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> IntVal32 <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> addkind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">before</span> <span class="main">=</span> AddNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CanonicalizeAdd.simps assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> addkind
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> xval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> addkind
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yval</span></span> <span class="keyword2"><span class="keyword">where</span></span> yval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> intval_add <span class="skolem">xval</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> eval.AddNode
    <span class="keyword1"><span class="command">using</span></span> addkind evalDet xval yval plus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms addkind xval yval res
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> <span class="quoted">"CanonicalizeAdd.induct"</span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_both_const <span class="skolem">x</span> <span class="skolem">c_1</span> <span class="skolem">y</span> <span class="skolem">c_2</span> <span class="skolem">val</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval.ConstantNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConstantNodeE IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Value.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_xzero <span class="skolem">x</span> <span class="skolem">c_1</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> xeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ConstantNode add_xzero.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_xzero.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> yeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_xzero.prems<span class="main">(</span>4<span class="main">)</span> yval <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res'</span> <span class="main">=</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> RefNodeE add_xzero.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet yeval<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res_val<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> intval_add <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode eval.ConstantNode add_xzero<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> evalDet <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_xzero.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> res xval<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.RefNode yval res_val y plus_Value_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_yzero <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">c_2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> yeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ConstantNode add_yzero.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_yzero.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> xeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_yzero.prems<span class="main">(</span>4<span class="main">)</span> xval <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res'</span> <span class="main">=</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> RefNodeE add_yzero.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet xeval<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> intval_add <span class="skolem">xval</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode eval.ConstantNode add_yzero<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> evalDet xeval plus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> intval_add <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intval_add_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval.RefNode xval plus_Value_def
    <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_xsub <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="skolem">yv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode add_xsub<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> add_int32_typesafe evalDet
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="skolem">xv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode add_xsub<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> add_int32_typesafe evalDet
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aval</span></span> <span class="keyword2"><span class="keyword">where</span></span> aval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aval</span> <span class="main">=</span> IntVal32 <span class="free">res'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aval</span> <span class="main">-</span> <span class="skolem">yval</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">yval</span> <span class="main">=</span> <span class="skolem">aval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_int32_typesafe sub_int32_typesafe
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="skolem">yv</span>›</span></span> minus_Value_def plus_Value_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval.AddNode eval.SubNode eval.RefNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> SubNodeE Value.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_xsub.hyps add_xsub.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> add_xsub.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> addkind assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> aval evalDet xval yval<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_ysub <span class="skolem">y</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="skolem">yv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode add_ysub<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> add_int32_typesafe evalDet
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="skolem">xv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode add_ysub<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> add_int32_typesafe evalDet
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aval</span></span> <span class="keyword2"><span class="keyword">where</span></span> aval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aval</span> <span class="main">=</span> IntVal32 <span class="free">res'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">aval</span> <span class="main">-</span> <span class="skolem">xval</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">aval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_int32_typesafe sub_int32_typesafe
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="skolem">xv</span>›</span></span> minus_Value_def plus_Value_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval.AddNode eval.SubNode eval.RefNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> RefNodeE Value.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_ysub.hyps add_ysub.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> add_ysub.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> add_ysub.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> add_ysub.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> aval evalDet plus_Value_def res<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_xnegate <span class="skolem">nx</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yv</span></span> <span class="keyword2"><span class="keyword">where</span></span> yv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="skolem">yv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode add_xnegate<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> add_int32_typesafe evalDet
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xv</span></span> <span class="keyword2"><span class="keyword">where</span></span> xv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="skolem">xv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode add_xnegate<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> add_int32_typesafe evalDet
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">oxval</span></span> <span class="keyword2"><span class="keyword">where</span></span> oxval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">oxval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_xnegate.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> negdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">oxval</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_xnegate.hyps add_xnegate.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> eval.NegateNode evalDet oxval xval<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">res</span><span class="main">.</span> IntVal32 <span class="bound">res</span> <span class="main">=</span> IntVal32 <span class="main">0</span> <span class="main">-</span> <span class="skolem">oxval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">oxv</span><span class="main">.</span> <span class="skolem">oxval</span> <span class="main">=</span> IntVal32 <span class="bound">oxv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_int32_typesafe negdef
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">oxv</span></span> <span class="keyword2"><span class="keyword">where</span></span> oxv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oxval</span> <span class="main">=</span> IntVal32 <span class="skolem">oxv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_int32_typesafe xv
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">negx</span></span> <span class="keyword2"><span class="keyword">where</span></span> negx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">negx</span> <span class="main">=</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">oxval</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> NegateNode <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">negx</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.NegateNode
    <span class="keyword1"><span class="command">using</span></span> oxval <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">oxval</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">yval</span> <span class="main">=</span> <span class="skolem">yval</span> <span class="main">-</span> <span class="skolem">oxval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_int32_typesafe sub_int32_typesafe yv oxv
    <span class="keyword1"><span class="command">using</span></span> plus_Value_def minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval.NegateNode eval.AddNode eval.SubNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Value.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_xnegate.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> add_xnegate.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> evalDet negdef oxval plus_Value_def res yval<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_ynegate <span class="skolem">ny</span> <span class="skolem">y</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yv</span></span> <span class="keyword2"><span class="keyword">where</span></span> yv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="skolem">yv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode add_ynegate<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> add_int32_typesafe evalDet
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xv</span></span> <span class="keyword2"><span class="keyword">where</span></span> xv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="skolem">xv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.AddNode add_ynegate<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> add_int32_typesafe evalDet
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">oyval</span></span> <span class="keyword2"><span class="keyword">where</span></span> oyval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">oyval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_ynegate.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> negdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yval</span> <span class="main">=</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">oyval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.NegateNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_ynegate.hyps add_ynegate.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> add_ynegate.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> evalDet oyval<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">res</span><span class="main">.</span> IntVal32 <span class="bound">res</span> <span class="main">=</span> IntVal32 <span class="main">0</span> <span class="main">-</span> <span class="skolem">oyval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">oyv</span><span class="main">.</span> <span class="skolem">oyval</span> <span class="main">=</span> IntVal32 <span class="bound">oyv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_int32_typesafe negdef
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">oyv</span></span> <span class="keyword2"><span class="keyword">where</span></span> oyv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oyval</span> <span class="main">=</span> IntVal32 <span class="skolem">oyv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_int32_typesafe yv
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">negy</span></span> <span class="keyword2"><span class="keyword">where</span></span> negx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">negy</span> <span class="main">=</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">oyval</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> NegateNode <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">negy</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.NegateNode
    <span class="keyword1"><span class="command">using</span></span> oyval <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xval</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">oyval</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xval</span> <span class="main">-</span> <span class="skolem">oyval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_int32_typesafe sub_int32_typesafe yv oyv
    <span class="keyword1"><span class="command">using</span></span> plus_Value_def minus_Value_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.group_left_neutral diff_add_eq intval_add.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> intval_add_sym intval_sub.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> negdef res<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval.NegateNode eval.AddNode eval.SubNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Value.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_ynegate.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> add_ynegate.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> add_ynegate.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> evalDet negdef oyval plus_Value_def res<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Value</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">r'</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">=</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> sub_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Value</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">r'</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">=</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> add_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Value</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> IntVal32 <span class="free">xval</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> IntVal32 <span class="free">yval</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_Value_def minus_Value_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeSubProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeSub <span class="free">g</span> <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_stamps <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> IntVal32 <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> IntVal32 <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> subkind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">before</span> <span class="main">=</span> SubNode <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CanonicalizeSub.simps assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> subkind
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> xval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> subkind
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yval</span></span> <span class="keyword2"><span class="keyword">where</span></span> yval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> intval_sub <span class="skolem">xval</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> eval.SubNode
    <span class="keyword1"><span class="command">using</span></span> subkind evalDet xval yval minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms subkind xval yval res
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> <span class="quoted">"CanonicalizeSub.induct"</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_same <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">b</span> <span class="skolem">l</span> <span class="skolem">h</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> <span class="skolem">yval</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> evalDet sub_same<span class="main">(</span>1<span class="main">)</span> xval yval sub_same<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>39<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">-</span> <span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_int32_typesafe res <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xval</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">yval</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_same<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_same<span class="main">(</span>5<span class="main">)</span> eval.ConstantNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> res <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_both_const <span class="skolem">x</span> <span class="skolem">c_1</span> <span class="skolem">y</span> <span class="skolem">c_2</span> <span class="skolem">val</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="skolem">xval</span> <span class="main">-</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_both_const<span class="main">(</span>5<span class="main">)</span> xval yval sub_both_const<span class="main">(</span>7<span class="main">)</span> eval.SubNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval.SubNode sub_both_const.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sub_both_const.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> xval yval minus_Value_def res<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res'</span> <span class="main">=</span> <span class="skolem">xval</span> <span class="main">-</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_both_const<span class="main">(</span>6<span class="main">)</span> sub_both_const<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> xval yval sub_both_const<span class="main">(</span>7<span class="main">)</span> minus_Value_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConstantNodeE IRNode.inject<span class="main"><span class="main">(</span></span>39<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> res <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sub_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_left_add1 <span class="skolem">left</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ytype<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yval sub_int32_typesafe res <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aval</span></span> <span class="keyword2"><span class="keyword">where</span></span> aval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">a</span> <span class="main">↦</span> <span class="skolem">aval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add1.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> atype<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">aval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_int32_typesafe sub_left_add1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> RefNode evalDet<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">b</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> evalDet sub_left_add1<span class="main">(</span>5<span class="main">)</span> yval <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> <span class="skolem">aval</span> <span class="main">+</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add1<span class="main">(</span>1<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> eval.AddNode aval
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>39<span class="main"><span class="main">)</span></span> evalDet<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">aval</span> <span class="main">+</span> <span class="skolem">yval</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add1<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def plus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="skolem">aval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_sub atype ytype <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res'</span> <span class="main">=</span> <span class="skolem">aval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add1<span class="main">(</span>4<span class="main">)</span> eval.RefNode aval evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> res <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_left_add2 <span class="skolem">left</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ytype<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yval sub_int32_typesafe res <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bval</span></span> <span class="keyword2"><span class="keyword">where</span></span> bval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">b</span> <span class="main">↦</span> <span class="skolem">bval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add2.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> atype<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">bval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add2<span class="main">(</span>4<span class="main">)</span> eval.RefNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> evalDet<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">a</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> evalDet sub_left_add2<span class="main">(</span>5<span class="main">)</span> yval <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> <span class="skolem">yval</span> <span class="main">+</span> <span class="skolem">bval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add2<span class="main">(</span>1<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> eval.AddNode bval
    <span class="keyword1"><span class="command">using</span></span> IRNode.inject<span class="main">(</span>39<span class="main">)</span> evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">yval</span> <span class="main">+</span> <span class="skolem">bval</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add2<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def plus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="skolem">bval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> atype ytype <span class="keyword1"><span class="command">unfolding</span></span> plus_Value_def minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res'</span> <span class="main">=</span> <span class="skolem">bval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_left_add2<span class="main">(</span>4<span class="main">)</span> eval.RefNode bval evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> res <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_left_sub <span class="skolem">left</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_right_add1 <span class="skolem">right</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_right_add2 <span class="skolem">right</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_right_sub <span class="skolem">right</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_yzero <span class="skolem">y</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="skolem">xval</span> <span class="main">-</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_yzero<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_int32_typesafe <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.ConstantNode yval sub_yzero<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res'</span> <span class="main">=</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_yzero<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> xval eval.RefNode evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> res <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_xzero <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_xzero<span class="main">(</span>8<span class="main">)</span> sub_int32_typesafe <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_xzero<span class="main">(</span>8<span class="main">)</span> sub_int32_typesafe <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_xzero<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> eval.ConstantNode xval <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_xzero<span class="main">(</span>8<span class="main">)</span> xval <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res'</span> <span class="main">=</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval.NegateNode sub_xzero<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> yval evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> res <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sub_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_y_negate <span class="skolem">nb</span> <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bval</span></span> <span class="keyword2"><span class="keyword">where</span></span> bval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">b</span> <span class="main">↦</span> <span class="skolem">bval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_y_negate<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> xtype<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">xval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_y_negate<span class="main">(</span>8<span class="main">)</span> sub_int32_typesafe <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> ytype<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">yval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_y_negate<span class="main">(</span>8<span class="main">)</span> sub_int32_typesafe <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> yeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yval</span> <span class="main">=</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">bval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_y_negate<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> eval.NegateNode bval evalDet yval <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> btype<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="skolem">bval</span> <span class="main">=</span> IntVal32 <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_int32_typesafe ytype <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"IntVal32 <span class="free">res</span> <span class="main">=</span> <span class="skolem">xval</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">bval</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_y_negate<span class="main">(</span>8<span class="main">)</span> yeval <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">xval</span> <span class="main">+</span> <span class="skolem">bval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xtype btype <span class="keyword1"><span class="command">unfolding</span></span> minus_Value_def plus_Value_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> IntVal32 <span class="free">res'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_y_negate<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> xval bval eval.AddNode
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRNode.inject<span class="main"><span class="main">(</span></span>39<span class="main"><span class="main">)</span></span> evalDet<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeIfProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">MapState</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">h</span><span class="main">::</span><span class="quoted">RefFieldHeap</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"kind <span class="free">g</span> <span class="free">nid</span> <span class="main">=</span> <span class="free">before</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeIf <span class="free">g</span> <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">=</span> replace_node <span class="free">nid</span> <span class="main">(</span><span class="free">after</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">nid'</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid</span> <span class="main">|</span> <span class="free">g</span> <span class="main">∼</span> <span class="free">g'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeIf.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>trueConst <span class="skolem">cond</span> <span class="skolem">condv</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="skolem">tb</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ConstantNode IfNode trueConst.hyps<span class="main">(</span>1<span class="main">)</span> trueConst.hyps<span class="main">(</span>2<span class="main">)</span> trueConst.prems<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> step.IfNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> g'step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g'</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="skolem">tb</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> replace_node_lookup
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepRefNode trueConst.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> gstep g'step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lockstep_strong_bisimilulation assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>falseConst <span class="skolem">cond</span> <span class="skolem">condv</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="skolem">fb</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ConstantNode IfNode falseConst.hyps<span class="main">(</span>1<span class="main">)</span> falseConst.hyps<span class="main">(</span>2<span class="main">)</span> falseConst.prems<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> step.IfNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> g'step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g'</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="skolem">fb</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> replace_node_lookup
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> falseConst.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> stepRefNode<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> gstep g'step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lockstep_strong_bisimilulation assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>eqBranch <span class="skolem">cond</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">cond</span> <span class="main">↦</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IfNodeCond
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eqBranch.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eqBranch.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="skolem">tb</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqBranch<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> IfNodeStepCases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> g'step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g'</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="skolem">tb</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eqBranch.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> stepRefNode<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> gstep g'step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lockstep_strong_bisimilulation assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>eqCondition <span class="skolem">cond</span> <span class="skolem">x</span> <span class="skolem">tb</span> <span class="skolem">fb</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">condv</span></span> <span class="keyword2"><span class="keyword">where</span></span> condval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">g</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> kind <span class="free">g</span> <span class="skolem">cond</span> <span class="main">↦</span> <span class="skolem">condv</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IfNodeCond
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eqCondition.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eqCondition.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"val_to_bool <span class="skolem">condv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condval eqCondition.hyps evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="skolem">tb</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step.IfNode
    <span class="keyword1"><span class="command">using</span></span> condval eqCondition.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> g'step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g'</span><span class="main">,</span> <span class="free">p</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">nid</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="skolem">tb</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> replace_node_lookup
    <span class="keyword1"><span class="command">using</span></span> IRNode.simps<span class="main">(</span>2114<span class="main">)</span> eqCondition.prems<span class="main">(</span>3<span class="main">)</span> stepRefNode <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">from</span></span> gstep g'step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lockstep_strong_bisimilulation assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>
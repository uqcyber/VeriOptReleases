<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory CanonicalizationTreeProofs</title>
</head>


<body>
<div class="head">
<h1>Theory CanonicalizationTreeProofs</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Canonicalization Phase›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CanonicalizationTreeProofs
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="CanonicalizationTree.html">CanonicalizationTree</a>
    <a href="../Semantics/IRTreeEvalThms.html">Semantics.IRTreeEvalThms</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid32or64<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">v1</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> IntVal32 <span class="bound">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> IntVal64 <span class="bound">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32 valid64 assms valid_value.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> valid32or64_both<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">loy</span> <span class="free">hiy</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> IntVal32 <span class="bound">v1</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> IntVal32 <span class="bound">v2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v3</span> <span class="bound">v4</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> IntVal64 <span class="bound">v3</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> IntVal64 <span class="bound">v4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms valid32or64 valid32 valid_value.elims<span class="main">(</span>2<span class="main">)</span> valid_value.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="comment1">(* -(-x) = x *)</span>
<span class="keyword1"><span class="command">lemma</span></span> double_negate_refinement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">expr</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stamp_expr <span class="free">expr</span> <span class="main">=</span> IntegerStamp <span class="free">b</span> <span class="free">lo</span> <span class="free">hi</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UnaryExpr UnaryNeg <span class="main">(</span>UnaryExpr UnaryNeg <span class="main">(</span><span class="free">expr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">expr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">val</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms int_stamp_implies_valid_value<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> intval_negate <span class="main">(</span>intval_negate <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> valid32or64 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">metis</span> int_stamp_implies_valid_value<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* -(x-y) = (x-y) *)</span>
<span class="keyword1"><span class="command">lemma</span></span> negate_xsuby_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">loy</span> <span class="free">hiy</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_negate <span class="main">(</span>intval_sub <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> intval_sub <span class="free">y</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> IntVal32 <span class="bound">v1</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> IntVal32 <span class="bound">v2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v3</span> <span class="bound">v4</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> IntVal64 <span class="bound">v3</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> IntVal64 <span class="bound">v4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid32or64_both assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neg_sub_refinement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↦</span> <span class="free">xval</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">y</span> <span class="main">↦</span> <span class="free">yval</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stamp_expr <span class="free">x</span> <span class="main">=</span> IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stamp_expr <span class="free">y</span> <span class="main">=</span> IntegerStamp <span class="free">b</span> <span class="free">loy</span> <span class="free">hiy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UnaryExpr UnaryNeg <span class="main">(</span>BinaryExpr BinSub <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>BinaryExpr BinSub <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> le_expr_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> assms negate_xsuby_helper int_stamp_implies_valid_value
        evaltree.simps BinaryExprE UnaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> unary_eval.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeNegateProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeNegate <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeNegate.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>negate_negate <span class="skolem">nx</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> double_negate_refinement
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> evalDet is_IntegerStamp_def le_expr_def negate_negate.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> negate_negate.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> negate_negate.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>negate_sub <span class="skolem">e</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">stampx</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms neg_sub_refinement le_expr_def evalDet is_IntegerStamp_def negate_sub.hyps negate_sub.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.collapse<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>
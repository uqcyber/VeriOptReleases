<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory CanonicalizationTreeProofs</title>
</head>


<body>
<div class="head">
<h1>Theory CanonicalizationTreeProofs</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Canonicalization Phase›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CanonicalizationTreeProofs
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="CanonicalizationTree.html">CanonicalizationTree</a>
    <a href="../Semantics/TreeToGraph.html">Semantics.TreeToGraph</a>
    <a href="../Semantics/IRTreeEvalThms.html">Semantics.IRTreeEvalThms</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neutral_rewrite_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_mul <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_mul <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>

  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_add <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_add <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>

  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_sub <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_sub <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>

  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_xor <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_xor <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>

  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_or <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_or <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> annihilator_rewrite_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_mul <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">=</span> IntVal32 <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_mul <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">0</span><span class="main">)</span> <span class="main">=</span> IntVal64 <span class="main">0</span>"</span></span>

  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_and <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="main">=</span> IntVal32 <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_and <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">0</span><span class="main">)</span> <span class="main">=</span> IntVal64 <span class="main">0</span>"</span></span>

  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_or <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> IntVal32 <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_or <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> IntVal64 <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> intval_mul.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_zero_right valid32<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> idempotent_rewrite_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_and <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_and <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>

  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_or <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_or <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="free">v</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> signed_int_bottom32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> sint <span class="main">(</span><span class="free">v</span><span class="main">::</span>int32<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="free">v</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(* weird *)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sint_range_size <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(* it says proof found... *)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> signed_int_top32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> sint <span class="main">(</span><span class="free">v</span><span class="main">::</span>int32<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="free">v</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span> <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(* weird *)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sint_range_size <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(* it says proof found... *)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_bounds_equiv32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">32</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> upper_bounds_equiv32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">32</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> bit_bounds_min32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>bit_bounds <span class="numeral">32</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>sint <span class="main">(</span><span class="free">v</span><span class="main">::</span>int32<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bit_bounds.simps fst_def <span class="keyword1"><span class="command">using</span></span> signed_int_bottom32 lower_bounds_equiv32
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> bit_bounds_max32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>snd <span class="main">(</span>bit_bounds <span class="numeral">32</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span>sint <span class="main">(</span><span class="free">v</span><span class="main">::</span>int32<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bit_bounds.simps fst_def <span class="keyword1"><span class="command">using</span></span> signed_int_top32 upper_bounds_equiv32
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="free">v</span><span class="main">::</span><span class="numeral">64</span> word<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> signed_int_bottom64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">63</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> sint <span class="main">(</span><span class="free">v</span><span class="main">::</span>int64<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="free">v</span> <span class="main">=</span> <span class="numeral">64</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(* weird *)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sint_range_size <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(* it says proof found... *)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> signed_int_top64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">63</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> sint <span class="main">(</span><span class="free">v</span><span class="main">::</span>int64<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="free">v</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span> <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(* weird *)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sint_range_size <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(* it says proof found... *)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_bounds_equiv64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">63</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">64</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> upper_bounds_equiv64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">63</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="numeral">64</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> bit_bounds_min64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>bit_bounds <span class="numeral">64</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>sint <span class="main">(</span><span class="free">v</span><span class="main">::</span>int64<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bit_bounds.simps fst_def <span class="keyword1"><span class="command">using</span></span> signed_int_bottom64 lower_bounds_equiv64
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> bit_bounds_max64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>snd <span class="main">(</span>bit_bounds <span class="numeral">64</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span>sint <span class="main">(</span><span class="free">v</span><span class="main">::</span>int64<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bit_bounds.simps fst_def <span class="keyword1"><span class="command">using</span></span> signed_int_top64 upper_bounds_equiv64
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> unrestricted_32bit_always_valid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>unrestricted_stamp <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>IntVal32 <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_value.simps<span class="main">(</span>1<span class="main">)</span> bit_bounds_min32 bit_bounds_max32
  <span class="keyword1"><span class="command">using</span></span> unrestricted_stamp.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> unrestricted_64bit_always_valid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>unrestricted_stamp <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>IntVal64 <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_value.simps<span class="main">(</span>2<span class="main">)</span> bit_bounds_min64 bit_bounds_max64
  <span class="keyword1"><span class="command">using</span></span> unrestricted_stamp.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> unary_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">val</span> <span class="main">=</span> UndefVal <span class="main">⟹</span> unary_eval <span class="free">op</span> <span class="free">val</span> <span class="main">=</span> UndefVal"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unary_obj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">val</span> <span class="main">=</span> ObjRef <span class="free">x</span> <span class="main">⟹</span> unary_eval <span class="free">op</span> <span class="free">val</span> <span class="main">=</span> UndefVal"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unary_eval_implies_valud_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">expr</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">result</span> <span class="main">=</span> unary_eval <span class="free">op</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">result</span> <span class="main">≠</span> UndefVal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="free">expr</span><span class="main">)</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="main">(</span>UnaryExpr <span class="free">op</span> <span class="free">expr</span><span class="main">)</span><span class="main">)</span> <span class="free">result</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> is_IntVal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">result</span> <span class="main">=</span> IntVal32 <span class="bound">x</span> <span class="main">∨</span> <span class="free">result</span> <span class="main">=</span> IntVal64 <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_IntegerStamp <span class="main">(</span>stamp_expr <span class="free">expr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stamp_expr <span class="free">expr</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> valid_VoidStamp unary_undef <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> valid_VoidStamp unary_undef <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> valid_ObjStamp unary_obj <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">using</span></span> valid_ObjStamp unary_obj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">lo</span></span> <span class="skolem"><span class="skolem">hi</span></span> <span class="keyword2"><span class="keyword">where</span></span> stamp_expr_def<span class="main">:</span> <span class="quoted"><span class="quoted">"stamp_expr <span class="free">expr</span> <span class="main">=</span> <span class="main">(</span>IntegerStamp <span class="skolem">b</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_IntegerStamp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stamp_expr <span class="main">(</span>UnaryExpr <span class="free">op</span> <span class="free">expr</span><span class="main">)</span> <span class="main">=</span> unrestricted_stamp <span class="main">(</span>IntegerStamp <span class="skolem">b</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp_expr.simps<span class="main">(</span>1<span class="main">)</span> stamp_unary.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">from</span></span> stamp_expr_def <span class="keyword1"><span class="command">have</span></span> bit32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="numeral">32</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">result</span> <span class="main">=</span> IntVal32 <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> stamp_expr_def <span class="keyword1"><span class="command">have</span></span> bit64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="numeral">64</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">result</span> <span class="main">=</span> IntVal64 <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> 

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_value.simps<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    unrestricted_32bit_always_valid unrestricted_64bit_always_valid stamp_expr_def
    bit32 bit64
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹stamp_expr <span class="main">(</span>UnaryExpr <span class="free">op</span> <span class="free">expr</span><span class="main">)</span> <span class="main">=</span> unrestricted_stamp <span class="main">(</span>IntegerStamp <span class="skolem">b</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> valid32or64_both<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> binary_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v1</span> <span class="main">=</span> UndefVal <span class="main">∨</span> <span class="free">v2</span> <span class="main">=</span> UndefVal <span class="main">⟹</span> bin_eval <span class="free">op</span> <span class="free">v1</span> <span class="free">v2</span> <span class="main">=</span> UndefVal"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> binary_obj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v1</span> <span class="main">=</span> ObjRef <span class="free">x</span> <span class="main">∨</span> <span class="free">v2</span> <span class="main">=</span> ObjRef <span class="free">y</span> <span class="main">⟹</span> bin_eval <span class="free">op</span> <span class="free">v1</span> <span class="free">v2</span> <span class="main">=</span> UndefVal"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> binary_eval_bits_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">result</span> <span class="main">=</span> bin_eval <span class="free">op</span> <span class="free">val1</span> <span class="free">val2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">result</span> <span class="main">≠</span> UndefVal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b1</span> <span class="free">lo1</span> <span class="free">hi1</span><span class="main">)</span> <span class="free">val1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b2</span> <span class="free">lo2</span> <span class="free">hi2</span><span class="main">)</span> <span class="free">val2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="main">=</span> <span class="free">b2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="comment1">(*slow*)</span>

<span class="keyword1"><span class="command">lemma</span></span> binary_eval_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">result</span> <span class="main">=</span> IntVal32 <span class="bound">x</span> <span class="main">∨</span> <span class="free">result</span> <span class="main">=</span> IntVal64 <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">result</span> <span class="main">=</span> bin_eval <span class="free">op</span> <span class="free">val1</span> <span class="free">val2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">x32</span> <span class="bound">x64</span> <span class="bound">y32</span> <span class="bound">y64</span><span class="main">.</span> <span class="free">val1</span> <span class="main">=</span> IntVal32 <span class="bound">x32</span> <span class="main">∧</span> <span class="free">val2</span> <span class="main">=</span> IntVal32 <span class="bound">y32</span> <span class="main">∨</span> <span class="free">val1</span> <span class="main">=</span> IntVal64 <span class="bound">x64</span> <span class="main">∧</span> <span class="free">val2</span> <span class="main">=</span> IntVal64 <span class="bound">y64</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">result</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> binary_eval_implies_valud_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">expr1</span> <span class="main">↦</span> <span class="free">val1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">expr2</span> <span class="main">↦</span> <span class="free">val2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">result</span> <span class="main">=</span> bin_eval <span class="free">op</span> <span class="free">val1</span> <span class="free">val2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">result</span> <span class="main">≠</span> UndefVal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="free">expr1</span><span class="main">)</span> <span class="free">val1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="free">expr2</span><span class="main">)</span> <span class="free">val2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="main">(</span>BinaryExpr <span class="free">op</span> <span class="free">expr1</span> <span class="free">expr2</span><span class="main">)</span><span class="main">)</span> <span class="free">result</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> is_IntVal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">result</span> <span class="main">=</span> IntVal32 <span class="bound">x</span> <span class="main">∨</span> <span class="free">result</span> <span class="main">=</span> IntVal64 <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Values.bool_to_val.elims<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> expr1_intstamp<span class="main">:</span> <span class="quoted"><span class="quoted">"is_IntegerStamp <span class="main">(</span>stamp_expr <span class="free">expr1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stamp_expr <span class="free">expr1</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_VoidStamp binary_undef<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> valid_ObjStamp binary_obj <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> valid_ObjStamp binary_obj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> is_IntVal <span class="keyword1"><span class="command">have</span></span> expr2_intstamp<span class="main">:</span> <span class="quoted"><span class="quoted">"is_IntegerStamp <span class="main">(</span>stamp_expr <span class="free">expr2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stamp_expr <span class="free">expr2</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_VoidStamp binary_undef<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> valid_ObjStamp binary_obj <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> valid_ObjStamp binary_obj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> expr1_intstamp <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="skolem"><span class="skolem">lo1</span></span> <span class="skolem"><span class="skolem">hi1</span></span> <span class="keyword2"><span class="keyword">where</span></span> stamp_expr1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"stamp_expr <span class="free">expr1</span> <span class="main">=</span> <span class="main">(</span>IntegerStamp <span class="skolem">b1</span> <span class="skolem">lo1</span> <span class="skolem">hi1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_IntegerStamp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> expr2_intstamp <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="skolem"><span class="skolem">lo2</span></span> <span class="skolem"><span class="skolem">hi2</span></span> <span class="keyword2"><span class="keyword">where</span></span> stamp_expr2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"stamp_expr <span class="free">expr2</span> <span class="main">=</span> <span class="main">(</span>IntegerStamp <span class="skolem">b2</span> <span class="skolem">lo2</span> <span class="skolem">hi2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_IntegerStamp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x32</span> <span class="bound">x64</span> <span class="bound">y32</span> <span class="bound">y64</span> <span class="main">.</span> <span class="main">(</span><span class="free">val1</span> <span class="main">=</span> IntVal32 <span class="bound">x32</span> <span class="main">∧</span> <span class="free">val2</span> <span class="main">=</span> IntVal32 <span class="bound">y32</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">val1</span> <span class="main">=</span> IntVal64 <span class="bound">x64</span> <span class="main">∧</span> <span class="free">val2</span> <span class="main">=</span> IntVal64 <span class="bound">y64</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_IntVal assms<span class="main">(</span>3<span class="main">)</span> binary_eval_values
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> stamp_expr1_def stamp_expr2_def
    <span class="keyword1"><span class="command">using</span></span> binary_eval_bits_equal
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> stamp_def<span class="main">:</span> <span class="quoted"><span class="quoted">"stamp_expr <span class="main">(</span>BinaryExpr <span class="free">op</span> <span class="free">expr1</span> <span class="free">expr2</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">case</span> <span class="free">op</span> <span class="main">∈</span> fixed_32 <span class="keyword1">of</span> True <span class="main">⇒</span> unrestricted_stamp <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="skolem">lo1</span> <span class="skolem">hi1</span><span class="main">)</span><span class="main">|</span> False <span class="main">⇒</span> unrestricted_stamp <span class="main">(</span>IntegerStamp <span class="skolem">b1</span> <span class="skolem">lo1</span> <span class="skolem">hi1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stamp_expr.simps<span class="main">(</span>2<span class="main">)</span> stamp_binary.simps<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> stamp_expr1_def stamp_expr2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">from</span></span> stamp_expr1_def <span class="keyword1"><span class="command">have</span></span> bit32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="numeral">32</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">result</span> <span class="main">=</span> IntVal32 <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="comment1">(*slow*)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Values.bool_to_val.elims<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> stamp_expr1_def <span class="keyword1"><span class="command">have</span></span> bit64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="numeral">64</span> <span class="main">∧</span> <span class="free">op</span> <span class="main">∉</span> fixed_32 <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">result</span> <span class="main">=</span> IntVal64 <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="comment1">(*slow*)</span>
    <span class="keyword1"><span class="command">using</span></span> fixed_32_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> stamp_expr1_def <span class="keyword1"><span class="command">have</span></span> fixed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">op</span> <span class="main">∈</span> fixed_32 <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">result</span> <span class="main">=</span> IntVal32 <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> fixed_32_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">op</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bit32 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> Values.bool_to_val.elims<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> bit32 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> Values.bool_to_val.elims<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">val1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">val2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> bit32 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Values.bool_to_val.elims<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">op</span> <span class="main">∈</span> fixed_32"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_value.simps<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    unrestricted_32bit_always_valid unrestricted_64bit_always_valid stamp_expr1_def
    bit32 bit64 stamp_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x32</span> <span class="bound">x64</span> <span class="bound">y32</span> <span class="bound">y64</span><span class="main">.</span> <span class="free">val1</span> <span class="main">=</span> IntVal32 <span class="bound">x32</span> <span class="main">∧</span> <span class="free">val2</span> <span class="main">=</span> IntVal32 <span class="bound">y32</span> <span class="main">∨</span> <span class="free">val1</span> <span class="main">=</span> IntVal64 <span class="bound">x64</span> <span class="main">∧</span> <span class="free">val2</span> <span class="main">=</span> IntVal64 <span class="bound">y64</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> fixed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stamp_meet_is_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="free">stamp1</span> <span class="free">val</span> <span class="main">∨</span> valid_value <span class="free">stamp2</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"meet <span class="free">stamp1</span> <span class="free">stamp2</span> <span class="main">≠</span> IllegalStamp"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>meet <span class="free">stamp1</span> <span class="free">stamp2</span><span class="main">)</span> <span class="free">val</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">stamp1</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> VoidStamp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Stamp.exhaust assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>37<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>44<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>51<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>58<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>65<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>66<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>67<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntegerStamp <span class="skolem">b</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="skolem"><span class="skolem">lo2</span></span> <span class="skolem"><span class="skolem">hi2</span></span> <span class="keyword2"><span class="keyword">where</span></span> stamp2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">stamp2</span> <span class="main">=</span> IntegerStamp <span class="skolem">b2</span> <span class="skolem">lo2</span> <span class="skolem">hi2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntegerStamp assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>45<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>52<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>59<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>65<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>66<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>67<span class="main"><span class="main">)</span></span> unrestricted_stamp.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> meet.simps<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntegerStamp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> meet_def<span class="main">:</span> <span class="quoted"><span class="quoted">"meet <span class="free">stamp1</span> <span class="free">stamp2</span> <span class="main">=</span> <span class="main">(</span>IntegerStamp <span class="skolem">b</span> <span class="main">(</span>min <span class="skolem">lo</span> <span class="skolem">lo2</span><span class="main">)</span> <span class="main">(</span>max <span class="skolem">hi</span> <span class="skolem">hi2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IntegerStamp stamp2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> val_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">val</span> <span class="main">=</span> IntVal32 <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IntegerStamp assms<span class="main">(</span>1<span class="main">)</span> valid32
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b2</span>›</span></span> stamp2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"sint <span class="skolem">x</span> <span class="main">≥</span> min <span class="skolem">lo</span> <span class="skolem">lo2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> val_def
      <span class="keyword1"><span class="command">using</span></span> IntegerStamp assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> stamp2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"sint <span class="skolem">x</span> <span class="main">≤</span> max <span class="skolem">hi</span> <span class="skolem">hi2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> val_def
      <span class="keyword1"><span class="command">using</span></span> IntegerStamp assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> stamp2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> min max <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True meet_def val_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bit64<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="numeral">64</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> IntegerStamp valid_value.simps
      valid32or64_both
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b2</span>›</span></span> stamp2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> val_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">val</span> <span class="main">=</span> IntVal64 <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IntegerStamp assms<span class="main">(</span>1<span class="main">)</span> valid64
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b2</span>›</span></span> stamp2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"sint <span class="skolem">x</span> <span class="main">≥</span> min <span class="skolem">lo</span> <span class="skolem">lo2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> val_def
      <span class="keyword1"><span class="command">using</span></span> IntegerStamp assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> stamp2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"sint <span class="skolem">x</span> <span class="main">≤</span> max <span class="skolem">hi</span> <span class="skolem">hi2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> val_def
      <span class="keyword1"><span class="command">using</span></span> IntegerStamp assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> stamp2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> min max <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bit64 meet_def val_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>KlassPointerStamp <span class="skolem">x31</span> <span class="skolem">x32</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> meet.simps<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>65<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>67<span class="main"><span class="main">)</span></span> unrestricted_stamp.cases valid_value.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MethodCountersPointerStamp <span class="skolem">x41</span> <span class="skolem">x42</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> meet.simps<span class="main"><span class="main">(</span></span>20<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>21<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>67<span class="main"><span class="main">)</span></span> unrestricted_stamp.cases valid_value.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MethodPointersStamp <span class="skolem">x51</span> <span class="skolem">x52</span><span class="main">)</span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> is_stamp_empty.elims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>27<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>28<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>65<span class="main"><span class="main">)</span></span> meet.simps<span class="main"><span class="main">(</span></span>67<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span> valid_value.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ObjectStamp <span class="skolem">x61</span> <span class="skolem">x62</span> <span class="skolem">x63</span> <span class="skolem">x64</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> meet.simps<span class="main">(</span>34<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RawPointerStamp <span class="skolem">x71</span> <span class="skolem">x72</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> meet.simps<span class="main">(</span>35<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> IllegalStamp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> meet.simps<span class="main">(</span>36<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> conditional_eval_implies_valud_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">cond</span> <span class="main">↦</span> <span class="free">condv</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">expr</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> IRTreeEval.val_to_bool <span class="free">condv</span> <span class="keyword1">then</span> <span class="free">expr1</span> <span class="keyword1">else</span> <span class="free">expr2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">expr</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">val</span> <span class="main">≠</span> UndefVal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="free">cond</span><span class="main">)</span> <span class="free">condv</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="free">expr</span><span class="main">)</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="main">(</span>ConditionalExpr <span class="free">cond</span> <span class="free">expr1</span> <span class="free">expr2</span><span class="main">)</span><span class="main">)</span> <span class="free">val</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"meet <span class="main">(</span>stamp_expr <span class="free">expr1</span><span class="main">)</span> <span class="main">(</span>stamp_expr <span class="free">expr2</span><span class="main">)</span> <span class="main">≠</span> IllegalStamp"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"stamp_expr <span class="free">expr</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> valid_VoidStamp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> stamp_meet_is_valid <span class="keyword1"><span class="command">using</span></span> stamp_expr.simps<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stamp_implies_valid_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">expr</span> <span class="main">↦</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>stamp_expr <span class="free">expr</span><span class="main">)</span> <span class="free">val</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">expr</span></span> <span class="quoted"><span class="free">val</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>UnaryExpr <span class="skolem">expr</span> <span class="skolem">val</span> <span class="skolem">result</span> <span class="skolem">op</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> unary_eval_implies_valud_value <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinaryExpr <span class="skolem">expr1</span> <span class="skolem">val1</span> <span class="skolem">expr2</span> <span class="skolem">val2</span> <span class="skolem">result</span> <span class="skolem">op</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> binary_eval_implies_valud_value <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConditionalExpr <span class="skolem">cond</span> <span class="skolem">condv</span> <span class="skolem">expr</span> <span class="skolem">expr1</span> <span class="skolem">expr2</span> <span class="skolem">val</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> conditional_eval_implies_valud_value <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ParameterExpr <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LeafExpr <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ConstantExpr <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeBinaryProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeBinaryOp <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeBinaryOp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binary_const_fold <span class="skolem">x</span> <span class="skolem">val1</span> <span class="skolem">y</span> <span class="skolem">val2</span> <span class="skolem">val</span> <span class="skolem">op</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binary_fold_yneutral <span class="skolem">y</span> <span class="skolem">c</span> <span class="skolem">op</span> <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> binary_fold_yneutral.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_eval <span class="skolem">op</span> <span class="skolem">xval</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neutral_rewrite_helper binary_fold_yneutral.hyps<span class="main">(</span>2-3<span class="main">,</span>6-<span class="main">)</span> stamp_implies_valid_value is_IntegerStamp_def
    <span class="keyword1"><span class="command">sorry</span></span> <span class="comment1">(*by (metis ConstantExpr Value.distinct(5) valid_value.simps(34))*)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> binary_fold_yneutral.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> binary_fold_yneutral.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> binary_fold_yneutral.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x_eval
          BinaryExprE ConstantExprE evalDet<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binary_fold_yzero32 <span class="skolem">y</span> <span class="skolem">c</span> <span class="skolem">op</span> <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> binary_fold_yzero32.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_eval <span class="skolem">op</span> <span class="skolem">xval</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> annihilator_rewrite_helper binary_fold_yzero32.hyps stamp_implies_valid_value is_IntegerStamp_def
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE ConstantExprE binary_fold_yzero32.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> binary_fold_yzero32.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> binary_fold_yzero32.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> evalDet x_eval<span class="main">)</span>

<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binary_fold_yzero64 <span class="skolem">y</span> <span class="skolem">c</span> <span class="skolem">op</span> <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> binary_fold_yzero64.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_eval <span class="skolem">op</span> <span class="skolem">xval</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> annihilator_rewrite_helper
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE ConstantExprE binary_fold_yzero64.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        binary_fold_yzero64.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> binary_fold_yzero64.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> evalDet x_eval<span class="main">)</span>

<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>binary_idempotent <span class="skolem">op</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> binary_idempotent.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_eval <span class="skolem">op</span> <span class="skolem">xval</span> <span class="skolem">xval</span> <span class="main">=</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> idempotent_rewrite_helper binary_idempotent.hyps 
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE binary_idempotent.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> binary_idempotent.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> evalDet x_eval<span class="main">)</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeUnaryProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeUnaryOp <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeUnaryOp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>unary_const_fold <span class="skolem">val'</span> <span class="skolem">op</span> <span class="skolem">val</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mul_rewrite_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">32</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_mul <span class="free">x</span> <span class="main">(</span>IntVal32 <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> intval_negate <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="numeral">64</span> <span class="free">lo</span> <span class="free">hi</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> intval_mul <span class="free">x</span> <span class="main">(</span>IntVal64 <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> intval_negate <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeMulProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeMul <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeMul.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mul_negate32 <span class="skolem">y</span> <span class="skolem">x</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> ConstantExprE BinaryExprE bin_eval.simps evalDet mul_rewrite_helper 
      stamp_implies_valid_value 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mul_negate64 <span class="skolem">y</span> <span class="skolem">x</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> ConstantExprE BinaryExprE bin_eval.simps evalDet mul_rewrite_helper 
      stamp_implies_valid_value
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* (x - y) + y ⇒ x *)</span>
<span class="comment1">(*  x + (y - x) ⇒ y *)</span>
<span class="comment1">(* (-x + y) ⇒ (y - x) *)</span>
<span class="comment1">(* (x + (-y)) ⇒ (x - y) *)</span>
<span class="keyword1"><span class="command">lemma</span></span> add_rewrites_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">loy</span> <span class="free">hiy</span><span class="main">)</span> <span class="free">y</span>"</span></span>

  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_add <span class="main">(</span>intval_sub <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_add <span class="free">x</span> <span class="main">(</span>intval_sub <span class="free">y</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_add <span class="main">(</span>intval_negate <span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> intval_sub <span class="free">y</span> <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_add <span class="free">x</span> <span class="main">(</span>intval_negate <span class="free">y</span><span class="main">)</span> <span class="main">=</span> intval_sub <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeAddProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeAdd <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeAdd.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_xsub <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">y</span> <span class="skolem">stampa</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE Stamp.collapse<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
        evalDet stamp_implies_valid_value intval_add_sym add_rewrites_helper<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_ysub <span class="skolem">y</span> <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">stampa</span> <span class="skolem">stampx</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_IntegerStamp_def add_ysub.hyps add_ysub.prems evalDet BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> stamp_implies_valid_value intval_add_sym add_rewrites_helper<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_xnegate <span class="skolem">nx</span> <span class="skolem">x</span> <span class="skolem">stampx</span> <span class="skolem">stampy</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> del_insts<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE add_rewrites_helper<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 
        bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet stamp_implies_valid_value intval_add_sym is_IntegerStamp_def unary_eval.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add_ynegate <span class="skolem">ny</span> <span class="skolem">y</span> <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE add_rewrites_helper<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet stamp_implies_valid_value is_IntegerStamp_def unary_eval.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* (x + y) - y ⇒ x *)</span>
<span class="comment1">(* (x + y) - x ⇒ y *)</span>
<span class="comment1">(* (x - y) - x ⇒ (-y) *)</span>
<span class="comment1">(* x - (x + y) ⇒ (-y) *)</span>
<span class="comment1">(* y - (x + y) ⇒ (-x) *)</span>
<span class="comment1">(* x - (x - y) ⇒ y *)</span>
<span class="comment1">(* x - (-y) ⇒ x + y *)</span>
<span class="keyword1"><span class="command">lemma</span></span> sub_rewrites_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">loy</span> <span class="free">hiy</span><span class="main">)</span> <span class="free">y</span>"</span></span>

  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_sub <span class="main">(</span>intval_add <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">y</span>  <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_sub <span class="main">(</span>intval_add <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span>  <span class="main">=</span> <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_sub <span class="main">(</span>intval_sub <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span>  <span class="main">=</span> intval_negate <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_sub <span class="free">x</span> <span class="main">(</span>intval_add <span class="free">x</span> <span class="free">y</span><span class="main">)</span>  <span class="main">=</span> intval_negate <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_sub <span class="free">y</span> <span class="main">(</span>intval_add <span class="free">x</span> <span class="free">y</span><span class="main">)</span>  <span class="main">=</span> intval_negate <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_sub <span class="free">x</span> <span class="main">(</span>intval_sub <span class="free">x</span> <span class="free">y</span><span class="main">)</span>  <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_sub <span class="free">x</span> <span class="main">(</span>intval_negate <span class="free">y</span><span class="main">)</span> <span class="main">=</span> intval_add <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="comment1">(* x - x ⇒ 0 *)</span>
<span class="comment1">(* 0 - x ⇒ -x *)</span>
<span class="keyword1"><span class="command">lemma</span></span> sub_single_rewrites_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">32</span> <span class="main">⟹</span> intval_sub <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> IntVal32 <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">64</span> <span class="main">⟹</span> intval_sub <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> IntVal64 <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">32</span> <span class="main">⟹</span> intval_sub <span class="main">(</span>IntVal32 <span class="main">0</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> intval_negate <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">64</span> <span class="main">⟹</span> intval_sub <span class="main">(</span>IntVal64 <span class="main">0</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> intval_negate <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeSubProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeSub <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeSub.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_same32 <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>     
    <span class="keyword1"><span class="command">using</span></span> ConstantExprE BinaryExprE  bin_eval.simps evalDet sub_same32.prems sub_single_rewrites_helper 
      stamp_implies_valid_value sub_same32.hyps<span class="main">(</span>1<span class="main">)</span> sub_same32.hyps<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_same64 <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>     
    <span class="keyword1"><span class="command">using</span></span> ConstantExprE BinaryExprE  bin_eval.simps evalDet sub_same64.prems sub_single_rewrites_helper 
      stamp_implies_valid_value sub_same64.hyps<span class="main">(</span>1<span class="main">)</span> sub_same64.hyps<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_left_add1 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">stampa</span> <span class="skolem">stampb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE Stamp.collapse<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet 
        stamp_implies_valid_value sub_rewrites_helper<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_left_add2 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">stampa</span> <span class="skolem">stampb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE Stamp.collapse<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet 
        stamp_implies_valid_value sub_rewrites_helper<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_left_sub <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">stampa</span> <span class="skolem">stampb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet
        stamp_implies_valid_value is_IntegerStamp_def sub_rewrites_helper<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> unary_eval.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_right_add1 <span class="skolem">y</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">stampa</span> <span class="skolem">stampb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet
        stamp_implies_valid_value is_IntegerStamp_def sub_rewrites_helper<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> unary_eval.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_right_add2 <span class="skolem">y</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">stampa</span> <span class="skolem">stampb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet
        stamp_implies_valid_value is_IntegerStamp_def sub_rewrites_helper<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> unary_eval.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_right_sub <span class="skolem">y</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">stampa</span> <span class="skolem">stampb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet
        stamp_implies_valid_value is_IntegerStamp_def sub_rewrites_helper<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_xzero32 <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>     
    <span class="keyword1"><span class="command">using</span></span> ConstantExprE BinaryExprE  bin_eval.simps evalDet sub_xzero32.prems sub_single_rewrites_helper 
      stamp_implies_valid_value sub_xzero32.hyps<span class="main">(</span>1<span class="main">)</span> sub_xzero32.hyps<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_xzero64 <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">lo</span> <span class="skolem">hi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>     
    <span class="keyword1"><span class="command">using</span></span> ConstantExprE BinaryExprE  bin_eval.simps evalDet sub_xzero64.prems sub_single_rewrites_helper 
      stamp_implies_valid_value sub_xzero64.hyps<span class="main">(</span>1<span class="main">)</span> sub_xzero64.hyps<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub_y_negate <span class="skolem">nb</span> <span class="skolem">b</span> <span class="skolem">stampa</span> <span class="skolem">a</span> <span class="skolem">stampb</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet
        stamp_implies_valid_value is_IntegerStamp_def sub_rewrites_helper<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> unary_eval.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* -(x-y) = (x-y) *)</span>
<span class="keyword1"><span class="command">lemma</span></span> negate_xsuby_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">loy</span> <span class="free">hiy</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_negate <span class="main">(</span>intval_sub <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> intval_sub <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="comment1">(* -(-x) = x *)</span>
<span class="keyword1"><span class="command">lemma</span></span> negate_negate_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_negate <span class="main">(</span>intval_negate <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> valid32or64 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeNegateProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeNegate <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeNegate.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>negate_negate <span class="skolem">nx</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnaryExprE evalDet stamp_implies_valid_value is_IntegerStamp_def negate_negate_helper unary_eval.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>negate_sub <span class="skolem">e</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">stampx</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet stamp_implies_valid_value
        is_IntegerStamp_def negate_xsuby_helper unary_eval.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: a better name for this? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> word_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">::</span> <span class="numeral">32</span> word<span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">-</span> <span class="bound">x</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="keyword1">&lt;s</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">::</span> <span class="numeral">64</span> word<span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">-</span> <span class="bound">x</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="keyword1">&lt;s</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">::</span> <span class="numeral">32</span> word<span class="main">.</span> <span class="main">¬</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">x</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">::</span> <span class="numeral">64</span> word<span class="main">.</span> <span class="main">¬</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">x</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper"><span class="improper"><span class="improper">x</span></span></span></span>"</span></span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">sorry</span></span>

<span class="comment1">(* abs(-x) = abs(x) *)</span>
<span class="comment1">(* abs(abs(x)) = abs(x) 
lemma abs_rewrite_helper:
  assumes "valid_value (IntegerStamp b lox hix) x"
  shows "intval_abs (intval_negate x) = intval_abs x"
  and "intval_abs (intval_abs x) = intval_abs x"
  apply (case_tac[!] "x")
  using word_helper apply auto+
  done
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_abs_is_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_abs <span class="main">(</span>intval_abs <span class="free">x</span><span class="main">)</span> <span class="main">=</span> intval_abs <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> word_helper
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms intval_abs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> intval_abs.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid32or64_both<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> abs_neg_is_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_abs <span class="main">(</span>intval_negate <span class="free">x</span><span class="main">)</span> <span class="main">=</span> intval_abs <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> word_helper <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(*
lemma CanonicalizeAbsAbs:
  assumes vv: "is_IntegerStamp (stamp_expr e)"
  assumes "[m, p] ⊢ UnaryExpr UnaryAbs (UnaryExpr UnaryAbs e) ↦ v"
  shows "[m, p] ⊢ UnaryExpr UnaryAbs e ↦ v"
  by (metis UnaryExprE abs_abs_is_abs assms(2) stamp_implies_valid_value
      is_IntegerStamp_def unary_eval.simps(1) vv)

lemma CanonicalizeAbsNeg:
  assumes vv: "is_IntegerStamp (stamp_expr e)"
  assumes "[m, p] ⊢ UnaryExpr UnaryAbs (UnaryExpr UnaryNeg e) ↦ v"
  shows "[m, p] ⊢ UnaryExpr UnaryAbs e ↦ v"
  using UnaryExprE abs_neg_is_neg assms(2) stamp_implies_valid_value
      is_IntegerStamp_def unary_eval.simps(2) vv
  by (smt (verit, ccfv_threshold) evaltree.simps unary_eval.simps(1))
  
lemma CanonicalizeAbsProof:
  assumes "CanonicalizeAbs before after"
  assumes "[m, p] ⊢ before ↦ res"
  assumes "[m, p] ⊢ after ↦ res'"
  shows "res = res'"
  using assms
proof (induct rule: CanonicalizeAbs.induct)
  case (abs_abs ax x)
  then show ?case
    by (metis UnaryExprE abs_rewrite_helper(2) evalDet stamp_implies_valid_value is_IntegerStamp_def
        unary_eval.simps(1))
next
  case (abs_neg nx x)
  then show ?case
    by (metis UnaryExprE abs_rewrite_helper(1) evalDet stamp_implies_valid_value is_IntegerStamp_def
        unary_eval.simps(1) unary_eval.simps(2))
qed
*)</span>
<span class="comment1">(* ~(~x) = x *)</span>
<span class="keyword1"><span class="command">lemma</span></span> not_rewrite_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_not <span class="main">(</span>intval_not <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeNotProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeNot <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeNot.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>not_not <span class="skolem">nx</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnaryExprE evalDet is_IntegerStamp_def not_rewrite_helper
        stamp_implies_valid_value unary_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> demorgans_rewrites_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">lox</span> <span class="free">hix</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"valid_value <span class="main">(</span>IntegerStamp <span class="free">b</span> <span class="free">loy</span> <span class="free">hiy</span><span class="main">)</span> <span class="free">y</span>"</span></span>

  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intval_and <span class="main">(</span>intval_not <span class="free">x</span><span class="main">)</span> <span class="main">(</span>intval_not <span class="free">y</span><span class="main">)</span> <span class="main">=</span> intval_not <span class="main">(</span>intval_or <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"intval_or <span class="main">(</span>intval_not <span class="free">x</span><span class="main">)</span> <span class="main">(</span>intval_not <span class="free">y</span><span class="main">)</span> <span class="main">=</span> intval_not <span class="main">(</span>intval_and <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> intval_and <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> intval_or <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeAndProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeAnd <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeAnd.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>and_same <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> demorgans_rewrites_helper<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> evalDet
        stamp_implies_valid_value is_IntegerStamp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>and_demorgans <span class="skolem">nx</span> <span class="skolem">x</span> <span class="skolem">ny</span> <span class="skolem">y</span> <span class="skolem">stampx</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 
        demorgans_rewrites_helper<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> evalDet stamp_implies_valid_value is_IntegerStamp_def unary_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeOrProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeOr <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeOr.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>or_same <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BinaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> demorgans_rewrites_helper<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> evalDet
        stamp_implies_valid_value is_IntegerStamp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>or_demorgans <span class="skolem">nx</span> <span class="skolem">x</span> <span class="skolem">ny</span> <span class="skolem">y</span> <span class="skolem">stampx</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> BinaryExprE Stamp.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> UnaryExprE bin_eval.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> bin_eval.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> demorgans_rewrites_helper<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
        evalDet stamp_implies_valid_value is_IntegerStamp_def unary_eval.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stamps_touch_but_not_less_than_implies_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>valid_value <span class="free">stampx</span> <span class="free">x</span><span class="main">;</span>
    valid_value <span class="free">stampy</span> <span class="free">y</span><span class="main">;</span>
    is_IntegerStamp <span class="free">stampx</span> <span class="main">∧</span> is_IntegerStamp <span class="free">stampy</span><span class="main">;</span>
    stpi_upper <span class="free">stampx</span> <span class="main">=</span> stpi_lower <span class="free">stampy</span><span class="main">;</span>
    <span class="main">¬</span> val_to_bool <span class="main">(</span>intval_less_than <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> valid32or64_both intval_equals.simps<span class="main">(</span>1-2<span class="main">)</span> intval_less_than.simps<span class="main">(</span>1-2<span class="main">)</span> val_to_bool.simps<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword1"><span class="command">lemma</span></span> disjoint_stamp_implies_less_than<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>valid_value <span class="free">stampx</span> <span class="free">x</span><span class="main">;</span>
    valid_value <span class="free">stampy</span> <span class="free">y</span><span class="main">;</span>
    is_IntegerStamp <span class="free">stampx</span> <span class="main">∧</span> is_IntegerStamp <span class="free">stampy</span><span class="main">;</span>
    stpi_upper <span class="free">stampx</span> <span class="main">&lt;</span> stpi_lower <span class="free">stampy</span><span class="main">⟧</span> 
  <span class="main">⟹</span> val_to_bool<span class="main">(</span>intval_less_than <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CanonicalizeConditionalProof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CanonicalizeConditional <span class="free">before</span> <span class="free">after</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">before</span> <span class="main">↦</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span> <span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="free">after</span> <span class="main">↦</span> <span class="free">res'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="free">res'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> CanonicalizeConditional.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>eq_branches <span class="skolem">t</span> <span class="skolem">f</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cond_eq <span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">stampx</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> xeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cond_eq.hyps<span class="main">(</span>1<span class="main">)</span> cond_eq.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yval</span></span> <span class="keyword2"><span class="keyword">where</span></span> yeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cond_eq.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xval</span> <span class="main">=</span> <span class="skolem">yval</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> ConditionalExprE cond_eq.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cond_eq.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> evalDet xeval yeval<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>val_to_bool<span class="main">(</span>intval_equals <span class="skolem">xval</span> <span class="skolem">yval</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ConstantExpr Value.distinct<span class="main">(</span>9<span class="main">)</span> valid_value.simps stamp_implies_valid_value
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"intval_equals <span class="skolem">xval</span> <span class="skolem">yval</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> IRTreeEval.val_to_bool.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span> <span class="keyword1"><span class="command">sorry</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="skolem">yval</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> BinaryExprE ConditionalExprE bin_eval.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> cond_eq.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cond_eq.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> evalDet xeval yeval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> cond_eq.prems<span class="main">(</span>1<span class="main">)</span> cond_eq.prems<span class="main">(</span>2<span class="main">)</span> xeval yeval evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>condition_bounds_x <span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">stampx</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> xeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_x.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yval</span></span> <span class="keyword2"><span class="keyword">where</span></span> yeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_x.hyps<span class="main">(</span>1<span class="main">)</span> condition_bounds_x.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"val_to_bool<span class="main">(</span>intval_less_than <span class="skolem">xval</span> <span class="skolem">yval</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> BinaryExprE ConditionalExprE bin_eval.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> condition_bounds_x.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> condition_bounds_x.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> condition_bounds_x.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> evalDet xeval yeval<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stpi_upper <span class="skolem">stampx</span> <span class="main">=</span> stpi_lower <span class="skolem">stampy</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False condition_bounds_x.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> order.not_eq_order_implies_strict
          disjoint_stamp_implies_less_than condition_bounds_x.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> condition_bounds_x.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> condition_bounds_x.hyps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span>
          stamp_implies_valid_value xeval yeval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xval</span> <span class="main">=</span> <span class="skolem">yval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False condition_bounds_x.hyps<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> stamp_implies_valid_value
          stamps_touch_but_not_less_than_implies_equal xeval yeval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="skolem">xval</span> <span class="main">∧</span> <span class="free">res'</span> <span class="main">=</span> <span class="skolem">xval</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ConditionalExprE condition_bounds_x.prems<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="free">res'</span>›</span></span> evalDet xeval yeval
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>condition_bounds_y <span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">stampx</span> <span class="skolem">stampy</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> xeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_y.hyps<span class="main">(</span>1<span class="main">)</span> condition_bounds_y.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yval</span></span> <span class="keyword2"><span class="keyword">where</span></span> yeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_bounds_y.hyps<span class="main">(</span>1<span class="main">)</span> condition_bounds_y.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"val_to_bool<span class="main">(</span>intval_less_than <span class="skolem">xval</span> <span class="skolem">yval</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> BinaryExprE ConditionalExprE bin_eval.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> condition_bounds_y.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> condition_bounds_y.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> condition_bounds_y.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> evalDet xeval yeval<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stpi_upper <span class="skolem">stampx</span> <span class="main">=</span> stpi_lower <span class="skolem">stampy</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False condition_bounds_y.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> order.not_eq_order_implies_strict
          disjoint_stamp_implies_less_than condition_bounds_y.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> condition_bounds_y.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
          condition_bounds_y.hyps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> stamp_implies_valid_value xeval yeval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xval</span> <span class="main">=</span> <span class="skolem">yval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False condition_bounds_y.hyps<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span>
          stamp_implies_valid_value stamps_touch_but_not_less_than_implies_equal xeval yeval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="skolem">yval</span> <span class="main">∧</span> <span class="free">res'</span> <span class="main">=</span> <span class="skolem">yval</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ConditionalExprE condition_bounds_y.prems<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="free">res'</span>›</span></span> evalDet xeval yeval
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>negate_condition <span class="skolem">nc</span> <span class="skolem">c</span> <span class="skolem">stampc</span> <span class="skolem">lo</span> <span class="skolem">hi</span> <span class="skolem">stampx</span> <span class="skolem">x</span> <span class="skolem">stampy</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cval</span></span> <span class="keyword2"><span class="keyword">where</span></span> ceval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">c</span> <span class="main">↦</span> <span class="skolem">cval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negate_condition.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ncval</span></span> <span class="keyword2"><span class="keyword">where</span></span> nceval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">nc</span> <span class="main">↦</span> <span class="skolem">ncval</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negate_condition.prems negate_condition.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>val_to_bool <span class="skolem">ncval</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xval</span></span> <span class="keyword2"><span class="keyword">where</span></span> xeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">xval</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ConditionalExprE nceval evalDet True negate_condition.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="skolem">xval</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ConditionalExprE True evalDet nceval negate_condition.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">nc</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> negate_condition.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>val_to_bool <span class="skolem">cval</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IRTreeEval.val_to_bool.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> IRTreeEval.val_to_bool.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> True UnaryExprE ceval evalDet nceval negate_condition.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> unary_eval.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res'</span> <span class="main">=</span> <span class="skolem">xval</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nceval ceval True negate_condition<span class="main">(</span>1<span class="main">)</span> negate_condition<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ConditionalExprE evalDet xeval<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">res</span> <span class="main">=</span> <span class="skolem">xval</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yval</span></span> <span class="keyword2"><span class="keyword">where</span></span> yeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">,</span><span class="free">p</span><span class="main">]</span> <span class="main">⊢</span> <span class="skolem">y</span> <span class="main">↦</span> <span class="skolem">yval</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ConditionalExprE nceval evalDet False negate_condition.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">=</span> <span class="skolem">yval</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> False nceval negate_condition.prems<span class="main">(</span>1<span class="main">)</span> evaltree.ConditionalExpr yeval evalDet
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ConditionalExprE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"val_to_bool<span class="main">(</span><span class="skolem">cval</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False UnaryExprE ceval nceval negate_condition.hyps<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> unary_eval.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span>
          IRTreeEval.val_to_bool.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> evalDet IRTreeEval.bool_to_val.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          stamp_implies_valid_value valid_int32 zero_neq_one<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">res'</span> <span class="main">=</span> <span class="skolem">yval</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>2<span class="main">)</span> ceval negate_condition.prems evaltree.ConditionalExpr yeval evalDet  unary_eval.simps<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ConditionalExprE<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const_true <span class="skolem">c</span> <span class="skolem">val</span> <span class="skolem">t</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>const_false <span class="skolem">c</span> <span class="skolem">val</span> <span class="skolem">t</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> evalDet <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>